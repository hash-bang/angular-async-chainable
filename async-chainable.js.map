{"version":3,"sources":["async-chainable.js"],"names":["f","exports","module","define","amd","g","window","global","self","this","asyncChainable","e","t","n","r","s","o","u","a","require","i","Error","code","l","call","length",1,"getOverload","args","out","argType","Object","prototype","toString","every","item","push","isArray","thing","isObject","use","series","calledAs","arguments","_struct","type","payload","end","parallel","forEach","callback","deferAdd","id","task","parentChain","waitingOn","waitingOnIds","_deferred","prereq","next","_context","_id","_options","context","err","value","_deferredRunning","completed","_structPointer","_execute","_deferCheck","limit","filter","dep","hasOwnProperty","setTimeout","defer","await","split","offset","concat","setLimit","setContext","newContext","set","_setRaw","undefined","_set","key","_finalize","autoReset","reset","redo","currentExec","indexOf","keys","_run","map","tasks","iter","_item","_key","overloadType","_deferAdd","slice","stage","_plugins","async","parallelLimit","reAttachContext","objectInstance","_getOverload","then","each","eachSeries","eachLimit","mapSeries","mapLimit","filterSeries","reject","rejectSeries","reduce","reduceRight","detect","detectSeries","sortBy","some","concatSeries","whilst","doWhilst","until","doUntil","forever","waterfall","compose","seq","applyEach","applyEachSeries","queue","priorityQueue","cargo","auto","retry","iterator","apply","nextTick","times","timesSeries","Utils","memoize","unmemoize","log","dir","noConflict",2,"process","noop","identity","v","toBool","notId","only_once","fn","_once","_isArrayLike","arr","_isArray","_each","coll","_arrayEach","_forEachOf","index","_map","result","Array","_range","count","_reduce","memo","x","object","_keys","_indexOf","_keyIterator","len","_restParam","func","startIndex","Math","max","rest","_withoutIndex","_eachOfLimit","obj","nextKey","done","running","errored","replenish","doParallel","eachOf","doParallelLimit","doSeries","eachOfSeries","_asyncMap","eachfn","results","_filter","sort","b","_reject","cb","_createTester","check","getResult","iteratee","_","_findGetResult","_parallel","_concat","y","_queue","worker","concurrency","_insert","q","data","pos","started","idle","setImmediate","drain","unshift","saturated","_next","workers","empty","paused","kill","splice","pause","resume","resumeCount","min","w","_console_fn","name","console","error","_times","mapper","_applyEach","fns","go","that","pop","ensureAsync","innerArgs","sync","previous_async","root","_toString","_isObject","k","_setImmediate","_delay","forEachSeries","forEachLimit","forEachOf","size","forEachOfSeries","iterate","forEachOfLimit","eachOfLimit","inject","foldl","foldr","reversed","reverse","select","selectLimit","filterLimit","selectSeries","rejectLimit","any","someLimit","all","everyLimit","detectLimit","comparator","left","right","criteria","addListener","listeners","removeListener","idx","taskComplete","remainingTasks","ready","requires","listener","taskCallback","safeResults","val","rkey","parseTimes","acc","parseInt","DEFAULT_TIMES","interval","DEFAULT_INTERVAL","wrappedTask","wrappedCallback","wrappedResults","retryAttempt","finalAttempt","seriesCallback","retryInterval","opts","attempts","wrapIterator","makeCallback","callArgs","test","calls","during","truth","doDuring","items","_compareTasks","priority","_binarySearch","sequence","compare","beg","mid","hasher","queues","memoized","unmemoized","timesLimit","newargs","nextargs","constant","values","wrapSync","asyncify","message","_process",3,"cleanUpNextTick","draining","currentQueue","queueIndex","drainQueue","timeout","run","clearTimeout","Item","fun","array","title","browser","env","argv","version","versions","on","once","off","removeAllListeners","emit","binding","cwd","chdir","umask"],"mappings":"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","file":"async-chainable.js","sourcesContent":["(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.asyncChainable = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\nvar async = require('async');\n\n/**\n* Examines an argument stack and returns all passed arguments as a CSV\n* e.g.\n*\tfunction test () { getOverload(arguments) };\n*\ttest('hello', 'world') // 'string,string'\n*\ttest(function() {}, 1) // 'function,number'\n*\ttest('hello', 123, {foo: 'bar'}, ['baz'], [{quz: 'quzValue'}, {quuz: 'quuzValue'}]) // 'string,number,object,array,collection'\n*\n* @param object args The special JavaScript 'arguments' object\n* @return string CSV of all passed arguments\n*/\nfunction getOverload(args) {\n\tvar i = 0;\n\tvar out = [];\n\twhile(1) {\n\t\tvar argType = typeof args[i];\n\t\tif (argType == 'undefined') break;\n\t\tif (argType == 'object' && Object.prototype.toString.call(args[i]) == '[object Array]') { // Special case for arrays being classed as objects\n\t\t\targType = 'array';\n\t\t\tif (args[i].length && args[i].every(function(item) {\n\t\t\t\treturn (typeof item == 'object' && Object.prototype.toString.call(item) == '[object Object]');\n\t\t\t}))\n\t\t\t\targType = 'collection';\n\t\t}\n\t\tout.push(argType);\n\t\ti++;\n\t}\n\treturn out.toString();\n};\n\n// Utility functions {{{\n/**\n* Return true if a variable is an array\n* @param mixed thing The varable to examine\n* @return bool True if the item is a classic JS array and not an object\n*/\nfunction isArray(thing) {\n\treturn (\n\t\ttypeof thing == 'object' &&\n\t\tObject.prototype.toString.call(thing) == '[object Array]'\n\t);\n}\n\n\n/**\n* Return true if a variable is an object\n* @param mixed thing The varable to examine\n* @return bool True if the item is a classic JS array and not an object\n*/\nfunction isObject(thing) {\n\treturn (\n\t\ttypeof thing == 'object' &&\n\t\tObject.prototype.toString.call(thing) != '[object Array]'\n\t);\n}\n// }}}\n\n// Plugin functionality - via `use()`\nvar _plugins = {};\nfunction use(module) {\n\tmodule.call(this);\n\treturn this;\n};\n// }}}\n\n/**\n* Queue up a function(s) to execute in series\n* @param array,object,function The function(s) to execute\n* @return object This chainable object\n*/\nfunction series() {\n\tvar calledAs = getOverload(arguments);\n\tswitch(calledAs) {\n\t\tcase '':\n\t\t\t// Pass\n\t\t\tbreak;\n\t\tcase 'function': // Form: series(func)\n\t\t\tthis._struct.push({ type: 'seriesArray', payload: [arguments[0]] });\n\t\t\tbreak;\n\t\tcase  'string,function': // Form: series(String <id>, func)\n\t\t\tvar payload = {};\n\t\t\tpayload[arguments[0]] = arguments[1];\n\t\t\tthis._struct.push({ type: 'seriesObject', payload: payload});\n\t\t\tbreak;\n\t\tcase 'array': // Form: series(Array <funcs>)\n\t\t\tthis._struct.push({ type: 'seriesArray', payload: arguments[0] });\n\t\t\tbreak;\n\t\tcase 'object': // Form: series(Object <funcs>)\n\t\t\tthis._struct.push({ type: 'seriesObject', payload: arguments[0] });\n\t\t\tbreak;\n\t\tcase 'collection': // Form: series(Collection <funcs>)\n\t\t\tthis._struct.push({ type: 'seriesCollection', payload: arguments[0] });\n\t\t\tbreak;\n\n\t\t// Async library compatibility {{{\n\t\tcase 'array,function':\n\t\t\tthis._struct.push({ type: 'seriesArray', payload: arguments[0] });\n\t\t\tthis.end(arguments[1]);\n\t\t\tbreak;\n\t\tcase 'object,function':\n\t\t\tthis._struct.push({ type: 'seriesObject', payload: arguments[0] });\n\t\t\tthis.end(arguments[1]);\n\t\t\tbreak;\n\t\t// }}}\n\t\tdefault:\n\t\t\tthrow new Error('Unknown call style for .series(): ' + calledAs);\n\t}\n\n\treturn this;\n};\n\n\n/**\n* Queue up a function(s) to execute in parallel\n* @param array,object,function The function(s) to execute\n* @return object This chainable object\n*/\nfunction parallel() {\n\tvar calledAs = getOverload(arguments)\n\tswitch (calledAs) {\n\t\tcase '':\n\t\t\t// Pass\n\t\t\tbreak;\n\t\tcase 'function': // Form: parallel(func)\n\t\t\tthis._struct.push({ type: 'parallelArray', payload: [arguments[0]] });\n\t\t\tbreak;\n\t\tcase 'string,function': // Form: parallel(String <id>, func)\n\t\t\tvar payload = {};\n\t\t\tpayload[arguments[0]] = arguments[1];\n\t\t\tthis._struct.push({ type: 'parallelArray', payload: payload });\n\t\t\tbreak;\n\t\tcase 'array': // Form: parallel(Array <funcs>)\n\t\t\tthis._struct.push({ type: 'parallelArray', payload: arguments[0] });\n\t\t\tbreak;\n\t\tcase 'object': // Form: parallel(Object <funcs>)\n\t\t\tthis._struct.push({ type: 'parallelObject', payload: arguments[0] });\n\t\t\tbreak;\n\t\tcase 'collection': // Form: parallel(Collection <funcs>)\n\t\t\tthis._struct.push({ type: 'parallelCollection', payload: arguments[0] });\n\t\t\tbreak;\n\n\t\t// Async library compatibility {{{\n\t\tcase 'array,function':\n\t\t\tthis._struct.push({ type: 'parallelArray', payload: arguments[0] });\n\t\t\tthis.end(arguments[1]);\n\t\t\tbreak;\n\t\tcase 'object,function':\n\t\t\tthis._struct.push({ type: 'parallelObject', payload: arguments[0] });\n\t\t\tthis.end(arguments[1]);\n\t\t\tbreak;\n\t\t// }}}\n\t\tdefault:\n\t\t\tthrow new Error('Unknown call style for .parallel(): ' + calledAs);\n\t}\n\n\treturn this;\n};\n\n\n/**\n* Run an array/object/collection though a function\n* This is similar to the async native .each() function but chainable\n*/\nfunction forEach() {\n\tvar calledAs = getOverload(arguments)\n\tswitch (calledAs) {\n\t\tcase '':\n\t\t\t// Pass\n\t\t\tbreak;\n\t\tcase 'collection,function': // Form: forEach(Collection func)\n\t\tcase 'array,function': // Form: forEach(Array, func)\n\t\t\tthis._struct.push({ type: 'forEachArray', payload: arguments[0], callback: arguments[1] });\n\t\t\tbreak;\n\t\tcase 'object,function': // Form: forEach(Object, func)\n\t\t\tthis._struct.push({ type: 'forEachObject', payload: arguments[0], callback: arguments[1] });\n\t\t\tbreak;\n\t\tcase 'string,function': // Form: forEach(String <set lookup>, func)\n\t\t\tthis._struct.push({ type: 'forEachLateBound', payload: arguments[0], callback: arguments[1] });\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tthrow new Error('Unknown call style for .forEach(): ' + calledAs);\n\t}\n\n\treturn this;\n}\n\n\n// Defer functionality - Here be dragons! {{{\n/**\n* Collection of items that have been deferred\n* @type collection {payload: function, id: null|String, prereq: [dep1, dep2...]}\n* @access private\n*/\nfunction deferAdd(id, task, parentChain) {\n\tvar self = this;\n\tparentChain.waitingOn = (parentChain.waitingOn || 0) + 1;\n\n\tif (! parentChain.waitingOnIds)\n\t\tparentChain.waitingOnIds = [];\n\tparentChain.waitingOnIds.push(id);\n\n\tself._deferred.push({\n\t\tid: id || null,\n\t\tprereq: parentChain.prereq || [],\n\t\tpayload: function(next) {\n\t\t\tself._context._id = id;\n\t\t\ttask.call(self._options.context, function(err, value) {\n\t\t\t\tif (id)\n\t\t\t\t\tself._context[id] = value;\n\t\t\t\tself._deferredRunning--;\n\t\t\t\tif (--parentChain.waitingOn == 0) {\n\t\t\t\t\tparentChain.completed = true;\n\t\t\t\t\tif (self._struct.length && self._struct[self._structPointer].type == 'await')\n\t\t\t\t\t\tself._execute(err);\n\t\t\t\t}\n\t\t\t\tself._execute(err);\n\t\t\t});\n\t\t}\n\t});\n};\n\n\nfunction _deferCheck() {\n\tvar self = this;\n\tif (self._options.limit && self._deferredRunning >= self._options.limit) return; // Already over limit\n\tself._deferred = self._deferred.filter(function(item) {\n\t\tif (self._options.limit && self._deferredRunning >= self._options.limit) {\n\t\t\treturn true; // Already over limit - all subseqent items should be left in place\n\t\t}\n\t\tif (\n\t\t\titem.prereq.length == 0 || // No pre-reqs - can execute now\n\t\t\titem.prereq.every(function(dep) { // All pre-reqs are satisfied\n\t\t\t\treturn self._context.hasOwnProperty(dep);\n\t\t\t})\n\t\t) { \n\t\t\tself._deferredRunning++;\n\t\t\tsetTimeout(item.payload);\n\t\t\treturn false;\n\t\t} else { // Can't do anything with self right now\n\t\t\treturn true;\n\t\t}\n\t});\n};\n// }}}\n\n\n/**\n* Queue up a function(s) to execute as deferred - i.e. dont stop to wait for it\n* @param array,object,function The function(s) to execute as a defer\n* @return object This chainable object\n*/\nfunction defer() {\n\tvar calledAs = getOverload(arguments);\n\tswitch (calledAs) {\n\t\tcase '':\n\t\t\t// Pass\n\t\t\tbreak;\n\t\tcase 'function': // Form: defer(func)\n\t\t\tthis._struct.push({ type: 'deferArray', payload: [arguments[0]] });\n\t\t\tbreak;\n\t\tcase 'string,function': // Form: defer(String <id>, func)\n\t\t\tvar payload = {};\n\t\t\tpayload[arguments[0]] = arguments[1];\n\t\t\tthis._struct.push({ type: 'deferObject', payload: payload });\n\t\t\tbreak;\n\t\tcase 'array': // Form: defer(Array <funcs>)\n\t\t\tthis._struct.push({ type: 'deferArray', payload: arguments[0] });\n\t\t\tbreak;\n\t\tcase 'object': // Form: defer(Object <funcs>)\n\t\t\tthis._struct.push({ type: 'deferObject', payload: arguments[0] });\n\t\t\tbreak;\n\t\tcase 'collection': // Form defer(Collection <funcs>)\n\t\t\tthis._struct.push({ type: 'deferCollection', payload: arguments[0] });\n\t\t\tbreak;\n\t\tcase 'array,function': // Form: defer(Array <prereqs>, func)\n\t\t\tthis._struct.push({ type: 'deferObject', prereq: arguments[0], payload: {'': arguments[1]} });\n\t\t\tbreak;\n\t\tcase 'string,string,function': // Form: defer(String <prereq>, String <name>, func)\n\t\t\tvar payload = {};\n\t\t\tpayload[arguments[1]] = arguments[2];\n\t\t\tthis._struct.push({ type: 'deferObject', prereq: [arguments[0]], payload: payload });\n\t\t\tbreak;\n\t\tcase 'array,string,function': //Form: defer(Array <prereqs>, String <id>, func)\n\t\t\tvar payload = {};\n\t\t\tpayload[arguments[1]] = arguments[2];\n\t\t\tthis._struct.push({ type: 'deferObject', prereq: arguments[0], payload: payload });\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tthrow new Error('Unknown call style for .defer():' + calledAs);\n\t}\n\n\treturn this;\n};\n\n\n/**\n* Queue up an await point\n* This stops the execution queue until its satisfied that dependencies have been resolved\n* @param array,... The dependencies to check resolution of. If omitted all are checked\n* @return object This chainable object\n*/\nfunction await() {\n\tvar payload = [];\n\n\t// Slurp all args into payload {{{\n\tvar args = arguments;\n\tgetOverload(arguments).split(',').forEach(function(type, offset) {\n\t\tswitch (type) {\n\t\t\tcase '': // Blank arguments - do nothing\n\t\t\t\t// Pass\n\t\t\t\tbreak;\n\t\t\tcase 'string':\n\t\t\t\tpayload.push(args[offset]);\n\t\t\t\tbreak;\n\t\t\tcase 'array':\n\t\t\t\tpayload.concat(args[offset]);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new Error('Unknown argument type passed to .await(): ' + type);\n\t\t}\n\t});\n\t// }}}\n\n\tthis._struct.push({ type: 'await', payload: payload });\n\n\treturn this;\n};\n\n\n/**\n* Queue up a limit setter\n* @param int|null|false Either the number of defer processes that are allowed to execute simultaniously or falsy values to disable\n* @return object This chainable object\n*/\nfunction setLimit(setLimit) {\n\tthis._struct.push({ type: 'limit', payload: setLimit });\n\treturn this;\n};\n\n\n/**\n* Queue up a context setter\n* @param object newContext The new context to pass to all subsequent functions via `this`\n* @return object This chainable object\n*/\nfunction setContext(newContext) {\n\tthis._struct.push({ type: 'context', payload: newContext });\n\treturn this;\n};\n\n\n/**\n* Queue up a varable setter (i.e. set a hash of variables in context)\n* @param string The named key to set\n* @param mixed The value to set\n* @return object This chainable object\n*/\nfunction set() {\n\tvar calledAs = getOverload(arguments);\n\tswitch(calledAs) {\n\t\tcase '':\n\t\t\t// Pass\n\t\t\tbreak;\n\t\tcase 'string,string': // Form: set(String <key>, String <value>)\n\t\tcase 'string,number': // Form: set(String <key>, Number <value>)\n\t\tcase 'string,array': // Form: set(String <key>, Array <value>)\n\t\tcase 'string,collection': // Form: set(String <key>, Collection <value>)\n\t\tcase 'string,object': // Form: set(String <key>, Object <value>)\n\t\t\tvar payload = {};\n\t\t\tpayload[arguments[0]] = arguments[1];\n\t\t\tthis._struct.push({ type: 'set', payload: payload });\n\t\t\tbreak;\n\t\tcase 'object': // Form: set(Object)\n\t\t\tthis._struct.push({ type: 'set', payload: arguments[0] });\n\t\t\tbreak;\n\t\tcase 'function': // Form: set(func) -> series(func)\n\t\t\tthis._struct.push({ type: 'seriesArray', payload: [arguments[0]] });\n\t\t\tbreak;\n\t\tcase  'string,function': // Form: set(String, func) -> series(String <id>, func)\n\t\t\tvar payload = {};\n\t\t\tpayload[arguments[0]] = arguments[1];\n\t\t\tthis._struct.push({ type: 'seriesObject', payload: payload});\n\t\t\tbreak;\n\t\tcase 'string': // Set to undefined\n\t\t\tthis._setRaw(arguments[0], undefined);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tthrow new Error('Unknown call style for .set():' + calledAs);\n\t}\n\n\treturn this;\n};\n\n\n/**\n* Set a context items value\n* Not to be confused with `set()` which is the chainable external visible version of this\n* Unlike `set()` this function sets an item of _context immediately\n* @access private\n* @see _setRaw()\n*/\nfunction _set() {\n\tvar calledAs = getOverload(arguments);\n\tswitch(calledAs) {\n\t\tcase '':\n\t\t\t// Pass\n\t\t\tbreak;\n\t\tcase 'string,string': // Form: set(String <key>, String <value>)\n\t\tcase 'string,number': // Form: set(String <key>, Number <value>)\n\t\tcase 'string,array': // Form: set(String <key>, Array <value>)\n\t\tcase 'string,collection': // Form: set(String <key>, Collection <value>)\n\t\tcase 'string,object': // Form: set(String <key>, Object <value>)\n\t\t\tthis._setRaw(arguments[0], arguments[1]);\n\t\t\tbreak;\n\t\tcase 'object': // Form: set(Object)\n\t\t\tfor (var key in arguments[0])\n\t\t\t\tthis._setRaw(key, arguments[0][key]);\n\t\t\tbreak;\n\t\tcase  'string,function': // Form: set(String, func) -> series(String <id>, func)\n\t\t\tthis._setRaw(arguments[0], arguments[1].call(this));\n\t\t\tbreak;\n\t\tcase 'function': // Form: _set(func) // Expect func to return something which is then processed to _set\n\t\t\tthis._set(arguments[1].call(this));\n\t\t\tbreak;\n\t\tcase 'string': // Set to undefined\n\t\t\tthis._setRaw(arguments[0], undefined);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tthrow new Error('Unknown call style for .set():' + calledAs);\n\t}\n\n\treturn this;\n}\n\n\n/**\n* Actual raw value setter\n* This function is the internal version of _set which takes exactly two values, the key and the value to set\n* Override this function if some alternative _context platform is required\n* @param string key The key within _context to set the value of\n* @param mixed value The value within _context[key] to set the value of\n* @access private\n*/\nfunction _setRaw(key, value) {\n\tthis._context[key] = value;\n\treturn this;\n}\n\n\n/**\n* Internal function executed at the end of the chain\n* This can occur either in sequence (i.e. no errors) or a jump to this position (i.e. an error happened somewhere)\n* @access private\n*/\nfunction _finalize(err) {\n\t// Sanity checks {{{\n\tif (this._struct.length == 0) return; // Finalize called on dead object - probably a defer() fired without an await()\n\tif (this._struct[this._struct.length - 1].type != 'end') {\n\t\tthrow new Error('While trying to find an end point in the async-chainable structure the last item in the this._struct does not have type==end!');\n\t\treturn;\n\t}\n\t// }}}\n\tthis._struct[this._struct.length-1].payload.call(this._options.context, err);\n\tif (this._options.autoReset)\n\t\tthis.reset();\n};\n\n\n/**\n* Internal function to execute the next pending queue item\n* This is usually called after the completion of every async.series() / async.parallel() / asyncChainable._run call\n* @access private\n*/\nfunction _execute(err) {\n\tvar self = this;\n\tif (err) return this._finalize(err); // An error has been raised - stop exec and call finalize now\n\tdo {\n\t\tvar redo = false;\n\t\tif (self._structPointer >= self._struct.length) return this._finalize(err); // Nothing more to execute in struct\n\t\tself._deferCheck(); // Kick off any pending deferred items\n\t\tvar currentExec = self._struct[self._structPointer];\n\t\t// Sanity checks {{{\n\t\tif (!currentExec.type) {\n\t\t\tthrow new Error('No type is specified for async-chainable structure at offset ' + self._structPointer);\n\t\t\treturn self;\n\t\t}\n\t\t// }}}\n\t\tself._structPointer++;\n\n\t\t// Skip step when function supports skipping if the argument is empty {{{\n\t\tif (\n\t\t\t[\n\t\t\t\t'parallelArray', 'parallelObject', 'parallelCollection',\n\t\t\t\t'forEachArray', 'forEachObject',\n\t\t\t\t'seriesArray', 'seriesObject', 'seriesCollection',\n\t\t\t\t'deferArray', 'deferObject', 'deferCollection',\n\t\t\t\t'set'\n\t\t\t].indexOf(currentExec.type) > -1 &&\n\t\t\t(\n\t\t\t\t!currentExec.payload || // Not set OR\n\t\t\t\t(isArray(currentExec.payload) && !currentExec.payload.length) || // An empty array\n\t\t\t\t(isObject(currentExec.payload) && !Object.keys(currentExec.payload).length) // An empty object\n\t\t\t)\n\t\t) {\n\t\t\tcurrentExec.completed = true;\n\t\t\tredo = true;\n\t\t\tcontinue;\n\t\t}\n\t\t// }}}\n\n\t\tswitch (currentExec.type) {\n\t\t\tcase 'parallelArray':\n\t\t\t\tself._run(currentExec.payload.map(function(task) {\n\t\t\t\t\treturn function(next) {\n\t\t\t\t\t\ttask.call(self._options.context, next);\n\t\t\t\t\t};\n\t\t\t\t}), self._options.limit, function(err) {\n\t\t\t\t\tcurrentExec.completed = true;\n\t\t\t\t\tself._execute(err);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'parallelObject':\n\t\t\t\tvar tasks = [];\n\t\t\t\tObject.keys(currentExec.payload).forEach(function(key) {\n\t\t\t\t\ttasks.push(function(next) {\n\t\t\t\t\t\tcurrentExec.payload[key].call(self._options.context, function(err, value) {\n\t\t\t\t\t\t\tself._set(key, value); // Allocate returned value to context\n\t\t\t\t\t\t\tnext(err);\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tself._run(tasks, self._options.limit, function(err) {\n\t\t\t\t\tcurrentExec.completed = true;\n\t\t\t\t\tself._execute(err);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'parallelCollection':\n\t\t\t\tvar tasks = [];\n\t\t\t\tcurrentExec.payload.forEach(function(task) {\n\t\t\t\t\tObject.keys(task).forEach(function(key) {\n\t\t\t\t\t\ttasks.push(function(next, err) {\n\t\t\t\t\t\t\tif (typeof task[key] != 'function') throw new Error('Collection item for parallel exec is not a function', currentExec.payload);\n\t\t\t\t\t\t\ttask[key].call(self._options.context, function(err, value) {\n\t\t\t\t\t\t\t\tself._set(key, value); // Allocate returned value to context\n\t\t\t\t\t\t\t\tnext(err);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tself._run(tasks, self._options.limit, function(err) {\n\t\t\t\t\tcurrentExec.completed = true;\n\t\t\t\t\tself._execute(err);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'forEachArray':\n\t\t\t\tself._run(currentExec.payload.map(function(item, iter) {\n\t\t\t\t\tself._context._item = item;\n\t\t\t\t\tself._context._key = iter;\n\t\t\t\t\treturn function(next) {\n\t\t\t\t\t\tcurrentExec.callback.call(self._options.context, next, item, iter);\n\t\t\t\t\t};\n\t\t\t\t}), self._options.limit, function(err) {\n\t\t\t\t\tcurrentExec.completed = true;\n\t\t\t\t\tself._execute(err);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'forEachObject':\n\t\t\t\tvar tasks = [];\n\t\t\t\tObject.keys(currentExec.payload).forEach(function(key) {\n\t\t\t\t\ttasks.push(function(next) {\n\t\t\t\t\t\tself._context._item = currentExec.payload[key];\n\t\t\t\t\t\tself._context._key = key;\n\t\t\t\t\t\tcurrentExec.callback.call(self._options.context, function(err, value) {\n\t\t\t\t\t\t\tself._set(key, value); // Allocate returned value to context\n\t\t\t\t\t\t\tnext(err);\n\t\t\t\t\t\t}, currentExec.payload[key], key);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tself._run(tasks, self._options.limit, function(err) {\n\t\t\t\t\tcurrentExec.completed = true;\n\t\t\t\t\tself._execute(err);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'forEachLateBound':\n\t\t\t\tif (\n\t\t\t\t\t(!currentExec.payload || !currentExec.payload.length) || // Payload is blank\n\t\t\t\t\t(!self._context[currentExec.payload]) // Payload doesnt exist within context\n\t\t\t\t) { // Goto next chain\n\t\t\t\t\tcurrentExec.completed = true;\n\t\t\t\t\tredo = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t// Replace own exec array with actual type of payload now we know what it is {{{\n\t\t\t\tvar overloadType = getOverload([self._context[currentExec.payload]]);\n\t\t\t\tswitch (overloadType) {\n\t\t\t\t\tcase 'collection':\n\t\t\t\t\tcase 'array':\n\t\t\t\t\t\tcurrentExec.type = 'forEachArray';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'object':\n\t\t\t\t\t\tcurrentExec.type = 'forEachObject';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthrow new Error('Cannot perform forEach over unknown object type: ' + overloadType);\n\t\t\t\t}\n\t\t\t\tcurrentExec.payload = self._context[currentExec.payload];\n\t\t\t\tself._structPointer--; // Force re-eval of this chain item now its been replace with its real (late-bound) type\n\t\t\t\tredo = true;\n\t\t\t\t// }}}\n\t\t\t\tbreak;\n\t\t\tcase 'seriesArray':\n\t\t\t\tself._run(currentExec.payload.map(function(task) {\n\t\t\t\t\treturn function(next) {\n\t\t\t\t\t\ttask.call(self._options.context, next);\n\t\t\t\t\t};\n\t\t\t\t}), 1, function(err) {\n\t\t\t\t\tcurrentExec.completed = true;\n\t\t\t\t\tself._execute(err);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'seriesObject':\n\t\t\t\tvar tasks = [];\n\t\t\t\tObject.keys(currentExec.payload).forEach(function(key) {\n\t\t\t\t\ttasks.push(function(next) {\n\t\t\t\t\t\tcurrentExec.payload[key].call(self._options.context, function(err, value) {\n\t\t\t\t\t\t\tself._set(key, value); // Allocate returned value to context\n\t\t\t\t\t\t\tnext(err);\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tself._run(tasks, 1, function(err) {\n\t\t\t\t\tcurrentExec.completed = true;\n\t\t\t\t\tself._execute(err);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'seriesCollection':\n\t\t\t\tvar tasks = [];\n\t\t\t\tcurrentExec.payload.forEach(function(task) {\n\t\t\t\t\tObject.keys(task).forEach(function(key) {\n\t\t\t\t\t\ttasks.push(function(next, err) {\n\t\t\t\t\t\t\tif (typeof task[key] != 'function') throw new Error('Collection item for series exec is not a function', currentExec.payload);\n\t\t\t\t\t\t\ttask[key].call(self._options.context, function(err, value) {\n\t\t\t\t\t\t\t\tself._set(key, value); // Allocate returned value to context\n\t\t\t\t\t\t\t\tnext(err);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tself._run(tasks, 1, function(err) {\n\t\t\t\t\tcurrentExec.completed = true;\n\t\t\t\t\tself._execute(err);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'deferArray':\n\t\t\t\tcurrentExec.payload.forEach(function(task) {\n\t\t\t\t\tself._deferAdd(null, task, currentExec);\n\t\t\t\t});\n\n\t\t\t\tredo = true;\n\t\t\t\tbreak;\n\t\t\tcase 'deferObject':\n\t\t\t\tObject.keys(currentExec.payload).forEach(function(key) {\n\t\t\t\t\tself._deferAdd(key, currentExec.payload[key], currentExec);\n\t\t\t\t});\n\n\t\t\t\tredo = true;\n\t\t\t\tbreak;\n\t\t\tcase 'deferCollection':\n\t\t\t\tcurrentExec.payload.forEach(function(task) {\n\t\t\t\t\tObject.keys(task).forEach(function(key) {\n\t\t\t\t\t\tself._deferAdd(key, task[key], currentExec);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tredo = true;\n\t\t\t\tbreak;\n\t\t\tcase 'await': // Await can operate in two modes, either payload=[] (examine all) else (examine specific keys)\n\t\t\t\tif (!currentExec.payload.length) { // Check all tasks are complete\n\t\t\t\t\tif (self._struct.slice(0, self._structPointer - 1).every(function(stage) { // Examine all items UP TO self one and check they are complete\n\t\t\t\t\t\treturn stage.completed;\n\t\t\t\t\t})) { // All tasks up to self point are marked as completed\n\t\t\t\t\t\tcurrentExec.completed = true;\n\t\t\t\t\t\tredo = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself._structPointer--; // At least one task is outstanding - rewind to self stage so we repeat on next resolution\n\t\t\t\t\t}\n\t\t\t\t} else { // Check certain tasks are complete by key\n\t\t\t\t\tif (currentExec.payload.every(function(dep) { // Examine all named dependencies\n\t\t\t\t\t\treturn !! self._context[dep];\n\t\t\t\t\t})) { // All are present\n\t\t\t\t\t\tcurrentExec.completed = true;\n\t\t\t\t\t\tredo = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself._structPointer--; // At least one dependency is outstanding - rewind to self stage so we repeat on next resolution\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'limit': // Set the options.limit variable\n\t\t\t\tself._options.limit = currentExec.payload;\n\t\t\t\tcurrentExec.completed = true;\n\t\t\t\tredo = true; // Move on to next action\n\t\t\t\tbreak;\n\t\t\tcase 'context': // Change the self._options.context object\n\t\t\t\tself._options.context = currentExec.payload ? currentExec.payload : self._context; // Set context (if null use internal context)\n\t\t\t\tcurrentExec.completed = true;\n\t\t\t\tredo = true; // Move on to next action\n\t\t\t\tbreak;\n\t\t\tcase 'set': // Set a hash of variables within context\n\t\t\t\tObject.keys(currentExec.payload).forEach(function(key) {\n\t\t\t\t\tself._set(key, currentExec.payload[key]);\n\t\t\t\t});\n\t\t\t\tcurrentExec.completed = true;\n\t\t\t\tredo = true; // Move on to next action\n\t\t\t\tbreak;\n\t\t\tcase 'end': // self should ALWAYS be the last item in the structure and indicates the final function call\n\t\t\t\tthis._finalize();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tif (this._plugins[currentExec.type]) { // Is there a plugin that should manage this?\n\t\t\t\t\tthis._plugins[currentExec.type].call(this, currentExec);\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error('Unknown async-chainable exec type: ' + currentExec.type);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t}\n\t} while (redo);\n};\n\n\n/**\n* Internal function to run an array of functions (usually in parallel)\n* Series execution can be obtained by setting limit = 1\n* @param array tasks The array of tasks to execute\n* @param int limit The limiter of tasks (if limit==1 tasks are run in series, if limit>1 tasks are run in limited parallel, else tasks are run in parallel)\n* @param function callback(err) The callback to fire on finish\n*/\nfunction _run(tasks, limit, callback) {\n\tif (limit == 1) {\n\t\tasync.series(tasks, callback);\n\t} else if (limit > 0) {\n\t\tasync.parallelLimit(tasks, limit, callback);\n\t} else {\n\t\tasync.parallel(tasks, callback);\n\t}\n}\n\n\n/**\n* Reset all state variables and return the object into a pristine condition\n* @return object This chainable object\n*/\nfunction reset() {\n\tthis._struct = [];\n\tthis._structPointer = 0;\n\n\tvar reAttachContext = (this._options.context == this._context); // Reattach the context pointer after reset?\n\tthis._context = {\n\t\t_struct: this._struct,\n\t\t_structPointer: this._structPointer,\n\t\t_options: this._options,\n\t\t_deferredRunning: this._deferredRunning,\n\t};\n\n\tif (reAttachContext) this._options.context = this._context;\n};\n\n/**\n* Queue up an optional single function for execution on completion\n* This function also starts the queue executing\n* @return object This chainable object\n*/\nfunction end() { \n\tvar calledAs = getOverload(arguments);\n\tswitch (calledAs) {\n\t\tcase '': // No functions passed - do nothing\n\t\t\tthis._struct.push({ type: 'end', payload: function() {} }); // .end() called with no args - make a noop()\n\t\t\tbreak;\n\t\tcase 'function': // Form: end(func) -> redirect as if called with series(func)\n\t\t\tthis._struct.push({ type: 'end', payload: arguments[0] });\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tthrow new Error('Unknown call style for .end(): ' + calledAs);\n\t}\n\n\tthis._execute();\n\treturn this;\n};\n\nvar objectInstance = function() {\n\t// Variables {{{\n\tthis._struct = [];\n\tthis._structPointer = 0;\n\tthis._context = {};\n\n\tthis._options = {\n\t\tautoReset: true, // Run asyncChainable.reset() after finalize. Disable this if you want to see a post-mortem on what did run\n\t\tlimit: 10, // Number of defer functions that are allowed to execute at once\n\t\tcontext: this._context, // The context item passed to the functions (can be changed with .context())\n\t};\n\t// }}}\n\n\t// Async-Chainable functions {{{\n\t// Private {{{\n\tthis._execute = _execute;\n\tthis._run = _run;\n\tthis._deferCheck = _deferCheck;\n\tthis._deferAdd = deferAdd;\n\tthis._deferred = [];\n\tthis._deferredRunning = 0;\n\tthis._finalize = _finalize;\n\tthis._getOverload = getOverload; // So this function is accessible by plugins\n\tthis._plugins = _plugins;\n\t// }}}\n\n\tthis.await = await;\n\tthis.context = setContext;\n\tthis.defer = defer;\n\tthis.end = end;\n\tthis.forEach = forEach;\n\tthis.limit = setLimit;\n\tthis.parallel = parallel;\n\tthis.reset = reset;\n\tthis.series = series;\n\tthis.set = set;\n\tthis._set = _set;\n\tthis._setRaw = _setRaw;\n\tthis.then = series;\n\tthis.new = function() { return new objectInstance };\n\tthis.use = use;\n\t// }}}\n\n\t// Async compat functionality - so this module becomes a drop-in replacement {{{\n\t// Collections\n\tthis.each = async.each;\n\tthis.eachSeries = async.eachSeries;\n\tthis.eachLimit = async.eachLimit;\n\tthis.map = async.map;\n\tthis.mapSeries = async.mapSeries;\n\tthis.mapLimit = async.mapLimit;\n\tthis.filter = async.filter;\n\tthis.filterSeries = async.filterSeries;\n\tthis.reject = async.reject;\n\tthis.rejectSeries = async.rejectSeries;\n\tthis.reduce = async.reduce;\n\tthis.reduceRight = async.reduceRight;\n\tthis.detect = async.detect;\n\tthis.detectSeries = async.detectSeries;\n\tthis.sortBy = async.sortBy;\n\tthis.some = async.some;\n\tthis.every = async.every;\n\tthis.concat = async.concat;\n\tthis.concatSeries = async.concatSeries;\n\n\t// Control Flow\n\t// See main .series() and .parallel() code for async compatibility\n\tthis.parallelLimit = async.parallelLimit;\n\tthis.whilst = async.whilst;\n\tthis.doWhilst = async.doWhilst;\n\tthis.until = async.until;\n\tthis.doUntil = async.doUntil;\n\tthis.forever = async.forever;\n\tthis.waterfall = async.waterfall;\n\tthis.compose = async.compose;\n\tthis.seq = async.seq;\n\tthis.applyEach = async.applyEach;\n\tthis.applyEachSeries = async.applyEachSeries;\n\tthis.queue = async.queue;\n\tthis.priorityQueue = async.priorityQueue;\n\tthis.cargo = async.cargo;\n\tthis.auto = async.auto;\n\tthis.retry = async.retry;\n\tthis.iterator = async.iterator;\n\tthis.apply = async.apply;\n\tthis.nextTick = async.nextTick;\n\tthis.times = async.times;\n\tthis.timesSeries = async.timesSeries;\n\tthis.Utils = async.Utils;\n\n\t// Utils\n\tthis.memoize = async.memoize;\n\tthis.unmemoize = async.unmemoize;\n\tthis.log = async.log;\n\tthis.dir = async.dir;\n\tthis.noConflict = async.noConflict;\n\t// }}}\n\n\tthis.reset();\n\treturn this;\n}\n\n// Return the output object\nmodule.exports = function asyncChainable() {\n\treturn new objectInstance;\n};\n\n},{\"async\":2}],2:[function(require,module,exports){\n(function (process,global){\n/*!\n * async\n * https://github.com/caolan/async\n *\n * Copyright 2010-2014 Caolan McMahon\n * Released under the MIT license\n */\n(function () {\n\n    var async = {};\n    function noop() {}\n    function identity(v) {\n        return v;\n    }\n    function toBool(v) {\n        return !!v;\n    }\n    function notId(v) {\n        return !v;\n    }\n\n    // global on the server, window in the browser\n    var previous_async;\n\n    // Establish the root object, `window` (`self`) in the browser, `global`\n    // on the server, or `this` in some virtual machines. We use `self`\n    // instead of `window` for `WebWorker` support.\n    var root = typeof self === 'object' && self.self === self && self ||\n            typeof global === 'object' && global.global === global && global ||\n            this;\n\n    if (root != null) {\n        previous_async = root.async;\n    }\n\n    async.noConflict = function () {\n        root.async = previous_async;\n        return async;\n    };\n\n    function only_once(fn) {\n        return function() {\n            if (fn === null) throw new Error(\"Callback was already called.\");\n            fn.apply(this, arguments);\n            fn = null;\n        };\n    }\n\n    function _once(fn) {\n        return function() {\n            if (fn === null) return;\n            fn.apply(this, arguments);\n            fn = null;\n        };\n    }\n\n    //// cross-browser compatiblity functions ////\n\n    var _toString = Object.prototype.toString;\n\n    var _isArray = Array.isArray || function (obj) {\n        return _toString.call(obj) === '[object Array]';\n    };\n\n    // Ported from underscore.js isObject\n    var _isObject = function(obj) {\n        var type = typeof obj;\n        return type === 'function' || type === 'object' && !!obj;\n    };\n\n    function _isArrayLike(arr) {\n        return _isArray(arr) || (\n            // has a positive integer length property\n            typeof arr.length === \"number\" &&\n            arr.length >= 0 &&\n            arr.length % 1 === 0\n        );\n    }\n\n    function _each(coll, iterator) {\n        return _isArrayLike(coll) ?\n            _arrayEach(coll, iterator) :\n            _forEachOf(coll, iterator);\n    }\n\n    function _arrayEach(arr, iterator) {\n        var index = -1,\n            length = arr.length;\n\n        while (++index < length) {\n            iterator(arr[index], index, arr);\n        }\n    }\n\n    function _map(arr, iterator) {\n        var index = -1,\n            length = arr.length,\n            result = Array(length);\n\n        while (++index < length) {\n            result[index] = iterator(arr[index], index, arr);\n        }\n        return result;\n    }\n\n    function _range(count) {\n        return _map(Array(count), function (v, i) { return i; });\n    }\n\n    function _reduce(arr, iterator, memo) {\n        _arrayEach(arr, function (x, i, a) {\n            memo = iterator(memo, x, i, a);\n        });\n        return memo;\n    }\n\n    function _forEachOf(object, iterator) {\n        _arrayEach(_keys(object), function (key) {\n            iterator(object[key], key);\n        });\n    }\n\n    function _indexOf(arr, item) {\n        for (var i = 0; i < arr.length; i++) {\n            if (arr[i] === item) return i;\n        }\n        return -1;\n    }\n\n    var _keys = Object.keys || function (obj) {\n        var keys = [];\n        for (var k in obj) {\n            if (obj.hasOwnProperty(k)) {\n                keys.push(k);\n            }\n        }\n        return keys;\n    };\n\n    function _keyIterator(coll) {\n        var i = -1;\n        var len;\n        var keys;\n        if (_isArrayLike(coll)) {\n            len = coll.length;\n            return function next() {\n                i++;\n                return i < len ? i : null;\n            };\n        } else {\n            keys = _keys(coll);\n            len = keys.length;\n            return function next() {\n                i++;\n                return i < len ? keys[i] : null;\n            };\n        }\n    }\n\n    // Similar to ES6's rest param (http://ariya.ofilabs.com/2013/03/es6-and-rest-parameter.html)\n    // This accumulates the arguments passed into an array, after a given index.\n    // From underscore.js (https://github.com/jashkenas/underscore/pull/2140).\n    function _restParam(func, startIndex) {\n        startIndex = startIndex == null ? func.length - 1 : +startIndex;\n        return function() {\n            var length = Math.max(arguments.length - startIndex, 0);\n            var rest = Array(length);\n            for (var index = 0; index < length; index++) {\n                rest[index] = arguments[index + startIndex];\n            }\n            switch (startIndex) {\n                case 0: return func.call(this, rest);\n                case 1: return func.call(this, arguments[0], rest);\n            }\n            // Currently unused but handle cases outside of the switch statement:\n            // var args = Array(startIndex + 1);\n            // for (index = 0; index < startIndex; index++) {\n            //     args[index] = arguments[index];\n            // }\n            // args[startIndex] = rest;\n            // return func.apply(this, args);\n        };\n    }\n\n    function _withoutIndex(iterator) {\n        return function (value, index, callback) {\n            return iterator(value, callback);\n        };\n    }\n\n    //// exported async module functions ////\n\n    //// nextTick implementation with browser-compatible fallback ////\n\n    // capture the global reference to guard against fakeTimer mocks\n    var _setImmediate = typeof setImmediate === 'function' && setImmediate;\n\n    var _delay = _setImmediate ? function(fn) {\n        // not a direct alias for IE10 compatibility\n        _setImmediate(fn);\n    } : function(fn) {\n        setTimeout(fn, 0);\n    };\n\n    if (typeof process === 'object' && typeof process.nextTick === 'function') {\n        async.nextTick = process.nextTick;\n    } else {\n        async.nextTick = _delay;\n    }\n    async.setImmediate = _setImmediate ? _delay : async.nextTick;\n\n\n    async.forEach =\n    async.each = function (arr, iterator, callback) {\n        return async.eachOf(arr, _withoutIndex(iterator), callback);\n    };\n\n    async.forEachSeries =\n    async.eachSeries = function (arr, iterator, callback) {\n        return async.eachOfSeries(arr, _withoutIndex(iterator), callback);\n    };\n\n\n    async.forEachLimit =\n    async.eachLimit = function (arr, limit, iterator, callback) {\n        return _eachOfLimit(limit)(arr, _withoutIndex(iterator), callback);\n    };\n\n    async.forEachOf =\n    async.eachOf = function (object, iterator, callback) {\n        callback = _once(callback || noop);\n        object = object || [];\n        var size = _isArrayLike(object) ? object.length : _keys(object).length;\n        var completed = 0;\n        if (!size) {\n            return callback(null);\n        }\n        _each(object, function (value, key) {\n            iterator(object[key], key, only_once(done));\n        });\n        function done(err) {\n            if (err) {\n                callback(err);\n            }\n            else {\n                completed += 1;\n                if (completed >= size) {\n                    callback(null);\n                }\n            }\n        }\n    };\n\n    async.forEachOfSeries =\n    async.eachOfSeries = function (obj, iterator, callback) {\n        callback = _once(callback || noop);\n        obj = obj || [];\n        var nextKey = _keyIterator(obj);\n        var key = nextKey();\n        function iterate() {\n            var sync = true;\n            if (key === null) {\n                return callback(null);\n            }\n            iterator(obj[key], key, only_once(function (err) {\n                if (err) {\n                    callback(err);\n                }\n                else {\n                    key = nextKey();\n                    if (key === null) {\n                        return callback(null);\n                    } else {\n                        if (sync) {\n                            async.nextTick(iterate);\n                        } else {\n                            iterate();\n                        }\n                    }\n                }\n            }));\n            sync = false;\n        }\n        iterate();\n    };\n\n\n\n    async.forEachOfLimit =\n    async.eachOfLimit = function (obj, limit, iterator, callback) {\n        _eachOfLimit(limit)(obj, iterator, callback);\n    };\n\n    function _eachOfLimit(limit) {\n\n        return function (obj, iterator, callback) {\n            callback = _once(callback || noop);\n            obj = obj || [];\n            var nextKey = _keyIterator(obj);\n            if (limit <= 0) {\n                return callback(null);\n            }\n            var done = false;\n            var running = 0;\n            var errored = false;\n\n            (function replenish () {\n                if (done && running <= 0) {\n                    return callback(null);\n                }\n\n                while (running < limit && !errored) {\n                    var key = nextKey();\n                    if (key === null) {\n                        done = true;\n                        if (running <= 0) {\n                            callback(null);\n                        }\n                        return;\n                    }\n                    running += 1;\n                    iterator(obj[key], key, only_once(function (err) {\n                        running -= 1;\n                        if (err) {\n                            callback(err);\n                            errored = true;\n                        }\n                        else {\n                            replenish();\n                        }\n                    }));\n                }\n            })();\n        };\n    }\n\n\n    function doParallel(fn) {\n        return function (obj, iterator, callback) {\n            return fn(async.eachOf, obj, iterator, callback);\n        };\n    }\n    function doParallelLimit(fn) {\n        return function (obj, limit, iterator, callback) {\n            return fn(_eachOfLimit(limit), obj, iterator, callback);\n        };\n    }\n    function doSeries(fn) {\n        return function (obj, iterator, callback) {\n            return fn(async.eachOfSeries, obj, iterator, callback);\n        };\n    }\n\n    function _asyncMap(eachfn, arr, iterator, callback) {\n        callback = _once(callback || noop);\n        var results = [];\n        eachfn(arr, function (value, index, callback) {\n            iterator(value, function (err, v) {\n                results[index] = v;\n                callback(err);\n            });\n        }, function (err) {\n            callback(err, results);\n        });\n    }\n\n    async.map = doParallel(_asyncMap);\n    async.mapSeries = doSeries(_asyncMap);\n    async.mapLimit = doParallelLimit(_asyncMap);\n\n    // reduce only has a series version, as doing reduce in parallel won't\n    // work in many situations.\n    async.inject =\n    async.foldl =\n    async.reduce = function (arr, memo, iterator, callback) {\n        async.eachOfSeries(arr, function (x, i, callback) {\n            iterator(memo, x, function (err, v) {\n                memo = v;\n                callback(err);\n            });\n        }, function (err) {\n            callback(err || null, memo);\n        });\n    };\n\n    async.foldr =\n    async.reduceRight = function (arr, memo, iterator, callback) {\n        var reversed = _map(arr, identity).reverse();\n        async.reduce(reversed, memo, iterator, callback);\n    };\n\n    function _filter(eachfn, arr, iterator, callback) {\n        var results = [];\n        eachfn(arr, function (x, index, callback) {\n            iterator(x, function (v) {\n                if (v) {\n                    results.push({index: index, value: x});\n                }\n                callback();\n            });\n        }, function () {\n            callback(_map(results.sort(function (a, b) {\n                return a.index - b.index;\n            }), function (x) {\n                return x.value;\n            }));\n        });\n    }\n\n    async.select =\n    async.filter = doParallel(_filter);\n\n    async.selectLimit =\n    async.filterLimit = doParallelLimit(_filter);\n\n    async.selectSeries =\n    async.filterSeries = doSeries(_filter);\n\n    function _reject(eachfn, arr, iterator, callback) {\n        _filter(eachfn, arr, function(value, cb) {\n            iterator(value, function(v) {\n                cb(!v);\n            });\n        }, callback);\n    }\n    async.reject = doParallel(_reject);\n    async.rejectLimit = doParallelLimit(_reject);\n    async.rejectSeries = doSeries(_reject);\n\n    function _createTester(eachfn, check, getResult) {\n        return function(arr, limit, iterator, cb) {\n            function done() {\n                if (cb) cb(getResult(false, void 0));\n            }\n            function iteratee(x, _, callback) {\n                if (!cb) return callback();\n                iterator(x, function (v) {\n                    if (cb && check(v)) {\n                        cb(getResult(true, x));\n                        cb = iterator = false;\n                    }\n                    callback();\n                });\n            }\n            if (arguments.length > 3) {\n                eachfn(arr, limit, iteratee, done);\n            } else {\n                cb = iterator;\n                iterator = limit;\n                eachfn(arr, iteratee, done);\n            }\n        };\n    }\n\n    async.any =\n    async.some = _createTester(async.eachOf, toBool, identity);\n\n    async.someLimit = _createTester(async.eachOfLimit, toBool, identity);\n\n    async.all =\n    async.every = _createTester(async.eachOf, notId, notId);\n\n    async.everyLimit = _createTester(async.eachOfLimit, notId, notId);\n\n    function _findGetResult(v, x) {\n        return x;\n    }\n    async.detect = _createTester(async.eachOf, identity, _findGetResult);\n    async.detectSeries = _createTester(async.eachOfSeries, identity, _findGetResult);\n    async.detectLimit = _createTester(async.eachOfLimit, identity, _findGetResult);\n\n    async.sortBy = function (arr, iterator, callback) {\n        async.map(arr, function (x, callback) {\n            iterator(x, function (err, criteria) {\n                if (err) {\n                    callback(err);\n                }\n                else {\n                    callback(null, {value: x, criteria: criteria});\n                }\n            });\n        }, function (err, results) {\n            if (err) {\n                return callback(err);\n            }\n            else {\n                callback(null, _map(results.sort(comparator), function (x) {\n                    return x.value;\n                }));\n            }\n\n        });\n\n        function comparator(left, right) {\n            var a = left.criteria, b = right.criteria;\n            return a < b ? -1 : a > b ? 1 : 0;\n        }\n    };\n\n    async.auto = function (tasks, callback) {\n        callback = _once(callback || noop);\n        var keys = _keys(tasks);\n        var remainingTasks = keys.length;\n        if (!remainingTasks) {\n            return callback(null);\n        }\n\n        var results = {};\n\n        var listeners = [];\n        function addListener(fn) {\n            listeners.unshift(fn);\n        }\n        function removeListener(fn) {\n            var idx = _indexOf(listeners, fn);\n            if (idx >= 0) listeners.splice(idx, 1);\n        }\n        function taskComplete() {\n            remainingTasks--;\n            _arrayEach(listeners.slice(0), function (fn) {\n                fn();\n            });\n        }\n\n        addListener(function () {\n            if (!remainingTasks) {\n                callback(null, results);\n            }\n        });\n\n        _arrayEach(keys, function (k) {\n            var task = _isArray(tasks[k]) ? tasks[k]: [tasks[k]];\n            var taskCallback = _restParam(function(err, args) {\n                if (args.length <= 1) {\n                    args = args[0];\n                }\n                if (err) {\n                    var safeResults = {};\n                    _forEachOf(results, function(val, rkey) {\n                        safeResults[rkey] = val;\n                    });\n                    safeResults[k] = args;\n                    callback(err, safeResults);\n                }\n                else {\n                    results[k] = args;\n                    async.setImmediate(taskComplete);\n                }\n            });\n            var requires = task.slice(0, task.length - 1);\n            // prevent dead-locks\n            var len = requires.length;\n            var dep;\n            while (len--) {\n                if (!(dep = tasks[requires[len]])) {\n                    throw new Error('Has inexistant dependency');\n                }\n                if (_isArray(dep) && _indexOf(dep, k) >= 0) {\n                    throw new Error('Has cyclic dependencies');\n                }\n            }\n            function ready() {\n                return _reduce(requires, function (a, x) {\n                    return (a && results.hasOwnProperty(x));\n                }, true) && !results.hasOwnProperty(k);\n            }\n            if (ready()) {\n                task[task.length - 1](taskCallback, results);\n            }\n            else {\n                addListener(listener);\n            }\n            function listener() {\n                if (ready()) {\n                    removeListener(listener);\n                    task[task.length - 1](taskCallback, results);\n                }\n            }\n        });\n    };\n\n\n\n    async.retry = function(times, task, callback) {\n        var DEFAULT_TIMES = 5;\n        var DEFAULT_INTERVAL = 0;\n\n        var attempts = [];\n\n        var opts = {\n            times: DEFAULT_TIMES,\n            interval: DEFAULT_INTERVAL\n        };\n\n        function parseTimes(acc, t){\n            if(typeof t === 'number'){\n                acc.times = parseInt(t, 10) || DEFAULT_TIMES;\n            } else if(typeof t === 'object'){\n                acc.times = parseInt(t.times, 10) || DEFAULT_TIMES;\n                acc.interval = parseInt(t.interval, 10) || DEFAULT_INTERVAL;\n            } else {\n                throw new Error('Unsupported argument type for \\'times\\': ' + typeof t);\n            }\n        }\n\n        var length = arguments.length;\n        if (length < 1 || length > 3) {\n            throw new Error('Invalid arguments - must be either (task), (task, callback), (times, task) or (times, task, callback)');\n        } else if (length <= 2 && typeof times === 'function') {\n            callback = task;\n            task = times;\n        }\n        if (typeof times !== 'function') {\n            parseTimes(opts, times);\n        }\n        opts.callback = callback;\n        opts.task = task;\n\n        function wrappedTask(wrappedCallback, wrappedResults) {\n            function retryAttempt(task, finalAttempt) {\n                return function(seriesCallback) {\n                    task(function(err, result){\n                        seriesCallback(!err || finalAttempt, {err: err, result: result});\n                    }, wrappedResults);\n                };\n            }\n\n            function retryInterval(interval){\n                return function(seriesCallback){\n                    setTimeout(function(){\n                        seriesCallback(null);\n                    }, interval);\n                };\n            }\n\n            while (opts.times) {\n\n                var finalAttempt = !(opts.times-=1);\n                attempts.push(retryAttempt(opts.task, finalAttempt));\n                if(!finalAttempt && opts.interval > 0){\n                    attempts.push(retryInterval(opts.interval));\n                }\n            }\n\n            async.series(attempts, function(done, data){\n                data = data[data.length - 1];\n                (wrappedCallback || opts.callback)(data.err, data.result);\n            });\n        }\n\n        // If a callback is passed, run this as a controll flow\n        return opts.callback ? wrappedTask() : wrappedTask;\n    };\n\n    async.waterfall = function (tasks, callback) {\n        callback = _once(callback || noop);\n        if (!_isArray(tasks)) {\n            var err = new Error('First argument to waterfall must be an array of functions');\n            return callback(err);\n        }\n        if (!tasks.length) {\n            return callback();\n        }\n        function wrapIterator(iterator) {\n            return _restParam(function (err, args) {\n                if (err) {\n                    callback.apply(null, [err].concat(args));\n                }\n                else {\n                    var next = iterator.next();\n                    if (next) {\n                        args.push(wrapIterator(next));\n                    }\n                    else {\n                        args.push(callback);\n                    }\n                    ensureAsync(iterator).apply(null, args);\n                }\n            });\n        }\n        wrapIterator(async.iterator(tasks))();\n    };\n\n    function _parallel(eachfn, tasks, callback) {\n        callback = callback || noop;\n        var results = _isArrayLike(tasks) ? [] : {};\n\n        eachfn(tasks, function (task, key, callback) {\n            task(_restParam(function (err, args) {\n                if (args.length <= 1) {\n                    args = args[0];\n                }\n                results[key] = args;\n                callback(err);\n            }));\n        }, function (err) {\n            callback(err, results);\n        });\n    }\n\n    async.parallel = function (tasks, callback) {\n        _parallel(async.eachOf, tasks, callback);\n    };\n\n    async.parallelLimit = function(tasks, limit, callback) {\n        _parallel(_eachOfLimit(limit), tasks, callback);\n    };\n\n    async.series = function(tasks, callback) {\n        _parallel(async.eachOfSeries, tasks, callback);\n    };\n\n    async.iterator = function (tasks) {\n        function makeCallback(index) {\n            function fn() {\n                if (tasks.length) {\n                    tasks[index].apply(null, arguments);\n                }\n                return fn.next();\n            }\n            fn.next = function () {\n                return (index < tasks.length - 1) ? makeCallback(index + 1): null;\n            };\n            return fn;\n        }\n        return makeCallback(0);\n    };\n\n    async.apply = _restParam(function (fn, args) {\n        return _restParam(function (callArgs) {\n            return fn.apply(\n                null, args.concat(callArgs)\n            );\n        });\n    });\n\n    function _concat(eachfn, arr, fn, callback) {\n        var result = [];\n        eachfn(arr, function (x, index, cb) {\n            fn(x, function (err, y) {\n                result = result.concat(y || []);\n                cb(err);\n            });\n        }, function (err) {\n            callback(err, result);\n        });\n    }\n    async.concat = doParallel(_concat);\n    async.concatSeries = doSeries(_concat);\n\n    async.whilst = function (test, iterator, callback) {\n        callback = callback || noop;\n        if (test()) {\n            var next = _restParam(function(err, args) {\n                if (err) {\n                    callback(err);\n                } else if (test.apply(this, args)) {\n                    iterator(next);\n                } else {\n                    callback(null);\n                }\n            });\n            iterator(next);\n        } else {\n            callback(null);\n        }\n    };\n\n    async.doWhilst = function (iterator, test, callback) {\n        var calls = 0;\n        return async.whilst(function() {\n            return ++calls <= 1 || test.apply(this, arguments);\n        }, iterator, callback);\n    };\n\n    async.until = function (test, iterator, callback) {\n        return async.whilst(function() {\n            return !test.apply(this, arguments);\n        }, iterator, callback);\n    };\n\n    async.doUntil = function (iterator, test, callback) {\n        return async.doWhilst(iterator, function() {\n            return !test.apply(this, arguments);\n        }, callback);\n    };\n\n    async.during = function (test, iterator, callback) {\n        callback = callback || noop;\n\n        var next = _restParam(function(err, args) {\n            if (err) {\n                callback(err);\n            } else {\n                args.push(check);\n                test.apply(this, args);\n            }\n        });\n\n        var check = function(err, truth) {\n            if (err) {\n                callback(err);\n            } else if (truth) {\n                iterator(next);\n            } else {\n                callback(null);\n            }\n        };\n\n        test(check);\n    };\n\n    async.doDuring = function (iterator, test, callback) {\n        var calls = 0;\n        async.during(function(next) {\n            if (calls++ < 1) {\n                next(null, true);\n            } else {\n                test.apply(this, arguments);\n            }\n        }, iterator, callback);\n    };\n\n    function _queue(worker, concurrency, payload) {\n        if (concurrency == null) {\n            concurrency = 1;\n        }\n        else if(concurrency === 0) {\n            throw new Error('Concurrency must not be zero');\n        }\n        function _insert(q, data, pos, callback) {\n            if (callback != null && typeof callback !== \"function\") {\n                throw new Error(\"task callback must be a function\");\n            }\n            q.started = true;\n            if (!_isArray(data)) {\n                data = [data];\n            }\n            if(data.length === 0 && q.idle()) {\n                // call drain immediately if there are no tasks\n                return async.setImmediate(function() {\n                    q.drain();\n                });\n            }\n            _arrayEach(data, function(task) {\n                var item = {\n                    data: task,\n                    callback: callback || noop\n                };\n\n                if (pos) {\n                    q.tasks.unshift(item);\n                } else {\n                    q.tasks.push(item);\n                }\n\n                if (q.tasks.length === q.concurrency) {\n                    q.saturated();\n                }\n            });\n            async.setImmediate(q.process);\n        }\n        function _next(q, tasks) {\n            return function(){\n                workers -= 1;\n                var args = arguments;\n                _arrayEach(tasks, function (task) {\n                    task.callback.apply(task, args);\n                });\n                if (q.tasks.length + workers === 0) {\n                    q.drain();\n                }\n                q.process();\n            };\n        }\n\n        var workers = 0;\n        var q = {\n            tasks: [],\n            concurrency: concurrency,\n            payload: payload,\n            saturated: noop,\n            empty: noop,\n            drain: noop,\n            started: false,\n            paused: false,\n            push: function (data, callback) {\n                _insert(q, data, false, callback);\n            },\n            kill: function () {\n                q.drain = noop;\n                q.tasks = [];\n            },\n            unshift: function (data, callback) {\n                _insert(q, data, true, callback);\n            },\n            process: function () {\n                if (!q.paused && workers < q.concurrency && q.tasks.length) {\n                    while(workers < q.concurrency && q.tasks.length){\n                        var tasks = q.payload ?\n                            q.tasks.splice(0, q.payload) :\n                            q.tasks.splice(0, q.tasks.length);\n\n                        var data = _map(tasks, function (task) {\n                            return task.data;\n                        });\n\n                        if (q.tasks.length === 0) {\n                            q.empty();\n                        }\n                        workers += 1;\n                        var cb = only_once(_next(q, tasks));\n                        worker(data, cb);\n                    }\n                }\n            },\n            length: function () {\n                return q.tasks.length;\n            },\n            running: function () {\n                return workers;\n            },\n            idle: function() {\n                return q.tasks.length + workers === 0;\n            },\n            pause: function () {\n                q.paused = true;\n            },\n            resume: function () {\n                if (q.paused === false) { return; }\n                q.paused = false;\n                var resumeCount = Math.min(q.concurrency, q.tasks.length);\n                // Need to call q.process once per concurrent\n                // worker to preserve full concurrency after pause\n                for (var w = 1; w <= resumeCount; w++) {\n                    async.setImmediate(q.process);\n                }\n            }\n        };\n        return q;\n    }\n\n    async.queue = function (worker, concurrency) {\n        var q = _queue(function (items, cb) {\n            worker(items[0], cb);\n        }, concurrency, 1);\n\n        return q;\n    };\n\n    async.priorityQueue = function (worker, concurrency) {\n\n        function _compareTasks(a, b){\n            return a.priority - b.priority;\n        }\n\n        function _binarySearch(sequence, item, compare) {\n            var beg = -1,\n                end = sequence.length - 1;\n            while (beg < end) {\n                var mid = beg + ((end - beg + 1) >>> 1);\n                if (compare(item, sequence[mid]) >= 0) {\n                    beg = mid;\n                } else {\n                    end = mid - 1;\n                }\n            }\n            return beg;\n        }\n\n        function _insert(q, data, priority, callback) {\n            if (callback != null && typeof callback !== \"function\") {\n                throw new Error(\"task callback must be a function\");\n            }\n            q.started = true;\n            if (!_isArray(data)) {\n                data = [data];\n            }\n            if(data.length === 0) {\n                // call drain immediately if there are no tasks\n                return async.setImmediate(function() {\n                    q.drain();\n                });\n            }\n            _arrayEach(data, function(task) {\n                var item = {\n                    data: task,\n                    priority: priority,\n                    callback: typeof callback === 'function' ? callback : noop\n                };\n\n                q.tasks.splice(_binarySearch(q.tasks, item, _compareTasks) + 1, 0, item);\n\n                if (q.tasks.length === q.concurrency) {\n                    q.saturated();\n                }\n                async.setImmediate(q.process);\n            });\n        }\n\n        // Start with a normal queue\n        var q = async.queue(worker, concurrency);\n\n        // Override push to accept second parameter representing priority\n        q.push = function (data, priority, callback) {\n            _insert(q, data, priority, callback);\n        };\n\n        // Remove unshift function\n        delete q.unshift;\n\n        return q;\n    };\n\n    async.cargo = function (worker, payload) {\n        return _queue(worker, 1, payload);\n    };\n\n    function _console_fn(name) {\n        return _restParam(function (fn, args) {\n            fn.apply(null, args.concat([_restParam(function (err, args) {\n                if (typeof console === 'object') {\n                    if (err) {\n                        if (console.error) {\n                            console.error(err);\n                        }\n                    }\n                    else if (console[name]) {\n                        _arrayEach(args, function (x) {\n                            console[name](x);\n                        });\n                    }\n                }\n            })]));\n        });\n    }\n    async.log = _console_fn('log');\n    async.dir = _console_fn('dir');\n    /*async.info = _console_fn('info');\n    async.warn = _console_fn('warn');\n    async.error = _console_fn('error');*/\n\n    async.memoize = function (fn, hasher) {\n        var memo = {};\n        var queues = {};\n        hasher = hasher || identity;\n        var memoized = _restParam(function memoized(args) {\n            var callback = args.pop();\n            var key = hasher.apply(null, args);\n            if (key in memo) {\n                async.nextTick(function () {\n                    callback.apply(null, memo[key]);\n                });\n            }\n            else if (key in queues) {\n                queues[key].push(callback);\n            }\n            else {\n                queues[key] = [callback];\n                fn.apply(null, args.concat([_restParam(function (args) {\n                    memo[key] = args;\n                    var q = queues[key];\n                    delete queues[key];\n                    for (var i = 0, l = q.length; i < l; i++) {\n                        q[i].apply(null, args);\n                    }\n                })]));\n            }\n        });\n        memoized.memo = memo;\n        memoized.unmemoized = fn;\n        return memoized;\n    };\n\n    async.unmemoize = function (fn) {\n        return function () {\n            return (fn.unmemoized || fn).apply(null, arguments);\n        };\n    };\n\n    function _times(mapper) {\n        return function (count, iterator, callback) {\n            mapper(_range(count), iterator, callback);\n        };\n    }\n\n    async.times = _times(async.map);\n    async.timesSeries = _times(async.mapSeries);\n    async.timesLimit = function (count, limit, iterator, callback) {\n        return async.mapLimit(_range(count), limit, iterator, callback);\n    };\n\n    async.seq = function (/* functions... */) {\n        var fns = arguments;\n        return _restParam(function (args) {\n            var that = this;\n\n            var callback = args[args.length - 1];\n            if (typeof callback == 'function') {\n                args.pop();\n            } else {\n                callback = noop;\n            }\n\n            async.reduce(fns, args, function (newargs, fn, cb) {\n                fn.apply(that, newargs.concat([_restParam(function (err, nextargs) {\n                    cb(err, nextargs);\n                })]));\n            },\n            function (err, results) {\n                callback.apply(that, [err].concat(results));\n            });\n        });\n    };\n\n    async.compose = function (/* functions... */) {\n        return async.seq.apply(null, Array.prototype.reverse.call(arguments));\n    };\n\n\n    function _applyEach(eachfn) {\n        return _restParam(function(fns, args) {\n            var go = _restParam(function(args) {\n                var that = this;\n                var callback = args.pop();\n                return eachfn(fns, function (fn, _, cb) {\n                    fn.apply(that, args.concat([cb]));\n                },\n                callback);\n            });\n            if (args.length) {\n                return go.apply(this, args);\n            }\n            else {\n                return go;\n            }\n        });\n    }\n\n    async.applyEach = _applyEach(async.eachOf);\n    async.applyEachSeries = _applyEach(async.eachOfSeries);\n\n\n    async.forever = function (fn, callback) {\n        var done = only_once(callback || noop);\n        var task = ensureAsync(fn);\n        function next(err) {\n            if (err) {\n                return done(err);\n            }\n            task(next);\n        }\n        next();\n    };\n\n    function ensureAsync(fn) {\n        return _restParam(function (args) {\n            var callback = args.pop();\n            args.push(function () {\n                var innerArgs = arguments;\n                if (sync) {\n                    async.setImmediate(function () {\n                        callback.apply(null, innerArgs);\n                    });\n                } else {\n                    callback.apply(null, innerArgs);\n                }\n            });\n            var sync = true;\n            fn.apply(this, args);\n            sync = false;\n        });\n    }\n\n    async.ensureAsync = ensureAsync;\n\n    async.constant = _restParam(function(values) {\n        var args = [null].concat(values);\n        return function (callback) {\n            return callback.apply(this, args);\n        };\n    });\n\n    async.wrapSync =\n    async.asyncify = function asyncify(func) {\n        return _restParam(function (args) {\n            var callback = args.pop();\n            var result;\n            try {\n                result = func.apply(this, args);\n            } catch (e) {\n                return callback(e);\n            }\n            // if result is Promise object\n            if (_isObject(result) && typeof result.then === \"function\") {\n                result.then(function(value) {\n                    callback(null, value);\n                })[\"catch\"](function(err) {\n                    callback(err.message ? err : new Error(err));\n                });\n            } else {\n                callback(null, result);\n            }\n        });\n    };\n\n    // Node.js\n    if (typeof module === 'object' && module.exports) {\n        module.exports = async;\n    }\n    // AMD / RequireJS\n    else if (typeof define === 'function' && define.amd) {\n        define([], function () {\n            return async;\n        });\n    }\n    // included directly via <script> tag\n    else {\n        root.async = async;\n    }\n\n}());\n\n}).call(this,require('_process'),typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{\"_process\":3}],3:[function(require,module,exports){\n// shim for using process in browser\n\nvar process = module.exports = {};\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = setTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            currentQueue[queueIndex].run();\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    clearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        setTimeout(drainQueue, 0);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\n// TODO(shtylman)\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n},{}]},{},[1])(1)\n});\n//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvYXN5bmMtY2hhaW5hYmxlL2luZGV4LmpzIiwibm9kZV9tb2R1bGVzL2FzeW5jLWNoYWluYWJsZS9ub2RlX21vZHVsZXMvYXN5bmMvbGliL2FzeW5jLmpzIiwibm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL3Byb2Nlc3MvYnJvd3Nlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDaDRCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDdHNDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJ2YXIgYXN5bmMgPSByZXF1aXJlKCdhc3luYycpO1xuXG4vKipcbiogRXhhbWluZXMgYW4gYXJndW1lbnQgc3RhY2sgYW5kIHJldHVybnMgYWxsIHBhc3NlZCBhcmd1bWVudHMgYXMgYSBDU1ZcbiogZS5nLlxuKlx0ZnVuY3Rpb24gdGVzdCAoKSB7IGdldE92ZXJsb2FkKGFyZ3VtZW50cykgfTtcbipcdHRlc3QoJ2hlbGxvJywgJ3dvcmxkJykgLy8gJ3N0cmluZyxzdHJpbmcnXG4qXHR0ZXN0KGZ1bmN0aW9uKCkge30sIDEpIC8vICdmdW5jdGlvbixudW1iZXInXG4qXHR0ZXN0KCdoZWxsbycsIDEyMywge2ZvbzogJ2Jhcid9LCBbJ2JheiddLCBbe3F1ejogJ3F1elZhbHVlJ30sIHtxdXV6OiAncXV1elZhbHVlJ31dKSAvLyAnc3RyaW5nLG51bWJlcixvYmplY3QsYXJyYXksY29sbGVjdGlvbidcbipcbiogQHBhcmFtIG9iamVjdCBhcmdzIFRoZSBzcGVjaWFsIEphdmFTY3JpcHQgJ2FyZ3VtZW50cycgb2JqZWN0XG4qIEByZXR1cm4gc3RyaW5nIENTViBvZiBhbGwgcGFzc2VkIGFyZ3VtZW50c1xuKi9cbmZ1bmN0aW9uIGdldE92ZXJsb2FkKGFyZ3MpIHtcblx0dmFyIGkgPSAwO1xuXHR2YXIgb3V0ID0gW107XG5cdHdoaWxlKDEpIHtcblx0XHR2YXIgYXJnVHlwZSA9IHR5cGVvZiBhcmdzW2ldO1xuXHRcdGlmIChhcmdUeXBlID09ICd1bmRlZmluZWQnKSBicmVhaztcblx0XHRpZiAoYXJnVHlwZSA9PSAnb2JqZWN0JyAmJiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYXJnc1tpXSkgPT0gJ1tvYmplY3QgQXJyYXldJykgeyAvLyBTcGVjaWFsIGNhc2UgZm9yIGFycmF5cyBiZWluZyBjbGFzc2VkIGFzIG9iamVjdHNcblx0XHRcdGFyZ1R5cGUgPSAnYXJyYXknO1xuXHRcdFx0aWYgKGFyZ3NbaV0ubGVuZ3RoICYmIGFyZ3NbaV0uZXZlcnkoZnVuY3Rpb24oaXRlbSkge1xuXHRcdFx0XHRyZXR1cm4gKHR5cGVvZiBpdGVtID09ICdvYmplY3QnICYmIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpdGVtKSA9PSAnW29iamVjdCBPYmplY3RdJyk7XG5cdFx0XHR9KSlcblx0XHRcdFx0YXJnVHlwZSA9ICdjb2xsZWN0aW9uJztcblx0XHR9XG5cdFx0b3V0LnB1c2goYXJnVHlwZSk7XG5cdFx0aSsrO1xuXHR9XG5cdHJldHVybiBvdXQudG9TdHJpbmcoKTtcbn07XG5cbi8vIFV0aWxpdHkgZnVuY3Rpb25zIHt7e1xuLyoqXG4qIFJldHVybiB0cnVlIGlmIGEgdmFyaWFibGUgaXMgYW4gYXJyYXlcbiogQHBhcmFtIG1peGVkIHRoaW5nIFRoZSB2YXJhYmxlIHRvIGV4YW1pbmVcbiogQHJldHVybiBib29sIFRydWUgaWYgdGhlIGl0ZW0gaXMgYSBjbGFzc2ljIEpTIGFycmF5IGFuZCBub3QgYW4gb2JqZWN0XG4qL1xuZnVuY3Rpb24gaXNBcnJheSh0aGluZykge1xuXHRyZXR1cm4gKFxuXHRcdHR5cGVvZiB0aGluZyA9PSAnb2JqZWN0JyAmJlxuXHRcdE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh0aGluZykgPT0gJ1tvYmplY3QgQXJyYXldJ1xuXHQpO1xufVxuXG5cbi8qKlxuKiBSZXR1cm4gdHJ1ZSBpZiBhIHZhcmlhYmxlIGlzIGFuIG9iamVjdFxuKiBAcGFyYW0gbWl4ZWQgdGhpbmcgVGhlIHZhcmFibGUgdG8gZXhhbWluZVxuKiBAcmV0dXJuIGJvb2wgVHJ1ZSBpZiB0aGUgaXRlbSBpcyBhIGNsYXNzaWMgSlMgYXJyYXkgYW5kIG5vdCBhbiBvYmplY3RcbiovXG5mdW5jdGlvbiBpc09iamVjdCh0aGluZykge1xuXHRyZXR1cm4gKFxuXHRcdHR5cGVvZiB0aGluZyA9PSAnb2JqZWN0JyAmJlxuXHRcdE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh0aGluZykgIT0gJ1tvYmplY3QgQXJyYXldJ1xuXHQpO1xufVxuLy8gfX19XG5cbi8vIFBsdWdpbiBmdW5jdGlvbmFsaXR5IC0gdmlhIGB1c2UoKWBcbnZhciBfcGx1Z2lucyA9IHt9O1xuZnVuY3Rpb24gdXNlKG1vZHVsZSkge1xuXHRtb2R1bGUuY2FsbCh0aGlzKTtcblx0cmV0dXJuIHRoaXM7XG59O1xuLy8gfX19XG5cbi8qKlxuKiBRdWV1ZSB1cCBhIGZ1bmN0aW9uKHMpIHRvIGV4ZWN1dGUgaW4gc2VyaWVzXG4qIEBwYXJhbSBhcnJheSxvYmplY3QsZnVuY3Rpb24gVGhlIGZ1bmN0aW9uKHMpIHRvIGV4ZWN1dGVcbiogQHJldHVybiBvYmplY3QgVGhpcyBjaGFpbmFibGUgb2JqZWN0XG4qL1xuZnVuY3Rpb24gc2VyaWVzKCkge1xuXHR2YXIgY2FsbGVkQXMgPSBnZXRPdmVybG9hZChhcmd1bWVudHMpO1xuXHRzd2l0Y2goY2FsbGVkQXMpIHtcblx0XHRjYXNlICcnOlxuXHRcdFx0Ly8gUGFzc1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSAnZnVuY3Rpb24nOiAvLyBGb3JtOiBzZXJpZXMoZnVuYylcblx0XHRcdHRoaXMuX3N0cnVjdC5wdXNoKHsgdHlwZTogJ3Nlcmllc0FycmF5JywgcGF5bG9hZDogW2FyZ3VtZW50c1swXV0gfSk7XG5cdFx0XHRicmVhaztcblx0XHRjYXNlICAnc3RyaW5nLGZ1bmN0aW9uJzogLy8gRm9ybTogc2VyaWVzKFN0cmluZyA8aWQ+LCBmdW5jKVxuXHRcdFx0dmFyIHBheWxvYWQgPSB7fTtcblx0XHRcdHBheWxvYWRbYXJndW1lbnRzWzBdXSA9IGFyZ3VtZW50c1sxXTtcblx0XHRcdHRoaXMuX3N0cnVjdC5wdXNoKHsgdHlwZTogJ3Nlcmllc09iamVjdCcsIHBheWxvYWQ6IHBheWxvYWR9KTtcblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgJ2FycmF5JzogLy8gRm9ybTogc2VyaWVzKEFycmF5IDxmdW5jcz4pXG5cdFx0XHR0aGlzLl9zdHJ1Y3QucHVzaCh7IHR5cGU6ICdzZXJpZXNBcnJheScsIHBheWxvYWQ6IGFyZ3VtZW50c1swXSB9KTtcblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgJ29iamVjdCc6IC8vIEZvcm06IHNlcmllcyhPYmplY3QgPGZ1bmNzPilcblx0XHRcdHRoaXMuX3N0cnVjdC5wdXNoKHsgdHlwZTogJ3Nlcmllc09iamVjdCcsIHBheWxvYWQ6IGFyZ3VtZW50c1swXSB9KTtcblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgJ2NvbGxlY3Rpb24nOiAvLyBGb3JtOiBzZXJpZXMoQ29sbGVjdGlvbiA8ZnVuY3M+KVxuXHRcdFx0dGhpcy5fc3RydWN0LnB1c2goeyB0eXBlOiAnc2VyaWVzQ29sbGVjdGlvbicsIHBheWxvYWQ6IGFyZ3VtZW50c1swXSB9KTtcblx0XHRcdGJyZWFrO1xuXG5cdFx0Ly8gQXN5bmMgbGlicmFyeSBjb21wYXRpYmlsaXR5IHt7e1xuXHRcdGNhc2UgJ2FycmF5LGZ1bmN0aW9uJzpcblx0XHRcdHRoaXMuX3N0cnVjdC5wdXNoKHsgdHlwZTogJ3Nlcmllc0FycmF5JywgcGF5bG9hZDogYXJndW1lbnRzWzBdIH0pO1xuXHRcdFx0dGhpcy5lbmQoYXJndW1lbnRzWzFdKTtcblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgJ29iamVjdCxmdW5jdGlvbic6XG5cdFx0XHR0aGlzLl9zdHJ1Y3QucHVzaCh7IHR5cGU6ICdzZXJpZXNPYmplY3QnLCBwYXlsb2FkOiBhcmd1bWVudHNbMF0gfSk7XG5cdFx0XHR0aGlzLmVuZChhcmd1bWVudHNbMV0pO1xuXHRcdFx0YnJlYWs7XG5cdFx0Ly8gfX19XG5cdFx0ZGVmYXVsdDpcblx0XHRcdHRocm93IG5ldyBFcnJvcignVW5rbm93biBjYWxsIHN0eWxlIGZvciAuc2VyaWVzKCk6ICcgKyBjYWxsZWRBcyk7XG5cdH1cblxuXHRyZXR1cm4gdGhpcztcbn07XG5cblxuLyoqXG4qIFF1ZXVlIHVwIGEgZnVuY3Rpb24ocykgdG8gZXhlY3V0ZSBpbiBwYXJhbGxlbFxuKiBAcGFyYW0gYXJyYXksb2JqZWN0LGZ1bmN0aW9uIFRoZSBmdW5jdGlvbihzKSB0byBleGVjdXRlXG4qIEByZXR1cm4gb2JqZWN0IFRoaXMgY2hhaW5hYmxlIG9iamVjdFxuKi9cbmZ1bmN0aW9uIHBhcmFsbGVsKCkge1xuXHR2YXIgY2FsbGVkQXMgPSBnZXRPdmVybG9hZChhcmd1bWVudHMpXG5cdHN3aXRjaCAoY2FsbGVkQXMpIHtcblx0XHRjYXNlICcnOlxuXHRcdFx0Ly8gUGFzc1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSAnZnVuY3Rpb24nOiAvLyBGb3JtOiBwYXJhbGxlbChmdW5jKVxuXHRcdFx0dGhpcy5fc3RydWN0LnB1c2goeyB0eXBlOiAncGFyYWxsZWxBcnJheScsIHBheWxvYWQ6IFthcmd1bWVudHNbMF1dIH0pO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSAnc3RyaW5nLGZ1bmN0aW9uJzogLy8gRm9ybTogcGFyYWxsZWwoU3RyaW5nIDxpZD4sIGZ1bmMpXG5cdFx0XHR2YXIgcGF5bG9hZCA9IHt9O1xuXHRcdFx0cGF5bG9hZFthcmd1bWVudHNbMF1dID0gYXJndW1lbnRzWzFdO1xuXHRcdFx0dGhpcy5fc3RydWN0LnB1c2goeyB0eXBlOiAncGFyYWxsZWxBcnJheScsIHBheWxvYWQ6IHBheWxvYWQgfSk7XG5cdFx0XHRicmVhaztcblx0XHRjYXNlICdhcnJheSc6IC8vIEZvcm06IHBhcmFsbGVsKEFycmF5IDxmdW5jcz4pXG5cdFx0XHR0aGlzLl9zdHJ1Y3QucHVzaCh7IHR5cGU6ICdwYXJhbGxlbEFycmF5JywgcGF5bG9hZDogYXJndW1lbnRzWzBdIH0pO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSAnb2JqZWN0JzogLy8gRm9ybTogcGFyYWxsZWwoT2JqZWN0IDxmdW5jcz4pXG5cdFx0XHR0aGlzLl9zdHJ1Y3QucHVzaCh7IHR5cGU6ICdwYXJhbGxlbE9iamVjdCcsIHBheWxvYWQ6IGFyZ3VtZW50c1swXSB9KTtcblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgJ2NvbGxlY3Rpb24nOiAvLyBGb3JtOiBwYXJhbGxlbChDb2xsZWN0aW9uIDxmdW5jcz4pXG5cdFx0XHR0aGlzLl9zdHJ1Y3QucHVzaCh7IHR5cGU6ICdwYXJhbGxlbENvbGxlY3Rpb24nLCBwYXlsb2FkOiBhcmd1bWVudHNbMF0gfSk7XG5cdFx0XHRicmVhaztcblxuXHRcdC8vIEFzeW5jIGxpYnJhcnkgY29tcGF0aWJpbGl0eSB7e3tcblx0XHRjYXNlICdhcnJheSxmdW5jdGlvbic6XG5cdFx0XHR0aGlzLl9zdHJ1Y3QucHVzaCh7IHR5cGU6ICdwYXJhbGxlbEFycmF5JywgcGF5bG9hZDogYXJndW1lbnRzWzBdIH0pO1xuXHRcdFx0dGhpcy5lbmQoYXJndW1lbnRzWzFdKTtcblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgJ29iamVjdCxmdW5jdGlvbic6XG5cdFx0XHR0aGlzLl9zdHJ1Y3QucHVzaCh7IHR5cGU6ICdwYXJhbGxlbE9iamVjdCcsIHBheWxvYWQ6IGFyZ3VtZW50c1swXSB9KTtcblx0XHRcdHRoaXMuZW5kKGFyZ3VtZW50c1sxXSk7XG5cdFx0XHRicmVhaztcblx0XHQvLyB9fX1cblx0XHRkZWZhdWx0OlxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCdVbmtub3duIGNhbGwgc3R5bGUgZm9yIC5wYXJhbGxlbCgpOiAnICsgY2FsbGVkQXMpO1xuXHR9XG5cblx0cmV0dXJuIHRoaXM7XG59O1xuXG5cbi8qKlxuKiBSdW4gYW4gYXJyYXkvb2JqZWN0L2NvbGxlY3Rpb24gdGhvdWdoIGEgZnVuY3Rpb25cbiogVGhpcyBpcyBzaW1pbGFyIHRvIHRoZSBhc3luYyBuYXRpdmUgLmVhY2goKSBmdW5jdGlvbiBidXQgY2hhaW5hYmxlXG4qL1xuZnVuY3Rpb24gZm9yRWFjaCgpIHtcblx0dmFyIGNhbGxlZEFzID0gZ2V0T3ZlcmxvYWQoYXJndW1lbnRzKVxuXHRzd2l0Y2ggKGNhbGxlZEFzKSB7XG5cdFx0Y2FzZSAnJzpcblx0XHRcdC8vIFBhc3Ncblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgJ2NvbGxlY3Rpb24sZnVuY3Rpb24nOiAvLyBGb3JtOiBmb3JFYWNoKENvbGxlY3Rpb24gZnVuYylcblx0XHRjYXNlICdhcnJheSxmdW5jdGlvbic6IC8vIEZvcm06IGZvckVhY2goQXJyYXksIGZ1bmMpXG5cdFx0XHR0aGlzLl9zdHJ1Y3QucHVzaCh7IHR5cGU6ICdmb3JFYWNoQXJyYXknLCBwYXlsb2FkOiBhcmd1bWVudHNbMF0sIGNhbGxiYWNrOiBhcmd1bWVudHNbMV0gfSk7XG5cdFx0XHRicmVhaztcblx0XHRjYXNlICdvYmplY3QsZnVuY3Rpb24nOiAvLyBGb3JtOiBmb3JFYWNoKE9iamVjdCwgZnVuYylcblx0XHRcdHRoaXMuX3N0cnVjdC5wdXNoKHsgdHlwZTogJ2ZvckVhY2hPYmplY3QnLCBwYXlsb2FkOiBhcmd1bWVudHNbMF0sIGNhbGxiYWNrOiBhcmd1bWVudHNbMV0gfSk7XG5cdFx0XHRicmVhaztcblx0XHRjYXNlICdzdHJpbmcsZnVuY3Rpb24nOiAvLyBGb3JtOiBmb3JFYWNoKFN0cmluZyA8c2V0IGxvb2t1cD4sIGZ1bmMpXG5cdFx0XHR0aGlzLl9zdHJ1Y3QucHVzaCh7IHR5cGU6ICdmb3JFYWNoTGF0ZUJvdW5kJywgcGF5bG9hZDogYXJndW1lbnRzWzBdLCBjYWxsYmFjazogYXJndW1lbnRzWzFdIH0pO1xuXHRcdFx0YnJlYWs7XG5cdFx0ZGVmYXVsdDpcblx0XHRcdHRocm93IG5ldyBFcnJvcignVW5rbm93biBjYWxsIHN0eWxlIGZvciAuZm9yRWFjaCgpOiAnICsgY2FsbGVkQXMpO1xuXHR9XG5cblx0cmV0dXJuIHRoaXM7XG59XG5cblxuLy8gRGVmZXIgZnVuY3Rpb25hbGl0eSAtIEhlcmUgYmUgZHJhZ29ucyEge3t7XG4vKipcbiogQ29sbGVjdGlvbiBvZiBpdGVtcyB0aGF0IGhhdmUgYmVlbiBkZWZlcnJlZFxuKiBAdHlwZSBjb2xsZWN0aW9uIHtwYXlsb2FkOiBmdW5jdGlvbiwgaWQ6IG51bGx8U3RyaW5nLCBwcmVyZXE6IFtkZXAxLCBkZXAyLi4uXX1cbiogQGFjY2VzcyBwcml2YXRlXG4qL1xuZnVuY3Rpb24gZGVmZXJBZGQoaWQsIHRhc2ssIHBhcmVudENoYWluKSB7XG5cdHZhciBzZWxmID0gdGhpcztcblx0cGFyZW50Q2hhaW4ud2FpdGluZ09uID0gKHBhcmVudENoYWluLndhaXRpbmdPbiB8fCAwKSArIDE7XG5cblx0aWYgKCEgcGFyZW50Q2hhaW4ud2FpdGluZ09uSWRzKVxuXHRcdHBhcmVudENoYWluLndhaXRpbmdPbklkcyA9IFtdO1xuXHRwYXJlbnRDaGFpbi53YWl0aW5nT25JZHMucHVzaChpZCk7XG5cblx0c2VsZi5fZGVmZXJyZWQucHVzaCh7XG5cdFx0aWQ6IGlkIHx8IG51bGwsXG5cdFx0cHJlcmVxOiBwYXJlbnRDaGFpbi5wcmVyZXEgfHwgW10sXG5cdFx0cGF5bG9hZDogZnVuY3Rpb24obmV4dCkge1xuXHRcdFx0c2VsZi5fY29udGV4dC5faWQgPSBpZDtcblx0XHRcdHRhc2suY2FsbChzZWxmLl9vcHRpb25zLmNvbnRleHQsIGZ1bmN0aW9uKGVyciwgdmFsdWUpIHtcblx0XHRcdFx0aWYgKGlkKVxuXHRcdFx0XHRcdHNlbGYuX2NvbnRleHRbaWRdID0gdmFsdWU7XG5cdFx0XHRcdHNlbGYuX2RlZmVycmVkUnVubmluZy0tO1xuXHRcdFx0XHRpZiAoLS1wYXJlbnRDaGFpbi53YWl0aW5nT24gPT0gMCkge1xuXHRcdFx0XHRcdHBhcmVudENoYWluLmNvbXBsZXRlZCA9IHRydWU7XG5cdFx0XHRcdFx0aWYgKHNlbGYuX3N0cnVjdC5sZW5ndGggJiYgc2VsZi5fc3RydWN0W3NlbGYuX3N0cnVjdFBvaW50ZXJdLnR5cGUgPT0gJ2F3YWl0Jylcblx0XHRcdFx0XHRcdHNlbGYuX2V4ZWN1dGUoZXJyKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRzZWxmLl9leGVjdXRlKGVycik7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH0pO1xufTtcblxuXG5mdW5jdGlvbiBfZGVmZXJDaGVjaygpIHtcblx0dmFyIHNlbGYgPSB0aGlzO1xuXHRpZiAoc2VsZi5fb3B0aW9ucy5saW1pdCAmJiBzZWxmLl9kZWZlcnJlZFJ1bm5pbmcgPj0gc2VsZi5fb3B0aW9ucy5saW1pdCkgcmV0dXJuOyAvLyBBbHJlYWR5IG92ZXIgbGltaXRcblx0c2VsZi5fZGVmZXJyZWQgPSBzZWxmLl9kZWZlcnJlZC5maWx0ZXIoZnVuY3Rpb24oaXRlbSkge1xuXHRcdGlmIChzZWxmLl9vcHRpb25zLmxpbWl0ICYmIHNlbGYuX2RlZmVycmVkUnVubmluZyA+PSBzZWxmLl9vcHRpb25zLmxpbWl0KSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZTsgLy8gQWxyZWFkeSBvdmVyIGxpbWl0IC0gYWxsIHN1YnNlcWVudCBpdGVtcyBzaG91bGQgYmUgbGVmdCBpbiBwbGFjZVxuXHRcdH1cblx0XHRpZiAoXG5cdFx0XHRpdGVtLnByZXJlcS5sZW5ndGggPT0gMCB8fCAvLyBObyBwcmUtcmVxcyAtIGNhbiBleGVjdXRlIG5vd1xuXHRcdFx0aXRlbS5wcmVyZXEuZXZlcnkoZnVuY3Rpb24oZGVwKSB7IC8vIEFsbCBwcmUtcmVxcyBhcmUgc2F0aXNmaWVkXG5cdFx0XHRcdHJldHVybiBzZWxmLl9jb250ZXh0Lmhhc093blByb3BlcnR5KGRlcCk7XG5cdFx0XHR9KVxuXHRcdCkgeyBcblx0XHRcdHNlbGYuX2RlZmVycmVkUnVubmluZysrO1xuXHRcdFx0c2V0VGltZW91dChpdGVtLnBheWxvYWQpO1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH0gZWxzZSB7IC8vIENhbid0IGRvIGFueXRoaW5nIHdpdGggc2VsZiByaWdodCBub3dcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH1cblx0fSk7XG59O1xuLy8gfX19XG5cblxuLyoqXG4qIFF1ZXVlIHVwIGEgZnVuY3Rpb24ocykgdG8gZXhlY3V0ZSBhcyBkZWZlcnJlZCAtIGkuZS4gZG9udCBzdG9wIHRvIHdhaXQgZm9yIGl0XG4qIEBwYXJhbSBhcnJheSxvYmplY3QsZnVuY3Rpb24gVGhlIGZ1bmN0aW9uKHMpIHRvIGV4ZWN1dGUgYXMgYSBkZWZlclxuKiBAcmV0dXJuIG9iamVjdCBUaGlzIGNoYWluYWJsZSBvYmplY3RcbiovXG5mdW5jdGlvbiBkZWZlcigpIHtcblx0dmFyIGNhbGxlZEFzID0gZ2V0T3ZlcmxvYWQoYXJndW1lbnRzKTtcblx0c3dpdGNoIChjYWxsZWRBcykge1xuXHRcdGNhc2UgJyc6XG5cdFx0XHQvLyBQYXNzXG5cdFx0XHRicmVhaztcblx0XHRjYXNlICdmdW5jdGlvbic6IC8vIEZvcm06IGRlZmVyKGZ1bmMpXG5cdFx0XHR0aGlzLl9zdHJ1Y3QucHVzaCh7IHR5cGU6ICdkZWZlckFycmF5JywgcGF5bG9hZDogW2FyZ3VtZW50c1swXV0gfSk7XG5cdFx0XHRicmVhaztcblx0XHRjYXNlICdzdHJpbmcsZnVuY3Rpb24nOiAvLyBGb3JtOiBkZWZlcihTdHJpbmcgPGlkPiwgZnVuYylcblx0XHRcdHZhciBwYXlsb2FkID0ge307XG5cdFx0XHRwYXlsb2FkW2FyZ3VtZW50c1swXV0gPSBhcmd1bWVudHNbMV07XG5cdFx0XHR0aGlzLl9zdHJ1Y3QucHVzaCh7IHR5cGU6ICdkZWZlck9iamVjdCcsIHBheWxvYWQ6IHBheWxvYWQgfSk7XG5cdFx0XHRicmVhaztcblx0XHRjYXNlICdhcnJheSc6IC8vIEZvcm06IGRlZmVyKEFycmF5IDxmdW5jcz4pXG5cdFx0XHR0aGlzLl9zdHJ1Y3QucHVzaCh7IHR5cGU6ICdkZWZlckFycmF5JywgcGF5bG9hZDogYXJndW1lbnRzWzBdIH0pO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSAnb2JqZWN0JzogLy8gRm9ybTogZGVmZXIoT2JqZWN0IDxmdW5jcz4pXG5cdFx0XHR0aGlzLl9zdHJ1Y3QucHVzaCh7IHR5cGU6ICdkZWZlck9iamVjdCcsIHBheWxvYWQ6IGFyZ3VtZW50c1swXSB9KTtcblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgJ2NvbGxlY3Rpb24nOiAvLyBGb3JtIGRlZmVyKENvbGxlY3Rpb24gPGZ1bmNzPilcblx0XHRcdHRoaXMuX3N0cnVjdC5wdXNoKHsgdHlwZTogJ2RlZmVyQ29sbGVjdGlvbicsIHBheWxvYWQ6IGFyZ3VtZW50c1swXSB9KTtcblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgJ2FycmF5LGZ1bmN0aW9uJzogLy8gRm9ybTogZGVmZXIoQXJyYXkgPHByZXJlcXM+LCBmdW5jKVxuXHRcdFx0dGhpcy5fc3RydWN0LnB1c2goeyB0eXBlOiAnZGVmZXJPYmplY3QnLCBwcmVyZXE6IGFyZ3VtZW50c1swXSwgcGF5bG9hZDogeycnOiBhcmd1bWVudHNbMV19IH0pO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSAnc3RyaW5nLHN0cmluZyxmdW5jdGlvbic6IC8vIEZvcm06IGRlZmVyKFN0cmluZyA8cHJlcmVxPiwgU3RyaW5nIDxuYW1lPiwgZnVuYylcblx0XHRcdHZhciBwYXlsb2FkID0ge307XG5cdFx0XHRwYXlsb2FkW2FyZ3VtZW50c1sxXV0gPSBhcmd1bWVudHNbMl07XG5cdFx0XHR0aGlzLl9zdHJ1Y3QucHVzaCh7IHR5cGU6ICdkZWZlck9iamVjdCcsIHByZXJlcTogW2FyZ3VtZW50c1swXV0sIHBheWxvYWQ6IHBheWxvYWQgfSk7XG5cdFx0XHRicmVhaztcblx0XHRjYXNlICdhcnJheSxzdHJpbmcsZnVuY3Rpb24nOiAvL0Zvcm06IGRlZmVyKEFycmF5IDxwcmVyZXFzPiwgU3RyaW5nIDxpZD4sIGZ1bmMpXG5cdFx0XHR2YXIgcGF5bG9hZCA9IHt9O1xuXHRcdFx0cGF5bG9hZFthcmd1bWVudHNbMV1dID0gYXJndW1lbnRzWzJdO1xuXHRcdFx0dGhpcy5fc3RydWN0LnB1c2goeyB0eXBlOiAnZGVmZXJPYmplY3QnLCBwcmVyZXE6IGFyZ3VtZW50c1swXSwgcGF5bG9hZDogcGF5bG9hZCB9KTtcblx0XHRcdGJyZWFrO1xuXHRcdGRlZmF1bHQ6XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gY2FsbCBzdHlsZSBmb3IgLmRlZmVyKCk6JyArIGNhbGxlZEFzKTtcblx0fVxuXG5cdHJldHVybiB0aGlzO1xufTtcblxuXG4vKipcbiogUXVldWUgdXAgYW4gYXdhaXQgcG9pbnRcbiogVGhpcyBzdG9wcyB0aGUgZXhlY3V0aW9uIHF1ZXVlIHVudGlsIGl0cyBzYXRpc2ZpZWQgdGhhdCBkZXBlbmRlbmNpZXMgaGF2ZSBiZWVuIHJlc29sdmVkXG4qIEBwYXJhbSBhcnJheSwuLi4gVGhlIGRlcGVuZGVuY2llcyB0byBjaGVjayByZXNvbHV0aW9uIG9mLiBJZiBvbWl0dGVkIGFsbCBhcmUgY2hlY2tlZFxuKiBAcmV0dXJuIG9iamVjdCBUaGlzIGNoYWluYWJsZSBvYmplY3RcbiovXG5mdW5jdGlvbiBhd2FpdCgpIHtcblx0dmFyIHBheWxvYWQgPSBbXTtcblxuXHQvLyBTbHVycCBhbGwgYXJncyBpbnRvIHBheWxvYWQge3t7XG5cdHZhciBhcmdzID0gYXJndW1lbnRzO1xuXHRnZXRPdmVybG9hZChhcmd1bWVudHMpLnNwbGl0KCcsJykuZm9yRWFjaChmdW5jdGlvbih0eXBlLCBvZmZzZXQpIHtcblx0XHRzd2l0Y2ggKHR5cGUpIHtcblx0XHRcdGNhc2UgJyc6IC8vIEJsYW5rIGFyZ3VtZW50cyAtIGRvIG5vdGhpbmdcblx0XHRcdFx0Ly8gUGFzc1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgJ3N0cmluZyc6XG5cdFx0XHRcdHBheWxvYWQucHVzaChhcmdzW29mZnNldF0pO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgJ2FycmF5Jzpcblx0XHRcdFx0cGF5bG9hZC5jb25jYXQoYXJnc1tvZmZzZXRdKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gYXJndW1lbnQgdHlwZSBwYXNzZWQgdG8gLmF3YWl0KCk6ICcgKyB0eXBlKTtcblx0XHR9XG5cdH0pO1xuXHQvLyB9fX1cblxuXHR0aGlzLl9zdHJ1Y3QucHVzaCh7IHR5cGU6ICdhd2FpdCcsIHBheWxvYWQ6IHBheWxvYWQgfSk7XG5cblx0cmV0dXJuIHRoaXM7XG59O1xuXG5cbi8qKlxuKiBRdWV1ZSB1cCBhIGxpbWl0IHNldHRlclxuKiBAcGFyYW0gaW50fG51bGx8ZmFsc2UgRWl0aGVyIHRoZSBudW1iZXIgb2YgZGVmZXIgcHJvY2Vzc2VzIHRoYXQgYXJlIGFsbG93ZWQgdG8gZXhlY3V0ZSBzaW11bHRhbmlvdXNseSBvciBmYWxzeSB2YWx1ZXMgdG8gZGlzYWJsZVxuKiBAcmV0dXJuIG9iamVjdCBUaGlzIGNoYWluYWJsZSBvYmplY3RcbiovXG5mdW5jdGlvbiBzZXRMaW1pdChzZXRMaW1pdCkge1xuXHR0aGlzLl9zdHJ1Y3QucHVzaCh7IHR5cGU6ICdsaW1pdCcsIHBheWxvYWQ6IHNldExpbWl0IH0pO1xuXHRyZXR1cm4gdGhpcztcbn07XG5cblxuLyoqXG4qIFF1ZXVlIHVwIGEgY29udGV4dCBzZXR0ZXJcbiogQHBhcmFtIG9iamVjdCBuZXdDb250ZXh0IFRoZSBuZXcgY29udGV4dCB0byBwYXNzIHRvIGFsbCBzdWJzZXF1ZW50IGZ1bmN0aW9ucyB2aWEgYHRoaXNgXG4qIEByZXR1cm4gb2JqZWN0IFRoaXMgY2hhaW5hYmxlIG9iamVjdFxuKi9cbmZ1bmN0aW9uIHNldENvbnRleHQobmV3Q29udGV4dCkge1xuXHR0aGlzLl9zdHJ1Y3QucHVzaCh7IHR5cGU6ICdjb250ZXh0JywgcGF5bG9hZDogbmV3Q29udGV4dCB9KTtcblx0cmV0dXJuIHRoaXM7XG59O1xuXG5cbi8qKlxuKiBRdWV1ZSB1cCBhIHZhcmFibGUgc2V0dGVyIChpLmUuIHNldCBhIGhhc2ggb2YgdmFyaWFibGVzIGluIGNvbnRleHQpXG4qIEBwYXJhbSBzdHJpbmcgVGhlIG5hbWVkIGtleSB0byBzZXRcbiogQHBhcmFtIG1peGVkIFRoZSB2YWx1ZSB0byBzZXRcbiogQHJldHVybiBvYmplY3QgVGhpcyBjaGFpbmFibGUgb2JqZWN0XG4qL1xuZnVuY3Rpb24gc2V0KCkge1xuXHR2YXIgY2FsbGVkQXMgPSBnZXRPdmVybG9hZChhcmd1bWVudHMpO1xuXHRzd2l0Y2goY2FsbGVkQXMpIHtcblx0XHRjYXNlICcnOlxuXHRcdFx0Ly8gUGFzc1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSAnc3RyaW5nLHN0cmluZyc6IC8vIEZvcm06IHNldChTdHJpbmcgPGtleT4sIFN0cmluZyA8dmFsdWU+KVxuXHRcdGNhc2UgJ3N0cmluZyxudW1iZXInOiAvLyBGb3JtOiBzZXQoU3RyaW5nIDxrZXk+LCBOdW1iZXIgPHZhbHVlPilcblx0XHRjYXNlICdzdHJpbmcsYXJyYXknOiAvLyBGb3JtOiBzZXQoU3RyaW5nIDxrZXk+LCBBcnJheSA8dmFsdWU+KVxuXHRcdGNhc2UgJ3N0cmluZyxjb2xsZWN0aW9uJzogLy8gRm9ybTogc2V0KFN0cmluZyA8a2V5PiwgQ29sbGVjdGlvbiA8dmFsdWU+KVxuXHRcdGNhc2UgJ3N0cmluZyxvYmplY3QnOiAvLyBGb3JtOiBzZXQoU3RyaW5nIDxrZXk+LCBPYmplY3QgPHZhbHVlPilcblx0XHRcdHZhciBwYXlsb2FkID0ge307XG5cdFx0XHRwYXlsb2FkW2FyZ3VtZW50c1swXV0gPSBhcmd1bWVudHNbMV07XG5cdFx0XHR0aGlzLl9zdHJ1Y3QucHVzaCh7IHR5cGU6ICdzZXQnLCBwYXlsb2FkOiBwYXlsb2FkIH0pO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSAnb2JqZWN0JzogLy8gRm9ybTogc2V0KE9iamVjdClcblx0XHRcdHRoaXMuX3N0cnVjdC5wdXNoKHsgdHlwZTogJ3NldCcsIHBheWxvYWQ6IGFyZ3VtZW50c1swXSB9KTtcblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgJ2Z1bmN0aW9uJzogLy8gRm9ybTogc2V0KGZ1bmMpIC0+IHNlcmllcyhmdW5jKVxuXHRcdFx0dGhpcy5fc3RydWN0LnB1c2goeyB0eXBlOiAnc2VyaWVzQXJyYXknLCBwYXlsb2FkOiBbYXJndW1lbnRzWzBdXSB9KTtcblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgICdzdHJpbmcsZnVuY3Rpb24nOiAvLyBGb3JtOiBzZXQoU3RyaW5nLCBmdW5jKSAtPiBzZXJpZXMoU3RyaW5nIDxpZD4sIGZ1bmMpXG5cdFx0XHR2YXIgcGF5bG9hZCA9IHt9O1xuXHRcdFx0cGF5bG9hZFthcmd1bWVudHNbMF1dID0gYXJndW1lbnRzWzFdO1xuXHRcdFx0dGhpcy5fc3RydWN0LnB1c2goeyB0eXBlOiAnc2VyaWVzT2JqZWN0JywgcGF5bG9hZDogcGF5bG9hZH0pO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSAnc3RyaW5nJzogLy8gU2V0IHRvIHVuZGVmaW5lZFxuXHRcdFx0dGhpcy5fc2V0UmF3KGFyZ3VtZW50c1swXSwgdW5kZWZpbmVkKTtcblx0XHRcdGJyZWFrO1xuXHRcdGRlZmF1bHQ6XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gY2FsbCBzdHlsZSBmb3IgLnNldCgpOicgKyBjYWxsZWRBcyk7XG5cdH1cblxuXHRyZXR1cm4gdGhpcztcbn07XG5cblxuLyoqXG4qIFNldCBhIGNvbnRleHQgaXRlbXMgdmFsdWVcbiogTm90IHRvIGJlIGNvbmZ1c2VkIHdpdGggYHNldCgpYCB3aGljaCBpcyB0aGUgY2hhaW5hYmxlIGV4dGVybmFsIHZpc2libGUgdmVyc2lvbiBvZiB0aGlzXG4qIFVubGlrZSBgc2V0KClgIHRoaXMgZnVuY3Rpb24gc2V0cyBhbiBpdGVtIG9mIF9jb250ZXh0IGltbWVkaWF0ZWx5XG4qIEBhY2Nlc3MgcHJpdmF0ZVxuKiBAc2VlIF9zZXRSYXcoKVxuKi9cbmZ1bmN0aW9uIF9zZXQoKSB7XG5cdHZhciBjYWxsZWRBcyA9IGdldE92ZXJsb2FkKGFyZ3VtZW50cyk7XG5cdHN3aXRjaChjYWxsZWRBcykge1xuXHRcdGNhc2UgJyc6XG5cdFx0XHQvLyBQYXNzXG5cdFx0XHRicmVhaztcblx0XHRjYXNlICdzdHJpbmcsc3RyaW5nJzogLy8gRm9ybTogc2V0KFN0cmluZyA8a2V5PiwgU3RyaW5nIDx2YWx1ZT4pXG5cdFx0Y2FzZSAnc3RyaW5nLG51bWJlcic6IC8vIEZvcm06IHNldChTdHJpbmcgPGtleT4sIE51bWJlciA8dmFsdWU+KVxuXHRcdGNhc2UgJ3N0cmluZyxhcnJheSc6IC8vIEZvcm06IHNldChTdHJpbmcgPGtleT4sIEFycmF5IDx2YWx1ZT4pXG5cdFx0Y2FzZSAnc3RyaW5nLGNvbGxlY3Rpb24nOiAvLyBGb3JtOiBzZXQoU3RyaW5nIDxrZXk+LCBDb2xsZWN0aW9uIDx2YWx1ZT4pXG5cdFx0Y2FzZSAnc3RyaW5nLG9iamVjdCc6IC8vIEZvcm06IHNldChTdHJpbmcgPGtleT4sIE9iamVjdCA8dmFsdWU+KVxuXHRcdFx0dGhpcy5fc2V0UmF3KGFyZ3VtZW50c1swXSwgYXJndW1lbnRzWzFdKTtcblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgJ29iamVjdCc6IC8vIEZvcm06IHNldChPYmplY3QpXG5cdFx0XHRmb3IgKHZhciBrZXkgaW4gYXJndW1lbnRzWzBdKVxuXHRcdFx0XHR0aGlzLl9zZXRSYXcoa2V5LCBhcmd1bWVudHNbMF1ba2V5XSk7XG5cdFx0XHRicmVhaztcblx0XHRjYXNlICAnc3RyaW5nLGZ1bmN0aW9uJzogLy8gRm9ybTogc2V0KFN0cmluZywgZnVuYykgLT4gc2VyaWVzKFN0cmluZyA8aWQ+LCBmdW5jKVxuXHRcdFx0dGhpcy5fc2V0UmF3KGFyZ3VtZW50c1swXSwgYXJndW1lbnRzWzFdLmNhbGwodGhpcykpO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSAnZnVuY3Rpb24nOiAvLyBGb3JtOiBfc2V0KGZ1bmMpIC8vIEV4cGVjdCBmdW5jIHRvIHJldHVybiBzb21ldGhpbmcgd2hpY2ggaXMgdGhlbiBwcm9jZXNzZWQgdG8gX3NldFxuXHRcdFx0dGhpcy5fc2V0KGFyZ3VtZW50c1sxXS5jYWxsKHRoaXMpKTtcblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgJ3N0cmluZyc6IC8vIFNldCB0byB1bmRlZmluZWRcblx0XHRcdHRoaXMuX3NldFJhdyhhcmd1bWVudHNbMF0sIHVuZGVmaW5lZCk7XG5cdFx0XHRicmVhaztcblx0XHRkZWZhdWx0OlxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCdVbmtub3duIGNhbGwgc3R5bGUgZm9yIC5zZXQoKTonICsgY2FsbGVkQXMpO1xuXHR9XG5cblx0cmV0dXJuIHRoaXM7XG59XG5cblxuLyoqXG4qIEFjdHVhbCByYXcgdmFsdWUgc2V0dGVyXG4qIFRoaXMgZnVuY3Rpb24gaXMgdGhlIGludGVybmFsIHZlcnNpb24gb2YgX3NldCB3aGljaCB0YWtlcyBleGFjdGx5IHR3byB2YWx1ZXMsIHRoZSBrZXkgYW5kIHRoZSB2YWx1ZSB0byBzZXRcbiogT3ZlcnJpZGUgdGhpcyBmdW5jdGlvbiBpZiBzb21lIGFsdGVybmF0aXZlIF9jb250ZXh0IHBsYXRmb3JtIGlzIHJlcXVpcmVkXG4qIEBwYXJhbSBzdHJpbmcga2V5IFRoZSBrZXkgd2l0aGluIF9jb250ZXh0IHRvIHNldCB0aGUgdmFsdWUgb2ZcbiogQHBhcmFtIG1peGVkIHZhbHVlIFRoZSB2YWx1ZSB3aXRoaW4gX2NvbnRleHRba2V5XSB0byBzZXQgdGhlIHZhbHVlIG9mXG4qIEBhY2Nlc3MgcHJpdmF0ZVxuKi9cbmZ1bmN0aW9uIF9zZXRSYXcoa2V5LCB2YWx1ZSkge1xuXHR0aGlzLl9jb250ZXh0W2tleV0gPSB2YWx1ZTtcblx0cmV0dXJuIHRoaXM7XG59XG5cblxuLyoqXG4qIEludGVybmFsIGZ1bmN0aW9uIGV4ZWN1dGVkIGF0IHRoZSBlbmQgb2YgdGhlIGNoYWluXG4qIFRoaXMgY2FuIG9jY3VyIGVpdGhlciBpbiBzZXF1ZW5jZSAoaS5lLiBubyBlcnJvcnMpIG9yIGEganVtcCB0byB0aGlzIHBvc2l0aW9uIChpLmUuIGFuIGVycm9yIGhhcHBlbmVkIHNvbWV3aGVyZSlcbiogQGFjY2VzcyBwcml2YXRlXG4qL1xuZnVuY3Rpb24gX2ZpbmFsaXplKGVycikge1xuXHQvLyBTYW5pdHkgY2hlY2tzIHt7e1xuXHRpZiAodGhpcy5fc3RydWN0Lmxlbmd0aCA9PSAwKSByZXR1cm47IC8vIEZpbmFsaXplIGNhbGxlZCBvbiBkZWFkIG9iamVjdCAtIHByb2JhYmx5IGEgZGVmZXIoKSBmaXJlZCB3aXRob3V0IGFuIGF3YWl0KClcblx0aWYgKHRoaXMuX3N0cnVjdFt0aGlzLl9zdHJ1Y3QubGVuZ3RoIC0gMV0udHlwZSAhPSAnZW5kJykge1xuXHRcdHRocm93IG5ldyBFcnJvcignV2hpbGUgdHJ5aW5nIHRvIGZpbmQgYW4gZW5kIHBvaW50IGluIHRoZSBhc3luYy1jaGFpbmFibGUgc3RydWN0dXJlIHRoZSBsYXN0IGl0ZW0gaW4gdGhlIHRoaXMuX3N0cnVjdCBkb2VzIG5vdCBoYXZlIHR5cGU9PWVuZCEnKTtcblx0XHRyZXR1cm47XG5cdH1cblx0Ly8gfX19XG5cdHRoaXMuX3N0cnVjdFt0aGlzLl9zdHJ1Y3QubGVuZ3RoLTFdLnBheWxvYWQuY2FsbCh0aGlzLl9vcHRpb25zLmNvbnRleHQsIGVycik7XG5cdGlmICh0aGlzLl9vcHRpb25zLmF1dG9SZXNldClcblx0XHR0aGlzLnJlc2V0KCk7XG59O1xuXG5cbi8qKlxuKiBJbnRlcm5hbCBmdW5jdGlvbiB0byBleGVjdXRlIHRoZSBuZXh0IHBlbmRpbmcgcXVldWUgaXRlbVxuKiBUaGlzIGlzIHVzdWFsbHkgY2FsbGVkIGFmdGVyIHRoZSBjb21wbGV0aW9uIG9mIGV2ZXJ5IGFzeW5jLnNlcmllcygpIC8gYXN5bmMucGFyYWxsZWwoKSAvIGFzeW5jQ2hhaW5hYmxlLl9ydW4gY2FsbFxuKiBAYWNjZXNzIHByaXZhdGVcbiovXG5mdW5jdGlvbiBfZXhlY3V0ZShlcnIpIHtcblx0dmFyIHNlbGYgPSB0aGlzO1xuXHRpZiAoZXJyKSByZXR1cm4gdGhpcy5fZmluYWxpemUoZXJyKTsgLy8gQW4gZXJyb3IgaGFzIGJlZW4gcmFpc2VkIC0gc3RvcCBleGVjIGFuZCBjYWxsIGZpbmFsaXplIG5vd1xuXHRkbyB7XG5cdFx0dmFyIHJlZG8gPSBmYWxzZTtcblx0XHRpZiAoc2VsZi5fc3RydWN0UG9pbnRlciA+PSBzZWxmLl9zdHJ1Y3QubGVuZ3RoKSByZXR1cm4gdGhpcy5fZmluYWxpemUoZXJyKTsgLy8gTm90aGluZyBtb3JlIHRvIGV4ZWN1dGUgaW4gc3RydWN0XG5cdFx0c2VsZi5fZGVmZXJDaGVjaygpOyAvLyBLaWNrIG9mZiBhbnkgcGVuZGluZyBkZWZlcnJlZCBpdGVtc1xuXHRcdHZhciBjdXJyZW50RXhlYyA9IHNlbGYuX3N0cnVjdFtzZWxmLl9zdHJ1Y3RQb2ludGVyXTtcblx0XHQvLyBTYW5pdHkgY2hlY2tzIHt7e1xuXHRcdGlmICghY3VycmVudEV4ZWMudHlwZSkge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCdObyB0eXBlIGlzIHNwZWNpZmllZCBmb3IgYXN5bmMtY2hhaW5hYmxlIHN0cnVjdHVyZSBhdCBvZmZzZXQgJyArIHNlbGYuX3N0cnVjdFBvaW50ZXIpO1xuXHRcdFx0cmV0dXJuIHNlbGY7XG5cdFx0fVxuXHRcdC8vIH19fVxuXHRcdHNlbGYuX3N0cnVjdFBvaW50ZXIrKztcblxuXHRcdC8vIFNraXAgc3RlcCB3aGVuIGZ1bmN0aW9uIHN1cHBvcnRzIHNraXBwaW5nIGlmIHRoZSBhcmd1bWVudCBpcyBlbXB0eSB7e3tcblx0XHRpZiAoXG5cdFx0XHRbXG5cdFx0XHRcdCdwYXJhbGxlbEFycmF5JywgJ3BhcmFsbGVsT2JqZWN0JywgJ3BhcmFsbGVsQ29sbGVjdGlvbicsXG5cdFx0XHRcdCdmb3JFYWNoQXJyYXknLCAnZm9yRWFjaE9iamVjdCcsXG5cdFx0XHRcdCdzZXJpZXNBcnJheScsICdzZXJpZXNPYmplY3QnLCAnc2VyaWVzQ29sbGVjdGlvbicsXG5cdFx0XHRcdCdkZWZlckFycmF5JywgJ2RlZmVyT2JqZWN0JywgJ2RlZmVyQ29sbGVjdGlvbicsXG5cdFx0XHRcdCdzZXQnXG5cdFx0XHRdLmluZGV4T2YoY3VycmVudEV4ZWMudHlwZSkgPiAtMSAmJlxuXHRcdFx0KFxuXHRcdFx0XHQhY3VycmVudEV4ZWMucGF5bG9hZCB8fCAvLyBOb3Qgc2V0IE9SXG5cdFx0XHRcdChpc0FycmF5KGN1cnJlbnRFeGVjLnBheWxvYWQpICYmICFjdXJyZW50RXhlYy5wYXlsb2FkLmxlbmd0aCkgfHwgLy8gQW4gZW1wdHkgYXJyYXlcblx0XHRcdFx0KGlzT2JqZWN0KGN1cnJlbnRFeGVjLnBheWxvYWQpICYmICFPYmplY3Qua2V5cyhjdXJyZW50RXhlYy5wYXlsb2FkKS5sZW5ndGgpIC8vIEFuIGVtcHR5IG9iamVjdFxuXHRcdFx0KVxuXHRcdCkge1xuXHRcdFx0Y3VycmVudEV4ZWMuY29tcGxldGVkID0gdHJ1ZTtcblx0XHRcdHJlZG8gPSB0cnVlO1xuXHRcdFx0Y29udGludWU7XG5cdFx0fVxuXHRcdC8vIH19fVxuXG5cdFx0c3dpdGNoIChjdXJyZW50RXhlYy50eXBlKSB7XG5cdFx0XHRjYXNlICdwYXJhbGxlbEFycmF5Jzpcblx0XHRcdFx0c2VsZi5fcnVuKGN1cnJlbnRFeGVjLnBheWxvYWQubWFwKGZ1bmN0aW9uKHRhc2spIHtcblx0XHRcdFx0XHRyZXR1cm4gZnVuY3Rpb24obmV4dCkge1xuXHRcdFx0XHRcdFx0dGFzay5jYWxsKHNlbGYuX29wdGlvbnMuY29udGV4dCwgbmV4dCk7XG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0fSksIHNlbGYuX29wdGlvbnMubGltaXQsIGZ1bmN0aW9uKGVycikge1xuXHRcdFx0XHRcdGN1cnJlbnRFeGVjLmNvbXBsZXRlZCA9IHRydWU7XG5cdFx0XHRcdFx0c2VsZi5fZXhlY3V0ZShlcnIpO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlICdwYXJhbGxlbE9iamVjdCc6XG5cdFx0XHRcdHZhciB0YXNrcyA9IFtdO1xuXHRcdFx0XHRPYmplY3Qua2V5cyhjdXJyZW50RXhlYy5wYXlsb2FkKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xuXHRcdFx0XHRcdHRhc2tzLnB1c2goZnVuY3Rpb24obmV4dCkge1xuXHRcdFx0XHRcdFx0Y3VycmVudEV4ZWMucGF5bG9hZFtrZXldLmNhbGwoc2VsZi5fb3B0aW9ucy5jb250ZXh0LCBmdW5jdGlvbihlcnIsIHZhbHVlKSB7XG5cdFx0XHRcdFx0XHRcdHNlbGYuX3NldChrZXksIHZhbHVlKTsgLy8gQWxsb2NhdGUgcmV0dXJuZWQgdmFsdWUgdG8gY29udGV4dFxuXHRcdFx0XHRcdFx0XHRuZXh0KGVycik7XG5cdFx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0c2VsZi5fcnVuKHRhc2tzLCBzZWxmLl9vcHRpb25zLmxpbWl0LCBmdW5jdGlvbihlcnIpIHtcblx0XHRcdFx0XHRjdXJyZW50RXhlYy5jb21wbGV0ZWQgPSB0cnVlO1xuXHRcdFx0XHRcdHNlbGYuX2V4ZWN1dGUoZXJyKTtcblx0XHRcdFx0fSk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSAncGFyYWxsZWxDb2xsZWN0aW9uJzpcblx0XHRcdFx0dmFyIHRhc2tzID0gW107XG5cdFx0XHRcdGN1cnJlbnRFeGVjLnBheWxvYWQuZm9yRWFjaChmdW5jdGlvbih0YXNrKSB7XG5cdFx0XHRcdFx0T2JqZWN0LmtleXModGFzaykuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcblx0XHRcdFx0XHRcdHRhc2tzLnB1c2goZnVuY3Rpb24obmV4dCwgZXJyKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YgdGFza1trZXldICE9ICdmdW5jdGlvbicpIHRocm93IG5ldyBFcnJvcignQ29sbGVjdGlvbiBpdGVtIGZvciBwYXJhbGxlbCBleGVjIGlzIG5vdCBhIGZ1bmN0aW9uJywgY3VycmVudEV4ZWMucGF5bG9hZCk7XG5cdFx0XHRcdFx0XHRcdHRhc2tba2V5XS5jYWxsKHNlbGYuX29wdGlvbnMuY29udGV4dCwgZnVuY3Rpb24oZXJyLCB2YWx1ZSkge1xuXHRcdFx0XHRcdFx0XHRcdHNlbGYuX3NldChrZXksIHZhbHVlKTsgLy8gQWxsb2NhdGUgcmV0dXJuZWQgdmFsdWUgdG8gY29udGV4dFxuXHRcdFx0XHRcdFx0XHRcdG5leHQoZXJyKTtcblx0XHRcdFx0XHRcdFx0fSlcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0c2VsZi5fcnVuKHRhc2tzLCBzZWxmLl9vcHRpb25zLmxpbWl0LCBmdW5jdGlvbihlcnIpIHtcblx0XHRcdFx0XHRjdXJyZW50RXhlYy5jb21wbGV0ZWQgPSB0cnVlO1xuXHRcdFx0XHRcdHNlbGYuX2V4ZWN1dGUoZXJyKTtcblx0XHRcdFx0fSk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSAnZm9yRWFjaEFycmF5Jzpcblx0XHRcdFx0c2VsZi5fcnVuKGN1cnJlbnRFeGVjLnBheWxvYWQubWFwKGZ1bmN0aW9uKGl0ZW0sIGl0ZXIpIHtcblx0XHRcdFx0XHRzZWxmLl9jb250ZXh0Ll9pdGVtID0gaXRlbTtcblx0XHRcdFx0XHRzZWxmLl9jb250ZXh0Ll9rZXkgPSBpdGVyO1xuXHRcdFx0XHRcdHJldHVybiBmdW5jdGlvbihuZXh0KSB7XG5cdFx0XHRcdFx0XHRjdXJyZW50RXhlYy5jYWxsYmFjay5jYWxsKHNlbGYuX29wdGlvbnMuY29udGV4dCwgbmV4dCwgaXRlbSwgaXRlcik7XG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0fSksIHNlbGYuX29wdGlvbnMubGltaXQsIGZ1bmN0aW9uKGVycikge1xuXHRcdFx0XHRcdGN1cnJlbnRFeGVjLmNvbXBsZXRlZCA9IHRydWU7XG5cdFx0XHRcdFx0c2VsZi5fZXhlY3V0ZShlcnIpO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlICdmb3JFYWNoT2JqZWN0Jzpcblx0XHRcdFx0dmFyIHRhc2tzID0gW107XG5cdFx0XHRcdE9iamVjdC5rZXlzKGN1cnJlbnRFeGVjLnBheWxvYWQpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG5cdFx0XHRcdFx0dGFza3MucHVzaChmdW5jdGlvbihuZXh0KSB7XG5cdFx0XHRcdFx0XHRzZWxmLl9jb250ZXh0Ll9pdGVtID0gY3VycmVudEV4ZWMucGF5bG9hZFtrZXldO1xuXHRcdFx0XHRcdFx0c2VsZi5fY29udGV4dC5fa2V5ID0ga2V5O1xuXHRcdFx0XHRcdFx0Y3VycmVudEV4ZWMuY2FsbGJhY2suY2FsbChzZWxmLl9vcHRpb25zLmNvbnRleHQsIGZ1bmN0aW9uKGVyciwgdmFsdWUpIHtcblx0XHRcdFx0XHRcdFx0c2VsZi5fc2V0KGtleSwgdmFsdWUpOyAvLyBBbGxvY2F0ZSByZXR1cm5lZCB2YWx1ZSB0byBjb250ZXh0XG5cdFx0XHRcdFx0XHRcdG5leHQoZXJyKTtcblx0XHRcdFx0XHRcdH0sIGN1cnJlbnRFeGVjLnBheWxvYWRba2V5XSwga2V5KTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSk7XG5cdFx0XHRcdHNlbGYuX3J1bih0YXNrcywgc2VsZi5fb3B0aW9ucy5saW1pdCwgZnVuY3Rpb24oZXJyKSB7XG5cdFx0XHRcdFx0Y3VycmVudEV4ZWMuY29tcGxldGVkID0gdHJ1ZTtcblx0XHRcdFx0XHRzZWxmLl9leGVjdXRlKGVycik7XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgJ2ZvckVhY2hMYXRlQm91bmQnOlxuXHRcdFx0XHRpZiAoXG5cdFx0XHRcdFx0KCFjdXJyZW50RXhlYy5wYXlsb2FkIHx8ICFjdXJyZW50RXhlYy5wYXlsb2FkLmxlbmd0aCkgfHwgLy8gUGF5bG9hZCBpcyBibGFua1xuXHRcdFx0XHRcdCghc2VsZi5fY29udGV4dFtjdXJyZW50RXhlYy5wYXlsb2FkXSkgLy8gUGF5bG9hZCBkb2VzbnQgZXhpc3Qgd2l0aGluIGNvbnRleHRcblx0XHRcdFx0KSB7IC8vIEdvdG8gbmV4dCBjaGFpblxuXHRcdFx0XHRcdGN1cnJlbnRFeGVjLmNvbXBsZXRlZCA9IHRydWU7XG5cdFx0XHRcdFx0cmVkbyA9IHRydWU7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBSZXBsYWNlIG93biBleGVjIGFycmF5IHdpdGggYWN0dWFsIHR5cGUgb2YgcGF5bG9hZCBub3cgd2Uga25vdyB3aGF0IGl0IGlzIHt7e1xuXHRcdFx0XHR2YXIgb3ZlcmxvYWRUeXBlID0gZ2V0T3ZlcmxvYWQoW3NlbGYuX2NvbnRleHRbY3VycmVudEV4ZWMucGF5bG9hZF1dKTtcblx0XHRcdFx0c3dpdGNoIChvdmVybG9hZFR5cGUpIHtcblx0XHRcdFx0XHRjYXNlICdjb2xsZWN0aW9uJzpcblx0XHRcdFx0XHRjYXNlICdhcnJheSc6XG5cdFx0XHRcdFx0XHRjdXJyZW50RXhlYy50eXBlID0gJ2ZvckVhY2hBcnJheSc7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRjYXNlICdvYmplY3QnOlxuXHRcdFx0XHRcdFx0Y3VycmVudEV4ZWMudHlwZSA9ICdmb3JFYWNoT2JqZWN0Jztcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBwZXJmb3JtIGZvckVhY2ggb3ZlciB1bmtub3duIG9iamVjdCB0eXBlOiAnICsgb3ZlcmxvYWRUeXBlKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRjdXJyZW50RXhlYy5wYXlsb2FkID0gc2VsZi5fY29udGV4dFtjdXJyZW50RXhlYy5wYXlsb2FkXTtcblx0XHRcdFx0c2VsZi5fc3RydWN0UG9pbnRlci0tOyAvLyBGb3JjZSByZS1ldmFsIG9mIHRoaXMgY2hhaW4gaXRlbSBub3cgaXRzIGJlZW4gcmVwbGFjZSB3aXRoIGl0cyByZWFsIChsYXRlLWJvdW5kKSB0eXBlXG5cdFx0XHRcdHJlZG8gPSB0cnVlO1xuXHRcdFx0XHQvLyB9fX1cblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlICdzZXJpZXNBcnJheSc6XG5cdFx0XHRcdHNlbGYuX3J1bihjdXJyZW50RXhlYy5wYXlsb2FkLm1hcChmdW5jdGlvbih0YXNrKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGZ1bmN0aW9uKG5leHQpIHtcblx0XHRcdFx0XHRcdHRhc2suY2FsbChzZWxmLl9vcHRpb25zLmNvbnRleHQsIG5leHQpO1xuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH0pLCAxLCBmdW5jdGlvbihlcnIpIHtcblx0XHRcdFx0XHRjdXJyZW50RXhlYy5jb21wbGV0ZWQgPSB0cnVlO1xuXHRcdFx0XHRcdHNlbGYuX2V4ZWN1dGUoZXJyKTtcblx0XHRcdFx0fSk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSAnc2VyaWVzT2JqZWN0Jzpcblx0XHRcdFx0dmFyIHRhc2tzID0gW107XG5cdFx0XHRcdE9iamVjdC5rZXlzKGN1cnJlbnRFeGVjLnBheWxvYWQpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG5cdFx0XHRcdFx0dGFza3MucHVzaChmdW5jdGlvbihuZXh0KSB7XG5cdFx0XHRcdFx0XHRjdXJyZW50RXhlYy5wYXlsb2FkW2tleV0uY2FsbChzZWxmLl9vcHRpb25zLmNvbnRleHQsIGZ1bmN0aW9uKGVyciwgdmFsdWUpIHtcblx0XHRcdFx0XHRcdFx0c2VsZi5fc2V0KGtleSwgdmFsdWUpOyAvLyBBbGxvY2F0ZSByZXR1cm5lZCB2YWx1ZSB0byBjb250ZXh0XG5cdFx0XHRcdFx0XHRcdG5leHQoZXJyKTtcblx0XHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRzZWxmLl9ydW4odGFza3MsIDEsIGZ1bmN0aW9uKGVycikge1xuXHRcdFx0XHRcdGN1cnJlbnRFeGVjLmNvbXBsZXRlZCA9IHRydWU7XG5cdFx0XHRcdFx0c2VsZi5fZXhlY3V0ZShlcnIpO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlICdzZXJpZXNDb2xsZWN0aW9uJzpcblx0XHRcdFx0dmFyIHRhc2tzID0gW107XG5cdFx0XHRcdGN1cnJlbnRFeGVjLnBheWxvYWQuZm9yRWFjaChmdW5jdGlvbih0YXNrKSB7XG5cdFx0XHRcdFx0T2JqZWN0LmtleXModGFzaykuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcblx0XHRcdFx0XHRcdHRhc2tzLnB1c2goZnVuY3Rpb24obmV4dCwgZXJyKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YgdGFza1trZXldICE9ICdmdW5jdGlvbicpIHRocm93IG5ldyBFcnJvcignQ29sbGVjdGlvbiBpdGVtIGZvciBzZXJpZXMgZXhlYyBpcyBub3QgYSBmdW5jdGlvbicsIGN1cnJlbnRFeGVjLnBheWxvYWQpO1xuXHRcdFx0XHRcdFx0XHR0YXNrW2tleV0uY2FsbChzZWxmLl9vcHRpb25zLmNvbnRleHQsIGZ1bmN0aW9uKGVyciwgdmFsdWUpIHtcblx0XHRcdFx0XHRcdFx0XHRzZWxmLl9zZXQoa2V5LCB2YWx1ZSk7IC8vIEFsbG9jYXRlIHJldHVybmVkIHZhbHVlIHRvIGNvbnRleHRcblx0XHRcdFx0XHRcdFx0XHRuZXh0KGVycik7XG5cdFx0XHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSk7XG5cdFx0XHRcdHNlbGYuX3J1bih0YXNrcywgMSwgZnVuY3Rpb24oZXJyKSB7XG5cdFx0XHRcdFx0Y3VycmVudEV4ZWMuY29tcGxldGVkID0gdHJ1ZTtcblx0XHRcdFx0XHRzZWxmLl9leGVjdXRlKGVycik7XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgJ2RlZmVyQXJyYXknOlxuXHRcdFx0XHRjdXJyZW50RXhlYy5wYXlsb2FkLmZvckVhY2goZnVuY3Rpb24odGFzaykge1xuXHRcdFx0XHRcdHNlbGYuX2RlZmVyQWRkKG51bGwsIHRhc2ssIGN1cnJlbnRFeGVjKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0cmVkbyA9IHRydWU7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSAnZGVmZXJPYmplY3QnOlxuXHRcdFx0XHRPYmplY3Qua2V5cyhjdXJyZW50RXhlYy5wYXlsb2FkKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xuXHRcdFx0XHRcdHNlbGYuX2RlZmVyQWRkKGtleSwgY3VycmVudEV4ZWMucGF5bG9hZFtrZXldLCBjdXJyZW50RXhlYyk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdHJlZG8gPSB0cnVlO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgJ2RlZmVyQ29sbGVjdGlvbic6XG5cdFx0XHRcdGN1cnJlbnRFeGVjLnBheWxvYWQuZm9yRWFjaChmdW5jdGlvbih0YXNrKSB7XG5cdFx0XHRcdFx0T2JqZWN0LmtleXModGFzaykuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcblx0XHRcdFx0XHRcdHNlbGYuX2RlZmVyQWRkKGtleSwgdGFza1trZXldLCBjdXJyZW50RXhlYyk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRyZWRvID0gdHJ1ZTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlICdhd2FpdCc6IC8vIEF3YWl0IGNhbiBvcGVyYXRlIGluIHR3byBtb2RlcywgZWl0aGVyIHBheWxvYWQ9W10gKGV4YW1pbmUgYWxsKSBlbHNlIChleGFtaW5lIHNwZWNpZmljIGtleXMpXG5cdFx0XHRcdGlmICghY3VycmVudEV4ZWMucGF5bG9hZC5sZW5ndGgpIHsgLy8gQ2hlY2sgYWxsIHRhc2tzIGFyZSBjb21wbGV0ZVxuXHRcdFx0XHRcdGlmIChzZWxmLl9zdHJ1Y3Quc2xpY2UoMCwgc2VsZi5fc3RydWN0UG9pbnRlciAtIDEpLmV2ZXJ5KGZ1bmN0aW9uKHN0YWdlKSB7IC8vIEV4YW1pbmUgYWxsIGl0ZW1zIFVQIFRPIHNlbGYgb25lIGFuZCBjaGVjayB0aGV5IGFyZSBjb21wbGV0ZVxuXHRcdFx0XHRcdFx0cmV0dXJuIHN0YWdlLmNvbXBsZXRlZDtcblx0XHRcdFx0XHR9KSkgeyAvLyBBbGwgdGFza3MgdXAgdG8gc2VsZiBwb2ludCBhcmUgbWFya2VkIGFzIGNvbXBsZXRlZFxuXHRcdFx0XHRcdFx0Y3VycmVudEV4ZWMuY29tcGxldGVkID0gdHJ1ZTtcblx0XHRcdFx0XHRcdHJlZG8gPSB0cnVlO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRzZWxmLl9zdHJ1Y3RQb2ludGVyLS07IC8vIEF0IGxlYXN0IG9uZSB0YXNrIGlzIG91dHN0YW5kaW5nIC0gcmV3aW5kIHRvIHNlbGYgc3RhZ2Ugc28gd2UgcmVwZWF0IG9uIG5leHQgcmVzb2x1dGlvblxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHsgLy8gQ2hlY2sgY2VydGFpbiB0YXNrcyBhcmUgY29tcGxldGUgYnkga2V5XG5cdFx0XHRcdFx0aWYgKGN1cnJlbnRFeGVjLnBheWxvYWQuZXZlcnkoZnVuY3Rpb24oZGVwKSB7IC8vIEV4YW1pbmUgYWxsIG5hbWVkIGRlcGVuZGVuY2llc1xuXHRcdFx0XHRcdFx0cmV0dXJuICEhIHNlbGYuX2NvbnRleHRbZGVwXTtcblx0XHRcdFx0XHR9KSkgeyAvLyBBbGwgYXJlIHByZXNlbnRcblx0XHRcdFx0XHRcdGN1cnJlbnRFeGVjLmNvbXBsZXRlZCA9IHRydWU7XG5cdFx0XHRcdFx0XHRyZWRvID0gdHJ1ZTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0c2VsZi5fc3RydWN0UG9pbnRlci0tOyAvLyBBdCBsZWFzdCBvbmUgZGVwZW5kZW5jeSBpcyBvdXRzdGFuZGluZyAtIHJld2luZCB0byBzZWxmIHN0YWdlIHNvIHdlIHJlcGVhdCBvbiBuZXh0IHJlc29sdXRpb25cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlICdsaW1pdCc6IC8vIFNldCB0aGUgb3B0aW9ucy5saW1pdCB2YXJpYWJsZVxuXHRcdFx0XHRzZWxmLl9vcHRpb25zLmxpbWl0ID0gY3VycmVudEV4ZWMucGF5bG9hZDtcblx0XHRcdFx0Y3VycmVudEV4ZWMuY29tcGxldGVkID0gdHJ1ZTtcblx0XHRcdFx0cmVkbyA9IHRydWU7IC8vIE1vdmUgb24gdG8gbmV4dCBhY3Rpb25cblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlICdjb250ZXh0JzogLy8gQ2hhbmdlIHRoZSBzZWxmLl9vcHRpb25zLmNvbnRleHQgb2JqZWN0XG5cdFx0XHRcdHNlbGYuX29wdGlvbnMuY29udGV4dCA9IGN1cnJlbnRFeGVjLnBheWxvYWQgPyBjdXJyZW50RXhlYy5wYXlsb2FkIDogc2VsZi5fY29udGV4dDsgLy8gU2V0IGNvbnRleHQgKGlmIG51bGwgdXNlIGludGVybmFsIGNvbnRleHQpXG5cdFx0XHRcdGN1cnJlbnRFeGVjLmNvbXBsZXRlZCA9IHRydWU7XG5cdFx0XHRcdHJlZG8gPSB0cnVlOyAvLyBNb3ZlIG9uIHRvIG5leHQgYWN0aW9uXG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSAnc2V0JzogLy8gU2V0IGEgaGFzaCBvZiB2YXJpYWJsZXMgd2l0aGluIGNvbnRleHRcblx0XHRcdFx0T2JqZWN0LmtleXMoY3VycmVudEV4ZWMucGF5bG9hZCkuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcblx0XHRcdFx0XHRzZWxmLl9zZXQoa2V5LCBjdXJyZW50RXhlYy5wYXlsb2FkW2tleV0pO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0Y3VycmVudEV4ZWMuY29tcGxldGVkID0gdHJ1ZTtcblx0XHRcdFx0cmVkbyA9IHRydWU7IC8vIE1vdmUgb24gdG8gbmV4dCBhY3Rpb25cblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlICdlbmQnOiAvLyBzZWxmIHNob3VsZCBBTFdBWVMgYmUgdGhlIGxhc3QgaXRlbSBpbiB0aGUgc3RydWN0dXJlIGFuZCBpbmRpY2F0ZXMgdGhlIGZpbmFsIGZ1bmN0aW9uIGNhbGxcblx0XHRcdFx0dGhpcy5fZmluYWxpemUoKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRpZiAodGhpcy5fcGx1Z2luc1tjdXJyZW50RXhlYy50eXBlXSkgeyAvLyBJcyB0aGVyZSBhIHBsdWdpbiB0aGF0IHNob3VsZCBtYW5hZ2UgdGhpcz9cblx0XHRcdFx0XHR0aGlzLl9wbHVnaW5zW2N1cnJlbnRFeGVjLnR5cGVdLmNhbGwodGhpcywgY3VycmVudEV4ZWMpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcignVW5rbm93biBhc3luYy1jaGFpbmFibGUgZXhlYyB0eXBlOiAnICsgY3VycmVudEV4ZWMudHlwZSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0fSB3aGlsZSAocmVkbyk7XG59O1xuXG5cbi8qKlxuKiBJbnRlcm5hbCBmdW5jdGlvbiB0byBydW4gYW4gYXJyYXkgb2YgZnVuY3Rpb25zICh1c3VhbGx5IGluIHBhcmFsbGVsKVxuKiBTZXJpZXMgZXhlY3V0aW9uIGNhbiBiZSBvYnRhaW5lZCBieSBzZXR0aW5nIGxpbWl0ID0gMVxuKiBAcGFyYW0gYXJyYXkgdGFza3MgVGhlIGFycmF5IG9mIHRhc2tzIHRvIGV4ZWN1dGVcbiogQHBhcmFtIGludCBsaW1pdCBUaGUgbGltaXRlciBvZiB0YXNrcyAoaWYgbGltaXQ9PTEgdGFza3MgYXJlIHJ1biBpbiBzZXJpZXMsIGlmIGxpbWl0PjEgdGFza3MgYXJlIHJ1biBpbiBsaW1pdGVkIHBhcmFsbGVsLCBlbHNlIHRhc2tzIGFyZSBydW4gaW4gcGFyYWxsZWwpXG4qIEBwYXJhbSBmdW5jdGlvbiBjYWxsYmFjayhlcnIpIFRoZSBjYWxsYmFjayB0byBmaXJlIG9uIGZpbmlzaFxuKi9cbmZ1bmN0aW9uIF9ydW4odGFza3MsIGxpbWl0LCBjYWxsYmFjaykge1xuXHRpZiAobGltaXQgPT0gMSkge1xuXHRcdGFzeW5jLnNlcmllcyh0YXNrcywgY2FsbGJhY2spO1xuXHR9IGVsc2UgaWYgKGxpbWl0ID4gMCkge1xuXHRcdGFzeW5jLnBhcmFsbGVsTGltaXQodGFza3MsIGxpbWl0LCBjYWxsYmFjayk7XG5cdH0gZWxzZSB7XG5cdFx0YXN5bmMucGFyYWxsZWwodGFza3MsIGNhbGxiYWNrKTtcblx0fVxufVxuXG5cbi8qKlxuKiBSZXNldCBhbGwgc3RhdGUgdmFyaWFibGVzIGFuZCByZXR1cm4gdGhlIG9iamVjdCBpbnRvIGEgcHJpc3RpbmUgY29uZGl0aW9uXG4qIEByZXR1cm4gb2JqZWN0IFRoaXMgY2hhaW5hYmxlIG9iamVjdFxuKi9cbmZ1bmN0aW9uIHJlc2V0KCkge1xuXHR0aGlzLl9zdHJ1Y3QgPSBbXTtcblx0dGhpcy5fc3RydWN0UG9pbnRlciA9IDA7XG5cblx0dmFyIHJlQXR0YWNoQ29udGV4dCA9ICh0aGlzLl9vcHRpb25zLmNvbnRleHQgPT0gdGhpcy5fY29udGV4dCk7IC8vIFJlYXR0YWNoIHRoZSBjb250ZXh0IHBvaW50ZXIgYWZ0ZXIgcmVzZXQ/XG5cdHRoaXMuX2NvbnRleHQgPSB7XG5cdFx0X3N0cnVjdDogdGhpcy5fc3RydWN0LFxuXHRcdF9zdHJ1Y3RQb2ludGVyOiB0aGlzLl9zdHJ1Y3RQb2ludGVyLFxuXHRcdF9vcHRpb25zOiB0aGlzLl9vcHRpb25zLFxuXHRcdF9kZWZlcnJlZFJ1bm5pbmc6IHRoaXMuX2RlZmVycmVkUnVubmluZyxcblx0fTtcblxuXHRpZiAocmVBdHRhY2hDb250ZXh0KSB0aGlzLl9vcHRpb25zLmNvbnRleHQgPSB0aGlzLl9jb250ZXh0O1xufTtcblxuLyoqXG4qIFF1ZXVlIHVwIGFuIG9wdGlvbmFsIHNpbmdsZSBmdW5jdGlvbiBmb3IgZXhlY3V0aW9uIG9uIGNvbXBsZXRpb25cbiogVGhpcyBmdW5jdGlvbiBhbHNvIHN0YXJ0cyB0aGUgcXVldWUgZXhlY3V0aW5nXG4qIEByZXR1cm4gb2JqZWN0IFRoaXMgY2hhaW5hYmxlIG9iamVjdFxuKi9cbmZ1bmN0aW9uIGVuZCgpIHsgXG5cdHZhciBjYWxsZWRBcyA9IGdldE92ZXJsb2FkKGFyZ3VtZW50cyk7XG5cdHN3aXRjaCAoY2FsbGVkQXMpIHtcblx0XHRjYXNlICcnOiAvLyBObyBmdW5jdGlvbnMgcGFzc2VkIC0gZG8gbm90aGluZ1xuXHRcdFx0dGhpcy5fc3RydWN0LnB1c2goeyB0eXBlOiAnZW5kJywgcGF5bG9hZDogZnVuY3Rpb24oKSB7fSB9KTsgLy8gLmVuZCgpIGNhbGxlZCB3aXRoIG5vIGFyZ3MgLSBtYWtlIGEgbm9vcCgpXG5cdFx0XHRicmVhaztcblx0XHRjYXNlICdmdW5jdGlvbic6IC8vIEZvcm06IGVuZChmdW5jKSAtPiByZWRpcmVjdCBhcyBpZiBjYWxsZWQgd2l0aCBzZXJpZXMoZnVuYylcblx0XHRcdHRoaXMuX3N0cnVjdC5wdXNoKHsgdHlwZTogJ2VuZCcsIHBheWxvYWQ6IGFyZ3VtZW50c1swXSB9KTtcblx0XHRcdGJyZWFrO1xuXHRcdGRlZmF1bHQ6XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gY2FsbCBzdHlsZSBmb3IgLmVuZCgpOiAnICsgY2FsbGVkQXMpO1xuXHR9XG5cblx0dGhpcy5fZXhlY3V0ZSgpO1xuXHRyZXR1cm4gdGhpcztcbn07XG5cbnZhciBvYmplY3RJbnN0YW5jZSA9IGZ1bmN0aW9uKCkge1xuXHQvLyBWYXJpYWJsZXMge3t7XG5cdHRoaXMuX3N0cnVjdCA9IFtdO1xuXHR0aGlzLl9zdHJ1Y3RQb2ludGVyID0gMDtcblx0dGhpcy5fY29udGV4dCA9IHt9O1xuXG5cdHRoaXMuX29wdGlvbnMgPSB7XG5cdFx0YXV0b1Jlc2V0OiB0cnVlLCAvLyBSdW4gYXN5bmNDaGFpbmFibGUucmVzZXQoKSBhZnRlciBmaW5hbGl6ZS4gRGlzYWJsZSB0aGlzIGlmIHlvdSB3YW50IHRvIHNlZSBhIHBvc3QtbW9ydGVtIG9uIHdoYXQgZGlkIHJ1blxuXHRcdGxpbWl0OiAxMCwgLy8gTnVtYmVyIG9mIGRlZmVyIGZ1bmN0aW9ucyB0aGF0IGFyZSBhbGxvd2VkIHRvIGV4ZWN1dGUgYXQgb25jZVxuXHRcdGNvbnRleHQ6IHRoaXMuX2NvbnRleHQsIC8vIFRoZSBjb250ZXh0IGl0ZW0gcGFzc2VkIHRvIHRoZSBmdW5jdGlvbnMgKGNhbiBiZSBjaGFuZ2VkIHdpdGggLmNvbnRleHQoKSlcblx0fTtcblx0Ly8gfX19XG5cblx0Ly8gQXN5bmMtQ2hhaW5hYmxlIGZ1bmN0aW9ucyB7e3tcblx0Ly8gUHJpdmF0ZSB7e3tcblx0dGhpcy5fZXhlY3V0ZSA9IF9leGVjdXRlO1xuXHR0aGlzLl9ydW4gPSBfcnVuO1xuXHR0aGlzLl9kZWZlckNoZWNrID0gX2RlZmVyQ2hlY2s7XG5cdHRoaXMuX2RlZmVyQWRkID0gZGVmZXJBZGQ7XG5cdHRoaXMuX2RlZmVycmVkID0gW107XG5cdHRoaXMuX2RlZmVycmVkUnVubmluZyA9IDA7XG5cdHRoaXMuX2ZpbmFsaXplID0gX2ZpbmFsaXplO1xuXHR0aGlzLl9nZXRPdmVybG9hZCA9IGdldE92ZXJsb2FkOyAvLyBTbyB0aGlzIGZ1bmN0aW9uIGlzIGFjY2Vzc2libGUgYnkgcGx1Z2luc1xuXHR0aGlzLl9wbHVnaW5zID0gX3BsdWdpbnM7XG5cdC8vIH19fVxuXG5cdHRoaXMuYXdhaXQgPSBhd2FpdDtcblx0dGhpcy5jb250ZXh0ID0gc2V0Q29udGV4dDtcblx0dGhpcy5kZWZlciA9IGRlZmVyO1xuXHR0aGlzLmVuZCA9IGVuZDtcblx0dGhpcy5mb3JFYWNoID0gZm9yRWFjaDtcblx0dGhpcy5saW1pdCA9IHNldExpbWl0O1xuXHR0aGlzLnBhcmFsbGVsID0gcGFyYWxsZWw7XG5cdHRoaXMucmVzZXQgPSByZXNldDtcblx0dGhpcy5zZXJpZXMgPSBzZXJpZXM7XG5cdHRoaXMuc2V0ID0gc2V0O1xuXHR0aGlzLl9zZXQgPSBfc2V0O1xuXHR0aGlzLl9zZXRSYXcgPSBfc2V0UmF3O1xuXHR0aGlzLnRoZW4gPSBzZXJpZXM7XG5cdHRoaXMubmV3ID0gZnVuY3Rpb24oKSB7IHJldHVybiBuZXcgb2JqZWN0SW5zdGFuY2UgfTtcblx0dGhpcy51c2UgPSB1c2U7XG5cdC8vIH19fVxuXG5cdC8vIEFzeW5jIGNvbXBhdCBmdW5jdGlvbmFsaXR5IC0gc28gdGhpcyBtb2R1bGUgYmVjb21lcyBhIGRyb3AtaW4gcmVwbGFjZW1lbnQge3t7XG5cdC8vIENvbGxlY3Rpb25zXG5cdHRoaXMuZWFjaCA9IGFzeW5jLmVhY2g7XG5cdHRoaXMuZWFjaFNlcmllcyA9IGFzeW5jLmVhY2hTZXJpZXM7XG5cdHRoaXMuZWFjaExpbWl0ID0gYXN5bmMuZWFjaExpbWl0O1xuXHR0aGlzLm1hcCA9IGFzeW5jLm1hcDtcblx0dGhpcy5tYXBTZXJpZXMgPSBhc3luYy5tYXBTZXJpZXM7XG5cdHRoaXMubWFwTGltaXQgPSBhc3luYy5tYXBMaW1pdDtcblx0dGhpcy5maWx0ZXIgPSBhc3luYy5maWx0ZXI7XG5cdHRoaXMuZmlsdGVyU2VyaWVzID0gYXN5bmMuZmlsdGVyU2VyaWVzO1xuXHR0aGlzLnJlamVjdCA9IGFzeW5jLnJlamVjdDtcblx0dGhpcy5yZWplY3RTZXJpZXMgPSBhc3luYy5yZWplY3RTZXJpZXM7XG5cdHRoaXMucmVkdWNlID0gYXN5bmMucmVkdWNlO1xuXHR0aGlzLnJlZHVjZVJpZ2h0ID0gYXN5bmMucmVkdWNlUmlnaHQ7XG5cdHRoaXMuZGV0ZWN0ID0gYXN5bmMuZGV0ZWN0O1xuXHR0aGlzLmRldGVjdFNlcmllcyA9IGFzeW5jLmRldGVjdFNlcmllcztcblx0dGhpcy5zb3J0QnkgPSBhc3luYy5zb3J0Qnk7XG5cdHRoaXMuc29tZSA9IGFzeW5jLnNvbWU7XG5cdHRoaXMuZXZlcnkgPSBhc3luYy5ldmVyeTtcblx0dGhpcy5jb25jYXQgPSBhc3luYy5jb25jYXQ7XG5cdHRoaXMuY29uY2F0U2VyaWVzID0gYXN5bmMuY29uY2F0U2VyaWVzO1xuXG5cdC8vIENvbnRyb2wgRmxvd1xuXHQvLyBTZWUgbWFpbiAuc2VyaWVzKCkgYW5kIC5wYXJhbGxlbCgpIGNvZGUgZm9yIGFzeW5jIGNvbXBhdGliaWxpdHlcblx0dGhpcy5wYXJhbGxlbExpbWl0ID0gYXN5bmMucGFyYWxsZWxMaW1pdDtcblx0dGhpcy53aGlsc3QgPSBhc3luYy53aGlsc3Q7XG5cdHRoaXMuZG9XaGlsc3QgPSBhc3luYy5kb1doaWxzdDtcblx0dGhpcy51bnRpbCA9IGFzeW5jLnVudGlsO1xuXHR0aGlzLmRvVW50aWwgPSBhc3luYy5kb1VudGlsO1xuXHR0aGlzLmZvcmV2ZXIgPSBhc3luYy5mb3JldmVyO1xuXHR0aGlzLndhdGVyZmFsbCA9IGFzeW5jLndhdGVyZmFsbDtcblx0dGhpcy5jb21wb3NlID0gYXN5bmMuY29tcG9zZTtcblx0dGhpcy5zZXEgPSBhc3luYy5zZXE7XG5cdHRoaXMuYXBwbHlFYWNoID0gYXN5bmMuYXBwbHlFYWNoO1xuXHR0aGlzLmFwcGx5RWFjaFNlcmllcyA9IGFzeW5jLmFwcGx5RWFjaFNlcmllcztcblx0dGhpcy5xdWV1ZSA9IGFzeW5jLnF1ZXVlO1xuXHR0aGlzLnByaW9yaXR5UXVldWUgPSBhc3luYy5wcmlvcml0eVF1ZXVlO1xuXHR0aGlzLmNhcmdvID0gYXN5bmMuY2FyZ287XG5cdHRoaXMuYXV0byA9IGFzeW5jLmF1dG87XG5cdHRoaXMucmV0cnkgPSBhc3luYy5yZXRyeTtcblx0dGhpcy5pdGVyYXRvciA9IGFzeW5jLml0ZXJhdG9yO1xuXHR0aGlzLmFwcGx5ID0gYXN5bmMuYXBwbHk7XG5cdHRoaXMubmV4dFRpY2sgPSBhc3luYy5uZXh0VGljaztcblx0dGhpcy50aW1lcyA9IGFzeW5jLnRpbWVzO1xuXHR0aGlzLnRpbWVzU2VyaWVzID0gYXN5bmMudGltZXNTZXJpZXM7XG5cdHRoaXMuVXRpbHMgPSBhc3luYy5VdGlscztcblxuXHQvLyBVdGlsc1xuXHR0aGlzLm1lbW9pemUgPSBhc3luYy5tZW1vaXplO1xuXHR0aGlzLnVubWVtb2l6ZSA9IGFzeW5jLnVubWVtb2l6ZTtcblx0dGhpcy5sb2cgPSBhc3luYy5sb2c7XG5cdHRoaXMuZGlyID0gYXN5bmMuZGlyO1xuXHR0aGlzLm5vQ29uZmxpY3QgPSBhc3luYy5ub0NvbmZsaWN0O1xuXHQvLyB9fX1cblxuXHR0aGlzLnJlc2V0KCk7XG5cdHJldHVybiB0aGlzO1xufVxuXG4vLyBSZXR1cm4gdGhlIG91dHB1dCBvYmplY3Rcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gYXN5bmNDaGFpbmFibGUoKSB7XG5cdHJldHVybiBuZXcgb2JqZWN0SW5zdGFuY2U7XG59O1xuIiwiLyohXG4gKiBhc3luY1xuICogaHR0cHM6Ly9naXRodWIuY29tL2Nhb2xhbi9hc3luY1xuICpcbiAqIENvcHlyaWdodCAyMDEwLTIwMTQgQ2FvbGFuIE1jTWFob25cbiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZVxuICovXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgdmFyIGFzeW5jID0ge307XG4gICAgZnVuY3Rpb24gbm9vcCgpIHt9XG4gICAgZnVuY3Rpb24gaWRlbnRpdHkodikge1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9XG4gICAgZnVuY3Rpb24gdG9Cb29sKHYpIHtcbiAgICAgICAgcmV0dXJuICEhdjtcbiAgICB9XG4gICAgZnVuY3Rpb24gbm90SWQodikge1xuICAgICAgICByZXR1cm4gIXY7XG4gICAgfVxuXG4gICAgLy8gZ2xvYmFsIG9uIHRoZSBzZXJ2ZXIsIHdpbmRvdyBpbiB0aGUgYnJvd3NlclxuICAgIHZhciBwcmV2aW91c19hc3luYztcblxuICAgIC8vIEVzdGFibGlzaCB0aGUgcm9vdCBvYmplY3QsIGB3aW5kb3dgIChgc2VsZmApIGluIHRoZSBicm93c2VyLCBgZ2xvYmFsYFxuICAgIC8vIG9uIHRoZSBzZXJ2ZXIsIG9yIGB0aGlzYCBpbiBzb21lIHZpcnR1YWwgbWFjaGluZXMuIFdlIHVzZSBgc2VsZmBcbiAgICAvLyBpbnN0ZWFkIG9mIGB3aW5kb3dgIGZvciBgV2ViV29ya2VyYCBzdXBwb3J0LlxuICAgIHZhciByb290ID0gdHlwZW9mIHNlbGYgPT09ICdvYmplY3QnICYmIHNlbGYuc2VsZiA9PT0gc2VsZiAmJiBzZWxmIHx8XG4gICAgICAgICAgICB0eXBlb2YgZ2xvYmFsID09PSAnb2JqZWN0JyAmJiBnbG9iYWwuZ2xvYmFsID09PSBnbG9iYWwgJiYgZ2xvYmFsIHx8XG4gICAgICAgICAgICB0aGlzO1xuXG4gICAgaWYgKHJvb3QgIT0gbnVsbCkge1xuICAgICAgICBwcmV2aW91c19hc3luYyA9IHJvb3QuYXN5bmM7XG4gICAgfVxuXG4gICAgYXN5bmMubm9Db25mbGljdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcm9vdC5hc3luYyA9IHByZXZpb3VzX2FzeW5jO1xuICAgICAgICByZXR1cm4gYXN5bmM7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIG9ubHlfb25jZShmbikge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoZm4gPT09IG51bGwpIHRocm93IG5ldyBFcnJvcihcIkNhbGxiYWNrIHdhcyBhbHJlYWR5IGNhbGxlZC5cIik7XG4gICAgICAgICAgICBmbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgZm4gPSBudWxsO1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIF9vbmNlKGZuKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChmbiA9PT0gbnVsbCkgcmV0dXJuO1xuICAgICAgICAgICAgZm4uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgIGZuID0gbnVsbDtcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvLy8vIGNyb3NzLWJyb3dzZXIgY29tcGF0aWJsaXR5IGZ1bmN0aW9ucyAvLy8vXG5cbiAgICB2YXIgX3RvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZztcblxuICAgIHZhciBfaXNBcnJheSA9IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24gKG9iaikge1xuICAgICAgICByZXR1cm4gX3RvU3RyaW5nLmNhbGwob2JqKSA9PT0gJ1tvYmplY3QgQXJyYXldJztcbiAgICB9O1xuXG4gICAgLy8gUG9ydGVkIGZyb20gdW5kZXJzY29yZS5qcyBpc09iamVjdFxuICAgIHZhciBfaXNPYmplY3QgPSBmdW5jdGlvbihvYmopIHtcbiAgICAgICAgdmFyIHR5cGUgPSB0eXBlb2Ygb2JqO1xuICAgICAgICByZXR1cm4gdHlwZSA9PT0gJ2Z1bmN0aW9uJyB8fCB0eXBlID09PSAnb2JqZWN0JyAmJiAhIW9iajtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gX2lzQXJyYXlMaWtlKGFycikge1xuICAgICAgICByZXR1cm4gX2lzQXJyYXkoYXJyKSB8fCAoXG4gICAgICAgICAgICAvLyBoYXMgYSBwb3NpdGl2ZSBpbnRlZ2VyIGxlbmd0aCBwcm9wZXJ0eVxuICAgICAgICAgICAgdHlwZW9mIGFyci5sZW5ndGggPT09IFwibnVtYmVyXCIgJiZcbiAgICAgICAgICAgIGFyci5sZW5ndGggPj0gMCAmJlxuICAgICAgICAgICAgYXJyLmxlbmd0aCAlIDEgPT09IDBcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfZWFjaChjb2xsLCBpdGVyYXRvcikge1xuICAgICAgICByZXR1cm4gX2lzQXJyYXlMaWtlKGNvbGwpID9cbiAgICAgICAgICAgIF9hcnJheUVhY2goY29sbCwgaXRlcmF0b3IpIDpcbiAgICAgICAgICAgIF9mb3JFYWNoT2YoY29sbCwgaXRlcmF0b3IpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIF9hcnJheUVhY2goYXJyLCBpdGVyYXRvcikge1xuICAgICAgICB2YXIgaW5kZXggPSAtMSxcbiAgICAgICAgICAgIGxlbmd0aCA9IGFyci5sZW5ndGg7XG5cbiAgICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgICAgICAgIGl0ZXJhdG9yKGFycltpbmRleF0sIGluZGV4LCBhcnIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gX21hcChhcnIsIGl0ZXJhdG9yKSB7XG4gICAgICAgIHZhciBpbmRleCA9IC0xLFxuICAgICAgICAgICAgbGVuZ3RoID0gYXJyLmxlbmd0aCxcbiAgICAgICAgICAgIHJlc3VsdCA9IEFycmF5KGxlbmd0aCk7XG5cbiAgICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICAgICAgICAgIHJlc3VsdFtpbmRleF0gPSBpdGVyYXRvcihhcnJbaW5kZXhdLCBpbmRleCwgYXJyKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIF9yYW5nZShjb3VudCkge1xuICAgICAgICByZXR1cm4gX21hcChBcnJheShjb3VudCksIGZ1bmN0aW9uICh2LCBpKSB7IHJldHVybiBpOyB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfcmVkdWNlKGFyciwgaXRlcmF0b3IsIG1lbW8pIHtcbiAgICAgICAgX2FycmF5RWFjaChhcnIsIGZ1bmN0aW9uICh4LCBpLCBhKSB7XG4gICAgICAgICAgICBtZW1vID0gaXRlcmF0b3IobWVtbywgeCwgaSwgYSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gbWVtbztcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfZm9yRWFjaE9mKG9iamVjdCwgaXRlcmF0b3IpIHtcbiAgICAgICAgX2FycmF5RWFjaChfa2V5cyhvYmplY3QpLCBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICBpdGVyYXRvcihvYmplY3Rba2V5XSwga2V5KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gX2luZGV4T2YoYXJyLCBpdGVtKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoYXJyW2ldID09PSBpdGVtKSByZXR1cm4gaTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gLTE7XG4gICAgfVxuXG4gICAgdmFyIF9rZXlzID0gT2JqZWN0LmtleXMgfHwgZnVuY3Rpb24gKG9iaikge1xuICAgICAgICB2YXIga2V5cyA9IFtdO1xuICAgICAgICBmb3IgKHZhciBrIGluIG9iaikge1xuICAgICAgICAgICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShrKSkge1xuICAgICAgICAgICAgICAgIGtleXMucHVzaChrKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ga2V5cztcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gX2tleUl0ZXJhdG9yKGNvbGwpIHtcbiAgICAgICAgdmFyIGkgPSAtMTtcbiAgICAgICAgdmFyIGxlbjtcbiAgICAgICAgdmFyIGtleXM7XG4gICAgICAgIGlmIChfaXNBcnJheUxpa2UoY29sbCkpIHtcbiAgICAgICAgICAgIGxlbiA9IGNvbGwubGVuZ3RoO1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIG5leHQoKSB7XG4gICAgICAgICAgICAgICAgaSsrO1xuICAgICAgICAgICAgICAgIHJldHVybiBpIDwgbGVuID8gaSA6IG51bGw7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAga2V5cyA9IF9rZXlzKGNvbGwpO1xuICAgICAgICAgICAgbGVuID0ga2V5cy5sZW5ndGg7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gbmV4dCgpIHtcbiAgICAgICAgICAgICAgICBpKys7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGkgPCBsZW4gPyBrZXlzW2ldIDogbnVsbDtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBTaW1pbGFyIHRvIEVTNidzIHJlc3QgcGFyYW0gKGh0dHA6Ly9hcml5YS5vZmlsYWJzLmNvbS8yMDEzLzAzL2VzNi1hbmQtcmVzdC1wYXJhbWV0ZXIuaHRtbClcbiAgICAvLyBUaGlzIGFjY3VtdWxhdGVzIHRoZSBhcmd1bWVudHMgcGFzc2VkIGludG8gYW4gYXJyYXksIGFmdGVyIGEgZ2l2ZW4gaW5kZXguXG4gICAgLy8gRnJvbSB1bmRlcnNjb3JlLmpzIChodHRwczovL2dpdGh1Yi5jb20vamFzaGtlbmFzL3VuZGVyc2NvcmUvcHVsbC8yMTQwKS5cbiAgICBmdW5jdGlvbiBfcmVzdFBhcmFtKGZ1bmMsIHN0YXJ0SW5kZXgpIHtcbiAgICAgICAgc3RhcnRJbmRleCA9IHN0YXJ0SW5kZXggPT0gbnVsbCA/IGZ1bmMubGVuZ3RoIC0gMSA6ICtzdGFydEluZGV4O1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgbGVuZ3RoID0gTWF0aC5tYXgoYXJndW1lbnRzLmxlbmd0aCAtIHN0YXJ0SW5kZXgsIDApO1xuICAgICAgICAgICAgdmFyIHJlc3QgPSBBcnJheShsZW5ndGgpO1xuICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICAgICAgICAgIHJlc3RbaW5kZXhdID0gYXJndW1lbnRzW2luZGV4ICsgc3RhcnRJbmRleF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzd2l0Y2ggKHN0YXJ0SW5kZXgpIHtcbiAgICAgICAgICAgICAgICBjYXNlIDA6IHJldHVybiBmdW5jLmNhbGwodGhpcywgcmVzdCk7XG4gICAgICAgICAgICAgICAgY2FzZSAxOiByZXR1cm4gZnVuYy5jYWxsKHRoaXMsIGFyZ3VtZW50c1swXSwgcmVzdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBDdXJyZW50bHkgdW51c2VkIGJ1dCBoYW5kbGUgY2FzZXMgb3V0c2lkZSBvZiB0aGUgc3dpdGNoIHN0YXRlbWVudDpcbiAgICAgICAgICAgIC8vIHZhciBhcmdzID0gQXJyYXkoc3RhcnRJbmRleCArIDEpO1xuICAgICAgICAgICAgLy8gZm9yIChpbmRleCA9IDA7IGluZGV4IDwgc3RhcnRJbmRleDsgaW5kZXgrKykge1xuICAgICAgICAgICAgLy8gICAgIGFyZ3NbaW5kZXhdID0gYXJndW1lbnRzW2luZGV4XTtcbiAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgIC8vIGFyZ3Nbc3RhcnRJbmRleF0gPSByZXN0O1xuICAgICAgICAgICAgLy8gcmV0dXJuIGZ1bmMuYXBwbHkodGhpcywgYXJncyk7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gX3dpdGhvdXRJbmRleChpdGVyYXRvcikge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbHVlLCBpbmRleCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHJldHVybiBpdGVyYXRvcih2YWx1ZSwgY2FsbGJhY2spO1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIC8vLy8gZXhwb3J0ZWQgYXN5bmMgbW9kdWxlIGZ1bmN0aW9ucyAvLy8vXG5cbiAgICAvLy8vIG5leHRUaWNrIGltcGxlbWVudGF0aW9uIHdpdGggYnJvd3Nlci1jb21wYXRpYmxlIGZhbGxiYWNrIC8vLy9cblxuICAgIC8vIGNhcHR1cmUgdGhlIGdsb2JhbCByZWZlcmVuY2UgdG8gZ3VhcmQgYWdhaW5zdCBmYWtlVGltZXIgbW9ja3NcbiAgICB2YXIgX3NldEltbWVkaWF0ZSA9IHR5cGVvZiBzZXRJbW1lZGlhdGUgPT09ICdmdW5jdGlvbicgJiYgc2V0SW1tZWRpYXRlO1xuXG4gICAgdmFyIF9kZWxheSA9IF9zZXRJbW1lZGlhdGUgPyBmdW5jdGlvbihmbikge1xuICAgICAgICAvLyBub3QgYSBkaXJlY3QgYWxpYXMgZm9yIElFMTAgY29tcGF0aWJpbGl0eVxuICAgICAgICBfc2V0SW1tZWRpYXRlKGZuKTtcbiAgICB9IDogZnVuY3Rpb24oZm4pIHtcbiAgICAgICAgc2V0VGltZW91dChmbiwgMCk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2YgcHJvY2VzcyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIHByb2Nlc3MubmV4dFRpY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgYXN5bmMubmV4dFRpY2sgPSBwcm9jZXNzLm5leHRUaWNrO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGFzeW5jLm5leHRUaWNrID0gX2RlbGF5O1xuICAgIH1cbiAgICBhc3luYy5zZXRJbW1lZGlhdGUgPSBfc2V0SW1tZWRpYXRlID8gX2RlbGF5IDogYXN5bmMubmV4dFRpY2s7XG5cblxuICAgIGFzeW5jLmZvckVhY2ggPVxuICAgIGFzeW5jLmVhY2ggPSBmdW5jdGlvbiAoYXJyLCBpdGVyYXRvciwgY2FsbGJhY2spIHtcbiAgICAgICAgcmV0dXJuIGFzeW5jLmVhY2hPZihhcnIsIF93aXRob3V0SW5kZXgoaXRlcmF0b3IpLCBjYWxsYmFjayk7XG4gICAgfTtcblxuICAgIGFzeW5jLmZvckVhY2hTZXJpZXMgPVxuICAgIGFzeW5jLmVhY2hTZXJpZXMgPSBmdW5jdGlvbiAoYXJyLCBpdGVyYXRvciwgY2FsbGJhY2spIHtcbiAgICAgICAgcmV0dXJuIGFzeW5jLmVhY2hPZlNlcmllcyhhcnIsIF93aXRob3V0SW5kZXgoaXRlcmF0b3IpLCBjYWxsYmFjayk7XG4gICAgfTtcblxuXG4gICAgYXN5bmMuZm9yRWFjaExpbWl0ID1cbiAgICBhc3luYy5lYWNoTGltaXQgPSBmdW5jdGlvbiAoYXJyLCBsaW1pdCwgaXRlcmF0b3IsIGNhbGxiYWNrKSB7XG4gICAgICAgIHJldHVybiBfZWFjaE9mTGltaXQobGltaXQpKGFyciwgX3dpdGhvdXRJbmRleChpdGVyYXRvciksIGNhbGxiYWNrKTtcbiAgICB9O1xuXG4gICAgYXN5bmMuZm9yRWFjaE9mID1cbiAgICBhc3luYy5lYWNoT2YgPSBmdW5jdGlvbiAob2JqZWN0LCBpdGVyYXRvciwgY2FsbGJhY2spIHtcbiAgICAgICAgY2FsbGJhY2sgPSBfb25jZShjYWxsYmFjayB8fCBub29wKTtcbiAgICAgICAgb2JqZWN0ID0gb2JqZWN0IHx8IFtdO1xuICAgICAgICB2YXIgc2l6ZSA9IF9pc0FycmF5TGlrZShvYmplY3QpID8gb2JqZWN0Lmxlbmd0aCA6IF9rZXlzKG9iamVjdCkubGVuZ3RoO1xuICAgICAgICB2YXIgY29tcGxldGVkID0gMDtcbiAgICAgICAgaWYgKCFzaXplKSB7XG4gICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCk7XG4gICAgICAgIH1cbiAgICAgICAgX2VhY2gob2JqZWN0LCBmdW5jdGlvbiAodmFsdWUsIGtleSkge1xuICAgICAgICAgICAgaXRlcmF0b3Iob2JqZWN0W2tleV0sIGtleSwgb25seV9vbmNlKGRvbmUpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGZ1bmN0aW9uIGRvbmUoZXJyKSB7XG4gICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbXBsZXRlZCArPSAxO1xuICAgICAgICAgICAgICAgIGlmIChjb21wbGV0ZWQgPj0gc2l6ZSkge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgYXN5bmMuZm9yRWFjaE9mU2VyaWVzID1cbiAgICBhc3luYy5lYWNoT2ZTZXJpZXMgPSBmdW5jdGlvbiAob2JqLCBpdGVyYXRvciwgY2FsbGJhY2spIHtcbiAgICAgICAgY2FsbGJhY2sgPSBfb25jZShjYWxsYmFjayB8fCBub29wKTtcbiAgICAgICAgb2JqID0gb2JqIHx8IFtdO1xuICAgICAgICB2YXIgbmV4dEtleSA9IF9rZXlJdGVyYXRvcihvYmopO1xuICAgICAgICB2YXIga2V5ID0gbmV4dEtleSgpO1xuICAgICAgICBmdW5jdGlvbiBpdGVyYXRlKCkge1xuICAgICAgICAgICAgdmFyIHN5bmMgPSB0cnVlO1xuICAgICAgICAgICAgaWYgKGtleSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhudWxsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGl0ZXJhdG9yKG9ialtrZXldLCBrZXksIG9ubHlfb25jZShmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAga2V5ID0gbmV4dEtleSgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3luYykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzeW5jLm5leHRUaWNrKGl0ZXJhdGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVyYXRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICBzeW5jID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaXRlcmF0ZSgpO1xuICAgIH07XG5cblxuXG4gICAgYXN5bmMuZm9yRWFjaE9mTGltaXQgPVxuICAgIGFzeW5jLmVhY2hPZkxpbWl0ID0gZnVuY3Rpb24gKG9iaiwgbGltaXQsIGl0ZXJhdG9yLCBjYWxsYmFjaykge1xuICAgICAgICBfZWFjaE9mTGltaXQobGltaXQpKG9iaiwgaXRlcmF0b3IsIGNhbGxiYWNrKTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gX2VhY2hPZkxpbWl0KGxpbWl0KSB7XG5cbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChvYmosIGl0ZXJhdG9yLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgY2FsbGJhY2sgPSBfb25jZShjYWxsYmFjayB8fCBub29wKTtcbiAgICAgICAgICAgIG9iaiA9IG9iaiB8fCBbXTtcbiAgICAgICAgICAgIHZhciBuZXh0S2V5ID0gX2tleUl0ZXJhdG9yKG9iaik7XG4gICAgICAgICAgICBpZiAobGltaXQgPD0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhudWxsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBkb25lID0gZmFsc2U7XG4gICAgICAgICAgICB2YXIgcnVubmluZyA9IDA7XG4gICAgICAgICAgICB2YXIgZXJyb3JlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgICAoZnVuY3Rpb24gcmVwbGVuaXNoICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoZG9uZSAmJiBydW5uaW5nIDw9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHdoaWxlIChydW5uaW5nIDwgbGltaXQgJiYgIWVycm9yZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGtleSA9IG5leHRLZXkoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZG9uZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocnVubmluZyA8PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcnVubmluZyArPSAxO1xuICAgICAgICAgICAgICAgICAgICBpdGVyYXRvcihvYmpba2V5XSwga2V5LCBvbmx5X29uY2UoZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcnVubmluZyAtPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBsZW5pc2goKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pKCk7XG4gICAgICAgIH07XG4gICAgfVxuXG5cbiAgICBmdW5jdGlvbiBkb1BhcmFsbGVsKGZuKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAob2JqLCBpdGVyYXRvciwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHJldHVybiBmbihhc3luYy5lYWNoT2YsIG9iaiwgaXRlcmF0b3IsIGNhbGxiYWNrKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZG9QYXJhbGxlbExpbWl0KGZuKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAob2JqLCBsaW1pdCwgaXRlcmF0b3IsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICByZXR1cm4gZm4oX2VhY2hPZkxpbWl0KGxpbWl0KSwgb2JqLCBpdGVyYXRvciwgY2FsbGJhY2spO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBmdW5jdGlvbiBkb1Nlcmllcyhmbikge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKG9iaiwgaXRlcmF0b3IsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICByZXR1cm4gZm4oYXN5bmMuZWFjaE9mU2VyaWVzLCBvYmosIGl0ZXJhdG9yLCBjYWxsYmFjayk7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gX2FzeW5jTWFwKGVhY2hmbiwgYXJyLCBpdGVyYXRvciwgY2FsbGJhY2spIHtcbiAgICAgICAgY2FsbGJhY2sgPSBfb25jZShjYWxsYmFjayB8fCBub29wKTtcbiAgICAgICAgdmFyIHJlc3VsdHMgPSBbXTtcbiAgICAgICAgZWFjaGZuKGFyciwgZnVuY3Rpb24gKHZhbHVlLCBpbmRleCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGl0ZXJhdG9yKHZhbHVlLCBmdW5jdGlvbiAoZXJyLCB2KSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0c1tpbmRleF0gPSB2O1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgY2FsbGJhY2soZXJyLCByZXN1bHRzKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgYXN5bmMubWFwID0gZG9QYXJhbGxlbChfYXN5bmNNYXApO1xuICAgIGFzeW5jLm1hcFNlcmllcyA9IGRvU2VyaWVzKF9hc3luY01hcCk7XG4gICAgYXN5bmMubWFwTGltaXQgPSBkb1BhcmFsbGVsTGltaXQoX2FzeW5jTWFwKTtcblxuICAgIC8vIHJlZHVjZSBvbmx5IGhhcyBhIHNlcmllcyB2ZXJzaW9uLCBhcyBkb2luZyByZWR1Y2UgaW4gcGFyYWxsZWwgd29uJ3RcbiAgICAvLyB3b3JrIGluIG1hbnkgc2l0dWF0aW9ucy5cbiAgICBhc3luYy5pbmplY3QgPVxuICAgIGFzeW5jLmZvbGRsID1cbiAgICBhc3luYy5yZWR1Y2UgPSBmdW5jdGlvbiAoYXJyLCBtZW1vLCBpdGVyYXRvciwgY2FsbGJhY2spIHtcbiAgICAgICAgYXN5bmMuZWFjaE9mU2VyaWVzKGFyciwgZnVuY3Rpb24gKHgsIGksIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBpdGVyYXRvcihtZW1vLCB4LCBmdW5jdGlvbiAoZXJyLCB2KSB7XG4gICAgICAgICAgICAgICAgbWVtbyA9IHY7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhlcnIgfHwgbnVsbCwgbWVtbyk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBhc3luYy5mb2xkciA9XG4gICAgYXN5bmMucmVkdWNlUmlnaHQgPSBmdW5jdGlvbiAoYXJyLCBtZW1vLCBpdGVyYXRvciwgY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIHJldmVyc2VkID0gX21hcChhcnIsIGlkZW50aXR5KS5yZXZlcnNlKCk7XG4gICAgICAgIGFzeW5jLnJlZHVjZShyZXZlcnNlZCwgbWVtbywgaXRlcmF0b3IsIGNhbGxiYWNrKTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gX2ZpbHRlcihlYWNoZm4sIGFyciwgaXRlcmF0b3IsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciByZXN1bHRzID0gW107XG4gICAgICAgIGVhY2hmbihhcnIsIGZ1bmN0aW9uICh4LCBpbmRleCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGl0ZXJhdG9yKHgsIGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICAgICAgaWYgKHYpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHtpbmRleDogaW5kZXgsIHZhbHVlOiB4fSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY2FsbGJhY2soX21hcChyZXN1bHRzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYS5pbmRleCAtIGIuaW5kZXg7XG4gICAgICAgICAgICB9KSwgZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geC52YWx1ZTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgYXN5bmMuc2VsZWN0ID1cbiAgICBhc3luYy5maWx0ZXIgPSBkb1BhcmFsbGVsKF9maWx0ZXIpO1xuXG4gICAgYXN5bmMuc2VsZWN0TGltaXQgPVxuICAgIGFzeW5jLmZpbHRlckxpbWl0ID0gZG9QYXJhbGxlbExpbWl0KF9maWx0ZXIpO1xuXG4gICAgYXN5bmMuc2VsZWN0U2VyaWVzID1cbiAgICBhc3luYy5maWx0ZXJTZXJpZXMgPSBkb1NlcmllcyhfZmlsdGVyKTtcblxuICAgIGZ1bmN0aW9uIF9yZWplY3QoZWFjaGZuLCBhcnIsIGl0ZXJhdG9yLCBjYWxsYmFjaykge1xuICAgICAgICBfZmlsdGVyKGVhY2hmbiwgYXJyLCBmdW5jdGlvbih2YWx1ZSwgY2IpIHtcbiAgICAgICAgICAgIGl0ZXJhdG9yKHZhbHVlLCBmdW5jdGlvbih2KSB7XG4gICAgICAgICAgICAgICAgY2IoIXYpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sIGNhbGxiYWNrKTtcbiAgICB9XG4gICAgYXN5bmMucmVqZWN0ID0gZG9QYXJhbGxlbChfcmVqZWN0KTtcbiAgICBhc3luYy5yZWplY3RMaW1pdCA9IGRvUGFyYWxsZWxMaW1pdChfcmVqZWN0KTtcbiAgICBhc3luYy5yZWplY3RTZXJpZXMgPSBkb1NlcmllcyhfcmVqZWN0KTtcblxuICAgIGZ1bmN0aW9uIF9jcmVhdGVUZXN0ZXIoZWFjaGZuLCBjaGVjaywgZ2V0UmVzdWx0KSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbihhcnIsIGxpbWl0LCBpdGVyYXRvciwgY2IpIHtcbiAgICAgICAgICAgIGZ1bmN0aW9uIGRvbmUoKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNiKSBjYihnZXRSZXN1bHQoZmFsc2UsIHZvaWQgMCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZnVuY3Rpb24gaXRlcmF0ZWUoeCwgXywgY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBpZiAoIWNiKSByZXR1cm4gY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICBpdGVyYXRvcih4LCBmdW5jdGlvbiAodikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2IgJiYgY2hlY2sodikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNiKGdldFJlc3VsdCh0cnVlLCB4KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYiA9IGl0ZXJhdG9yID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMykge1xuICAgICAgICAgICAgICAgIGVhY2hmbihhcnIsIGxpbWl0LCBpdGVyYXRlZSwgZG9uZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNiID0gaXRlcmF0b3I7XG4gICAgICAgICAgICAgICAgaXRlcmF0b3IgPSBsaW1pdDtcbiAgICAgICAgICAgICAgICBlYWNoZm4oYXJyLCBpdGVyYXRlZSwgZG9uZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgYXN5bmMuYW55ID1cbiAgICBhc3luYy5zb21lID0gX2NyZWF0ZVRlc3Rlcihhc3luYy5lYWNoT2YsIHRvQm9vbCwgaWRlbnRpdHkpO1xuXG4gICAgYXN5bmMuc29tZUxpbWl0ID0gX2NyZWF0ZVRlc3Rlcihhc3luYy5lYWNoT2ZMaW1pdCwgdG9Cb29sLCBpZGVudGl0eSk7XG5cbiAgICBhc3luYy5hbGwgPVxuICAgIGFzeW5jLmV2ZXJ5ID0gX2NyZWF0ZVRlc3Rlcihhc3luYy5lYWNoT2YsIG5vdElkLCBub3RJZCk7XG5cbiAgICBhc3luYy5ldmVyeUxpbWl0ID0gX2NyZWF0ZVRlc3Rlcihhc3luYy5lYWNoT2ZMaW1pdCwgbm90SWQsIG5vdElkKTtcblxuICAgIGZ1bmN0aW9uIF9maW5kR2V0UmVzdWx0KHYsIHgpIHtcbiAgICAgICAgcmV0dXJuIHg7XG4gICAgfVxuICAgIGFzeW5jLmRldGVjdCA9IF9jcmVhdGVUZXN0ZXIoYXN5bmMuZWFjaE9mLCBpZGVudGl0eSwgX2ZpbmRHZXRSZXN1bHQpO1xuICAgIGFzeW5jLmRldGVjdFNlcmllcyA9IF9jcmVhdGVUZXN0ZXIoYXN5bmMuZWFjaE9mU2VyaWVzLCBpZGVudGl0eSwgX2ZpbmRHZXRSZXN1bHQpO1xuICAgIGFzeW5jLmRldGVjdExpbWl0ID0gX2NyZWF0ZVRlc3Rlcihhc3luYy5lYWNoT2ZMaW1pdCwgaWRlbnRpdHksIF9maW5kR2V0UmVzdWx0KTtcblxuICAgIGFzeW5jLnNvcnRCeSA9IGZ1bmN0aW9uIChhcnIsIGl0ZXJhdG9yLCBjYWxsYmFjaykge1xuICAgICAgICBhc3luYy5tYXAoYXJyLCBmdW5jdGlvbiAoeCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGl0ZXJhdG9yKHgsIGZ1bmN0aW9uIChlcnIsIGNyaXRlcmlhKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwge3ZhbHVlOiB4LCBjcml0ZXJpYTogY3JpdGVyaWF9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVyciwgcmVzdWx0cykge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgX21hcChyZXN1bHRzLnNvcnQoY29tcGFyYXRvciksIGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB4LnZhbHVlO1xuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcblxuICAgICAgICBmdW5jdGlvbiBjb21wYXJhdG9yKGxlZnQsIHJpZ2h0KSB7XG4gICAgICAgICAgICB2YXIgYSA9IGxlZnQuY3JpdGVyaWEsIGIgPSByaWdodC5jcml0ZXJpYTtcbiAgICAgICAgICAgIHJldHVybiBhIDwgYiA/IC0xIDogYSA+IGIgPyAxIDogMDtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBhc3luYy5hdXRvID0gZnVuY3Rpb24gKHRhc2tzLCBjYWxsYmFjaykge1xuICAgICAgICBjYWxsYmFjayA9IF9vbmNlKGNhbGxiYWNrIHx8IG5vb3ApO1xuICAgICAgICB2YXIga2V5cyA9IF9rZXlzKHRhc2tzKTtcbiAgICAgICAgdmFyIHJlbWFpbmluZ1Rhc2tzID0ga2V5cy5sZW5ndGg7XG4gICAgICAgIGlmICghcmVtYWluaW5nVGFza3MpIHtcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhudWxsKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciByZXN1bHRzID0ge307XG5cbiAgICAgICAgdmFyIGxpc3RlbmVycyA9IFtdO1xuICAgICAgICBmdW5jdGlvbiBhZGRMaXN0ZW5lcihmbikge1xuICAgICAgICAgICAgbGlzdGVuZXJzLnVuc2hpZnQoZm4pO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHJlbW92ZUxpc3RlbmVyKGZuKSB7XG4gICAgICAgICAgICB2YXIgaWR4ID0gX2luZGV4T2YobGlzdGVuZXJzLCBmbik7XG4gICAgICAgICAgICBpZiAoaWR4ID49IDApIGxpc3RlbmVycy5zcGxpY2UoaWR4LCAxKTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiB0YXNrQ29tcGxldGUoKSB7XG4gICAgICAgICAgICByZW1haW5pbmdUYXNrcy0tO1xuICAgICAgICAgICAgX2FycmF5RWFjaChsaXN0ZW5lcnMuc2xpY2UoMCksIGZ1bmN0aW9uIChmbikge1xuICAgICAgICAgICAgICAgIGZuKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGFkZExpc3RlbmVyKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghcmVtYWluaW5nVGFza3MpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgX2FycmF5RWFjaChrZXlzLCBmdW5jdGlvbiAoaykge1xuICAgICAgICAgICAgdmFyIHRhc2sgPSBfaXNBcnJheSh0YXNrc1trXSkgPyB0YXNrc1trXTogW3Rhc2tzW2tdXTtcbiAgICAgICAgICAgIHZhciB0YXNrQ2FsbGJhY2sgPSBfcmVzdFBhcmFtKGZ1bmN0aW9uKGVyciwgYXJncykge1xuICAgICAgICAgICAgICAgIGlmIChhcmdzLmxlbmd0aCA8PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGFyZ3MgPSBhcmdzWzBdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzYWZlUmVzdWx0cyA9IHt9O1xuICAgICAgICAgICAgICAgICAgICBfZm9yRWFjaE9mKHJlc3VsdHMsIGZ1bmN0aW9uKHZhbCwgcmtleSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2FmZVJlc3VsdHNbcmtleV0gPSB2YWw7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBzYWZlUmVzdWx0c1trXSA9IGFyZ3M7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVyciwgc2FmZVJlc3VsdHMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0c1trXSA9IGFyZ3M7XG4gICAgICAgICAgICAgICAgICAgIGFzeW5jLnNldEltbWVkaWF0ZSh0YXNrQ29tcGxldGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmFyIHJlcXVpcmVzID0gdGFzay5zbGljZSgwLCB0YXNrLmxlbmd0aCAtIDEpO1xuICAgICAgICAgICAgLy8gcHJldmVudCBkZWFkLWxvY2tzXG4gICAgICAgICAgICB2YXIgbGVuID0gcmVxdWlyZXMubGVuZ3RoO1xuICAgICAgICAgICAgdmFyIGRlcDtcbiAgICAgICAgICAgIHdoaWxlIChsZW4tLSkge1xuICAgICAgICAgICAgICAgIGlmICghKGRlcCA9IHRhc2tzW3JlcXVpcmVzW2xlbl1dKSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0hhcyBpbmV4aXN0YW50IGRlcGVuZGVuY3knKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKF9pc0FycmF5KGRlcCkgJiYgX2luZGV4T2YoZGVwLCBrKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSGFzIGN5Y2xpYyBkZXBlbmRlbmNpZXMnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmdW5jdGlvbiByZWFkeSgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gX3JlZHVjZShyZXF1aXJlcywgZnVuY3Rpb24gKGEsIHgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChhICYmIHJlc3VsdHMuaGFzT3duUHJvcGVydHkoeCkpO1xuICAgICAgICAgICAgICAgIH0sIHRydWUpICYmICFyZXN1bHRzLmhhc093blByb3BlcnR5KGspO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHJlYWR5KCkpIHtcbiAgICAgICAgICAgICAgICB0YXNrW3Rhc2subGVuZ3RoIC0gMV0odGFza0NhbGxiYWNrLCByZXN1bHRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGFkZExpc3RlbmVyKGxpc3RlbmVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZ1bmN0aW9uIGxpc3RlbmVyKCkge1xuICAgICAgICAgICAgICAgIGlmIChyZWFkeSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZUxpc3RlbmVyKGxpc3RlbmVyKTtcbiAgICAgICAgICAgICAgICAgICAgdGFza1t0YXNrLmxlbmd0aCAtIDFdKHRhc2tDYWxsYmFjaywgcmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuXG5cblxuICAgIGFzeW5jLnJldHJ5ID0gZnVuY3Rpb24odGltZXMsIHRhc2ssIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBERUZBVUxUX1RJTUVTID0gNTtcbiAgICAgICAgdmFyIERFRkFVTFRfSU5URVJWQUwgPSAwO1xuXG4gICAgICAgIHZhciBhdHRlbXB0cyA9IFtdO1xuXG4gICAgICAgIHZhciBvcHRzID0ge1xuICAgICAgICAgICAgdGltZXM6IERFRkFVTFRfVElNRVMsXG4gICAgICAgICAgICBpbnRlcnZhbDogREVGQVVMVF9JTlRFUlZBTFxuICAgICAgICB9O1xuXG4gICAgICAgIGZ1bmN0aW9uIHBhcnNlVGltZXMoYWNjLCB0KXtcbiAgICAgICAgICAgIGlmKHR5cGVvZiB0ID09PSAnbnVtYmVyJyl7XG4gICAgICAgICAgICAgICAgYWNjLnRpbWVzID0gcGFyc2VJbnQodCwgMTApIHx8IERFRkFVTFRfVElNRVM7XG4gICAgICAgICAgICB9IGVsc2UgaWYodHlwZW9mIHQgPT09ICdvYmplY3QnKXtcbiAgICAgICAgICAgICAgICBhY2MudGltZXMgPSBwYXJzZUludCh0LnRpbWVzLCAxMCkgfHwgREVGQVVMVF9USU1FUztcbiAgICAgICAgICAgICAgICBhY2MuaW50ZXJ2YWwgPSBwYXJzZUludCh0LmludGVydmFsLCAxMCkgfHwgREVGQVVMVF9JTlRFUlZBTDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbnN1cHBvcnRlZCBhcmd1bWVudCB0eXBlIGZvciBcXCd0aW1lc1xcJzogJyArIHR5cGVvZiB0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoO1xuICAgICAgICBpZiAobGVuZ3RoIDwgMSB8fCBsZW5ndGggPiAzKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgYXJndW1lbnRzIC0gbXVzdCBiZSBlaXRoZXIgKHRhc2spLCAodGFzaywgY2FsbGJhY2spLCAodGltZXMsIHRhc2spIG9yICh0aW1lcywgdGFzaywgY2FsbGJhY2spJyk7XG4gICAgICAgIH0gZWxzZSBpZiAobGVuZ3RoIDw9IDIgJiYgdHlwZW9mIHRpbWVzID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBjYWxsYmFjayA9IHRhc2s7XG4gICAgICAgICAgICB0YXNrID0gdGltZXM7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiB0aW1lcyAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgcGFyc2VUaW1lcyhvcHRzLCB0aW1lcyk7XG4gICAgICAgIH1cbiAgICAgICAgb3B0cy5jYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgICAgICBvcHRzLnRhc2sgPSB0YXNrO1xuXG4gICAgICAgIGZ1bmN0aW9uIHdyYXBwZWRUYXNrKHdyYXBwZWRDYWxsYmFjaywgd3JhcHBlZFJlc3VsdHMpIHtcbiAgICAgICAgICAgIGZ1bmN0aW9uIHJldHJ5QXR0ZW1wdCh0YXNrLCBmaW5hbEF0dGVtcHQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oc2VyaWVzQ2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgdGFzayhmdW5jdGlvbihlcnIsIHJlc3VsdCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXJpZXNDYWxsYmFjayghZXJyIHx8IGZpbmFsQXR0ZW1wdCwge2VycjogZXJyLCByZXN1bHQ6IHJlc3VsdH0pO1xuICAgICAgICAgICAgICAgICAgICB9LCB3cmFwcGVkUmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gcmV0cnlJbnRlcnZhbChpbnRlcnZhbCl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHNlcmllc0NhbGxiYWNrKXtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VyaWVzQ2FsbGJhY2sobnVsbCk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGludGVydmFsKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB3aGlsZSAob3B0cy50aW1lcykge1xuXG4gICAgICAgICAgICAgICAgdmFyIGZpbmFsQXR0ZW1wdCA9ICEob3B0cy50aW1lcy09MSk7XG4gICAgICAgICAgICAgICAgYXR0ZW1wdHMucHVzaChyZXRyeUF0dGVtcHQob3B0cy50YXNrLCBmaW5hbEF0dGVtcHQpKTtcbiAgICAgICAgICAgICAgICBpZighZmluYWxBdHRlbXB0ICYmIG9wdHMuaW50ZXJ2YWwgPiAwKXtcbiAgICAgICAgICAgICAgICAgICAgYXR0ZW1wdHMucHVzaChyZXRyeUludGVydmFsKG9wdHMuaW50ZXJ2YWwpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGFzeW5jLnNlcmllcyhhdHRlbXB0cywgZnVuY3Rpb24oZG9uZSwgZGF0YSl7XG4gICAgICAgICAgICAgICAgZGF0YSA9IGRhdGFbZGF0YS5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgICAgICAod3JhcHBlZENhbGxiYWNrIHx8IG9wdHMuY2FsbGJhY2spKGRhdGEuZXJyLCBkYXRhLnJlc3VsdCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIElmIGEgY2FsbGJhY2sgaXMgcGFzc2VkLCBydW4gdGhpcyBhcyBhIGNvbnRyb2xsIGZsb3dcbiAgICAgICAgcmV0dXJuIG9wdHMuY2FsbGJhY2sgPyB3cmFwcGVkVGFzaygpIDogd3JhcHBlZFRhc2s7XG4gICAgfTtcblxuICAgIGFzeW5jLndhdGVyZmFsbCA9IGZ1bmN0aW9uICh0YXNrcywgY2FsbGJhY2spIHtcbiAgICAgICAgY2FsbGJhY2sgPSBfb25jZShjYWxsYmFjayB8fCBub29wKTtcbiAgICAgICAgaWYgKCFfaXNBcnJheSh0YXNrcykpIHtcbiAgICAgICAgICAgIHZhciBlcnIgPSBuZXcgRXJyb3IoJ0ZpcnN0IGFyZ3VtZW50IHRvIHdhdGVyZmFsbCBtdXN0IGJlIGFuIGFycmF5IG9mIGZ1bmN0aW9ucycpO1xuICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0YXNrcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjaygpO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHdyYXBJdGVyYXRvcihpdGVyYXRvcikge1xuICAgICAgICAgICAgcmV0dXJuIF9yZXN0UGFyYW0oZnVuY3Rpb24gKGVyciwgYXJncykge1xuICAgICAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkobnVsbCwgW2Vycl0uY29uY2F0KGFyZ3MpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBuZXh0ID0gaXRlcmF0b3IubmV4dCgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobmV4dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKHdyYXBJdGVyYXRvcihuZXh0KSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goY2FsbGJhY2spO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVuc3VyZUFzeW5jKGl0ZXJhdG9yKS5hcHBseShudWxsLCBhcmdzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB3cmFwSXRlcmF0b3IoYXN5bmMuaXRlcmF0b3IodGFza3MpKSgpO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBfcGFyYWxsZWwoZWFjaGZuLCB0YXNrcywgY2FsbGJhY2spIHtcbiAgICAgICAgY2FsbGJhY2sgPSBjYWxsYmFjayB8fCBub29wO1xuICAgICAgICB2YXIgcmVzdWx0cyA9IF9pc0FycmF5TGlrZSh0YXNrcykgPyBbXSA6IHt9O1xuXG4gICAgICAgIGVhY2hmbih0YXNrcywgZnVuY3Rpb24gKHRhc2ssIGtleSwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHRhc2soX3Jlc3RQYXJhbShmdW5jdGlvbiAoZXJyLCBhcmdzKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoIDw9IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgYXJncyA9IGFyZ3NbMF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJlc3VsdHNba2V5XSA9IGFyZ3M7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgY2FsbGJhY2soZXJyLCByZXN1bHRzKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgYXN5bmMucGFyYWxsZWwgPSBmdW5jdGlvbiAodGFza3MsIGNhbGxiYWNrKSB7XG4gICAgICAgIF9wYXJhbGxlbChhc3luYy5lYWNoT2YsIHRhc2tzLCBjYWxsYmFjayk7XG4gICAgfTtcblxuICAgIGFzeW5jLnBhcmFsbGVsTGltaXQgPSBmdW5jdGlvbih0YXNrcywgbGltaXQsIGNhbGxiYWNrKSB7XG4gICAgICAgIF9wYXJhbGxlbChfZWFjaE9mTGltaXQobGltaXQpLCB0YXNrcywgY2FsbGJhY2spO1xuICAgIH07XG5cbiAgICBhc3luYy5zZXJpZXMgPSBmdW5jdGlvbih0YXNrcywgY2FsbGJhY2spIHtcbiAgICAgICAgX3BhcmFsbGVsKGFzeW5jLmVhY2hPZlNlcmllcywgdGFza3MsIGNhbGxiYWNrKTtcbiAgICB9O1xuXG4gICAgYXN5bmMuaXRlcmF0b3IgPSBmdW5jdGlvbiAodGFza3MpIHtcbiAgICAgICAgZnVuY3Rpb24gbWFrZUNhbGxiYWNrKGluZGV4KSB7XG4gICAgICAgICAgICBmdW5jdGlvbiBmbigpIHtcbiAgICAgICAgICAgICAgICBpZiAodGFza3MubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhc2tzW2luZGV4XS5hcHBseShudWxsLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZm4ubmV4dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm4ubmV4dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKGluZGV4IDwgdGFza3MubGVuZ3RoIC0gMSkgPyBtYWtlQ2FsbGJhY2soaW5kZXggKyAxKTogbnVsbDtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4gZm47XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG1ha2VDYWxsYmFjaygwKTtcbiAgICB9O1xuXG4gICAgYXN5bmMuYXBwbHkgPSBfcmVzdFBhcmFtKGZ1bmN0aW9uIChmbiwgYXJncykge1xuICAgICAgICByZXR1cm4gX3Jlc3RQYXJhbShmdW5jdGlvbiAoY2FsbEFyZ3MpIHtcbiAgICAgICAgICAgIHJldHVybiBmbi5hcHBseShcbiAgICAgICAgICAgICAgICBudWxsLCBhcmdzLmNvbmNhdChjYWxsQXJncylcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gX2NvbmNhdChlYWNoZm4sIGFyciwgZm4sIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciByZXN1bHQgPSBbXTtcbiAgICAgICAgZWFjaGZuKGFyciwgZnVuY3Rpb24gKHgsIGluZGV4LCBjYikge1xuICAgICAgICAgICAgZm4oeCwgZnVuY3Rpb24gKGVyciwgeSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdC5jb25jYXQoeSB8fCBbXSk7XG4gICAgICAgICAgICAgICAgY2IoZXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhlcnIsIHJlc3VsdCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBhc3luYy5jb25jYXQgPSBkb1BhcmFsbGVsKF9jb25jYXQpO1xuICAgIGFzeW5jLmNvbmNhdFNlcmllcyA9IGRvU2VyaWVzKF9jb25jYXQpO1xuXG4gICAgYXN5bmMud2hpbHN0ID0gZnVuY3Rpb24gKHRlc3QsIGl0ZXJhdG9yLCBjYWxsYmFjaykge1xuICAgICAgICBjYWxsYmFjayA9IGNhbGxiYWNrIHx8IG5vb3A7XG4gICAgICAgIGlmICh0ZXN0KCkpIHtcbiAgICAgICAgICAgIHZhciBuZXh0ID0gX3Jlc3RQYXJhbShmdW5jdGlvbihlcnIsIGFyZ3MpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0ZXN0LmFwcGx5KHRoaXMsIGFyZ3MpKSB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZXJhdG9yKG5leHQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaXRlcmF0b3IobmV4dCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBhc3luYy5kb1doaWxzdCA9IGZ1bmN0aW9uIChpdGVyYXRvciwgdGVzdCwgY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIGNhbGxzID0gMDtcbiAgICAgICAgcmV0dXJuIGFzeW5jLndoaWxzdChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiArK2NhbGxzIDw9IDEgfHwgdGVzdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICB9LCBpdGVyYXRvciwgY2FsbGJhY2spO1xuICAgIH07XG5cbiAgICBhc3luYy51bnRpbCA9IGZ1bmN0aW9uICh0ZXN0LCBpdGVyYXRvciwgY2FsbGJhY2spIHtcbiAgICAgICAgcmV0dXJuIGFzeW5jLndoaWxzdChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAhdGVzdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICB9LCBpdGVyYXRvciwgY2FsbGJhY2spO1xuICAgIH07XG5cbiAgICBhc3luYy5kb1VudGlsID0gZnVuY3Rpb24gKGl0ZXJhdG9yLCB0ZXN0LCBjYWxsYmFjaykge1xuICAgICAgICByZXR1cm4gYXN5bmMuZG9XaGlsc3QoaXRlcmF0b3IsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICF0ZXN0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgIH0sIGNhbGxiYWNrKTtcbiAgICB9O1xuXG4gICAgYXN5bmMuZHVyaW5nID0gZnVuY3Rpb24gKHRlc3QsIGl0ZXJhdG9yLCBjYWxsYmFjaykge1xuICAgICAgICBjYWxsYmFjayA9IGNhbGxiYWNrIHx8IG5vb3A7XG5cbiAgICAgICAgdmFyIG5leHQgPSBfcmVzdFBhcmFtKGZ1bmN0aW9uKGVyciwgYXJncykge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGFyZ3MucHVzaChjaGVjayk7XG4gICAgICAgICAgICAgICAgdGVzdC5hcHBseSh0aGlzLCBhcmdzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIGNoZWNrID0gZnVuY3Rpb24oZXJyLCB0cnV0aCkge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRydXRoKSB7XG4gICAgICAgICAgICAgICAgaXRlcmF0b3IobmV4dCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHRlc3QoY2hlY2spO1xuICAgIH07XG5cbiAgICBhc3luYy5kb0R1cmluZyA9IGZ1bmN0aW9uIChpdGVyYXRvciwgdGVzdCwgY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIGNhbGxzID0gMDtcbiAgICAgICAgYXN5bmMuZHVyaW5nKGZ1bmN0aW9uKG5leHQpIHtcbiAgICAgICAgICAgIGlmIChjYWxscysrIDwgMSkge1xuICAgICAgICAgICAgICAgIG5leHQobnVsbCwgdHJ1ZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRlc3QuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgaXRlcmF0b3IsIGNhbGxiYWNrKTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gX3F1ZXVlKHdvcmtlciwgY29uY3VycmVuY3ksIHBheWxvYWQpIHtcbiAgICAgICAgaWYgKGNvbmN1cnJlbmN5ID09IG51bGwpIHtcbiAgICAgICAgICAgIGNvbmN1cnJlbmN5ID0gMTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmKGNvbmN1cnJlbmN5ID09PSAwKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvbmN1cnJlbmN5IG11c3Qgbm90IGJlIHplcm8nKTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBfaW5zZXJ0KHEsIGRhdGEsIHBvcywgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPSBudWxsICYmIHR5cGVvZiBjYWxsYmFjayAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwidGFzayBjYWxsYmFjayBtdXN0IGJlIGEgZnVuY3Rpb25cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBxLnN0YXJ0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgaWYgKCFfaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIGRhdGEgPSBbZGF0YV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihkYXRhLmxlbmd0aCA9PT0gMCAmJiBxLmlkbGUoKSkge1xuICAgICAgICAgICAgICAgIC8vIGNhbGwgZHJhaW4gaW1tZWRpYXRlbHkgaWYgdGhlcmUgYXJlIG5vIHRhc2tzXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFzeW5jLnNldEltbWVkaWF0ZShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgcS5kcmFpbigpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgX2FycmF5RWFjaChkYXRhLCBmdW5jdGlvbih0YXNrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHRhc2ssXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBjYWxsYmFjayB8fCBub29wXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIGlmIChwb3MpIHtcbiAgICAgICAgICAgICAgICAgICAgcS50YXNrcy51bnNoaWZ0KGl0ZW0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHEudGFza3MucHVzaChpdGVtKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAocS50YXNrcy5sZW5ndGggPT09IHEuY29uY3VycmVuY3kpIHtcbiAgICAgICAgICAgICAgICAgICAgcS5zYXR1cmF0ZWQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGFzeW5jLnNldEltbWVkaWF0ZShxLnByb2Nlc3MpO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIF9uZXh0KHEsIHRhc2tzKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB3b3JrZXJzIC09IDE7XG4gICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICAgICAgICAgICAgX2FycmF5RWFjaCh0YXNrcywgZnVuY3Rpb24gKHRhc2spIHtcbiAgICAgICAgICAgICAgICAgICAgdGFzay5jYWxsYmFjay5hcHBseSh0YXNrLCBhcmdzKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAocS50YXNrcy5sZW5ndGggKyB3b3JrZXJzID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHEuZHJhaW4oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcS5wcm9jZXNzKCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHdvcmtlcnMgPSAwO1xuICAgICAgICB2YXIgcSA9IHtcbiAgICAgICAgICAgIHRhc2tzOiBbXSxcbiAgICAgICAgICAgIGNvbmN1cnJlbmN5OiBjb25jdXJyZW5jeSxcbiAgICAgICAgICAgIHBheWxvYWQ6IHBheWxvYWQsXG4gICAgICAgICAgICBzYXR1cmF0ZWQ6IG5vb3AsXG4gICAgICAgICAgICBlbXB0eTogbm9vcCxcbiAgICAgICAgICAgIGRyYWluOiBub29wLFxuICAgICAgICAgICAgc3RhcnRlZDogZmFsc2UsXG4gICAgICAgICAgICBwYXVzZWQ6IGZhbHNlLFxuICAgICAgICAgICAgcHVzaDogZnVuY3Rpb24gKGRhdGEsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgX2luc2VydChxLCBkYXRhLCBmYWxzZSwgY2FsbGJhY2spO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGtpbGw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBxLmRyYWluID0gbm9vcDtcbiAgICAgICAgICAgICAgICBxLnRhc2tzID0gW107XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdW5zaGlmdDogZnVuY3Rpb24gKGRhdGEsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgX2luc2VydChxLCBkYXRhLCB0cnVlLCBjYWxsYmFjayk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcHJvY2VzczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICghcS5wYXVzZWQgJiYgd29ya2VycyA8IHEuY29uY3VycmVuY3kgJiYgcS50YXNrcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUod29ya2VycyA8IHEuY29uY3VycmVuY3kgJiYgcS50YXNrcy5sZW5ndGgpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhc2tzID0gcS5wYXlsb2FkID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxLnRhc2tzLnNwbGljZSgwLCBxLnBheWxvYWQpIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxLnRhc2tzLnNwbGljZSgwLCBxLnRhc2tzLmxlbmd0aCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0gX21hcCh0YXNrcywgZnVuY3Rpb24gKHRhc2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGFzay5kYXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChxLnRhc2tzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEuZW1wdHkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmtlcnMgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjYiA9IG9ubHlfb25jZShfbmV4dChxLCB0YXNrcykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgd29ya2VyKGRhdGEsIGNiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsZW5ndGg6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcS50YXNrcy5sZW5ndGg7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcnVubmluZzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB3b3JrZXJzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlkbGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBxLnRhc2tzLmxlbmd0aCArIHdvcmtlcnMgPT09IDA7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcGF1c2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBxLnBhdXNlZCA9IHRydWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVzdW1lOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHEucGF1c2VkID09PSBmYWxzZSkgeyByZXR1cm47IH1cbiAgICAgICAgICAgICAgICBxLnBhdXNlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHZhciByZXN1bWVDb3VudCA9IE1hdGgubWluKHEuY29uY3VycmVuY3ksIHEudGFza3MubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICAvLyBOZWVkIHRvIGNhbGwgcS5wcm9jZXNzIG9uY2UgcGVyIGNvbmN1cnJlbnRcbiAgICAgICAgICAgICAgICAvLyB3b3JrZXIgdG8gcHJlc2VydmUgZnVsbCBjb25jdXJyZW5jeSBhZnRlciBwYXVzZVxuICAgICAgICAgICAgICAgIGZvciAodmFyIHcgPSAxOyB3IDw9IHJlc3VtZUNvdW50OyB3KyspIHtcbiAgICAgICAgICAgICAgICAgICAgYXN5bmMuc2V0SW1tZWRpYXRlKHEucHJvY2Vzcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gcTtcbiAgICB9XG5cbiAgICBhc3luYy5xdWV1ZSA9IGZ1bmN0aW9uICh3b3JrZXIsIGNvbmN1cnJlbmN5KSB7XG4gICAgICAgIHZhciBxID0gX3F1ZXVlKGZ1bmN0aW9uIChpdGVtcywgY2IpIHtcbiAgICAgICAgICAgIHdvcmtlcihpdGVtc1swXSwgY2IpO1xuICAgICAgICB9LCBjb25jdXJyZW5jeSwgMSk7XG5cbiAgICAgICAgcmV0dXJuIHE7XG4gICAgfTtcblxuICAgIGFzeW5jLnByaW9yaXR5UXVldWUgPSBmdW5jdGlvbiAod29ya2VyLCBjb25jdXJyZW5jeSkge1xuXG4gICAgICAgIGZ1bmN0aW9uIF9jb21wYXJlVGFza3MoYSwgYil7XG4gICAgICAgICAgICByZXR1cm4gYS5wcmlvcml0eSAtIGIucHJpb3JpdHk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBfYmluYXJ5U2VhcmNoKHNlcXVlbmNlLCBpdGVtLCBjb21wYXJlKSB7XG4gICAgICAgICAgICB2YXIgYmVnID0gLTEsXG4gICAgICAgICAgICAgICAgZW5kID0gc2VxdWVuY2UubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgIHdoaWxlIChiZWcgPCBlbmQpIHtcbiAgICAgICAgICAgICAgICB2YXIgbWlkID0gYmVnICsgKChlbmQgLSBiZWcgKyAxKSA+Pj4gMSk7XG4gICAgICAgICAgICAgICAgaWYgKGNvbXBhcmUoaXRlbSwgc2VxdWVuY2VbbWlkXSkgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICBiZWcgPSBtaWQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZW5kID0gbWlkIC0gMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gYmVnO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gX2luc2VydChxLCBkYXRhLCBwcmlvcml0eSwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPSBudWxsICYmIHR5cGVvZiBjYWxsYmFjayAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwidGFzayBjYWxsYmFjayBtdXN0IGJlIGEgZnVuY3Rpb25cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBxLnN0YXJ0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgaWYgKCFfaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIGRhdGEgPSBbZGF0YV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihkYXRhLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIC8vIGNhbGwgZHJhaW4gaW1tZWRpYXRlbHkgaWYgdGhlcmUgYXJlIG5vIHRhc2tzXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFzeW5jLnNldEltbWVkaWF0ZShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgcS5kcmFpbigpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgX2FycmF5RWFjaChkYXRhLCBmdW5jdGlvbih0YXNrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHRhc2ssXG4gICAgICAgICAgICAgICAgICAgIHByaW9yaXR5OiBwcmlvcml0eSxcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6IHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJyA/IGNhbGxiYWNrIDogbm9vcFxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBxLnRhc2tzLnNwbGljZShfYmluYXJ5U2VhcmNoKHEudGFza3MsIGl0ZW0sIF9jb21wYXJlVGFza3MpICsgMSwgMCwgaXRlbSk7XG5cbiAgICAgICAgICAgICAgICBpZiAocS50YXNrcy5sZW5ndGggPT09IHEuY29uY3VycmVuY3kpIHtcbiAgICAgICAgICAgICAgICAgICAgcS5zYXR1cmF0ZWQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYXN5bmMuc2V0SW1tZWRpYXRlKHEucHJvY2Vzcyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFN0YXJ0IHdpdGggYSBub3JtYWwgcXVldWVcbiAgICAgICAgdmFyIHEgPSBhc3luYy5xdWV1ZSh3b3JrZXIsIGNvbmN1cnJlbmN5KTtcblxuICAgICAgICAvLyBPdmVycmlkZSBwdXNoIHRvIGFjY2VwdCBzZWNvbmQgcGFyYW1ldGVyIHJlcHJlc2VudGluZyBwcmlvcml0eVxuICAgICAgICBxLnB1c2ggPSBmdW5jdGlvbiAoZGF0YSwgcHJpb3JpdHksIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBfaW5zZXJ0KHEsIGRhdGEsIHByaW9yaXR5LCBjYWxsYmFjayk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gUmVtb3ZlIHVuc2hpZnQgZnVuY3Rpb25cbiAgICAgICAgZGVsZXRlIHEudW5zaGlmdDtcblxuICAgICAgICByZXR1cm4gcTtcbiAgICB9O1xuXG4gICAgYXN5bmMuY2FyZ28gPSBmdW5jdGlvbiAod29ya2VyLCBwYXlsb2FkKSB7XG4gICAgICAgIHJldHVybiBfcXVldWUod29ya2VyLCAxLCBwYXlsb2FkKTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gX2NvbnNvbGVfZm4obmFtZSkge1xuICAgICAgICByZXR1cm4gX3Jlc3RQYXJhbShmdW5jdGlvbiAoZm4sIGFyZ3MpIHtcbiAgICAgICAgICAgIGZuLmFwcGx5KG51bGwsIGFyZ3MuY29uY2F0KFtfcmVzdFBhcmFtKGZ1bmN0aW9uIChlcnIsIGFyZ3MpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvbnNvbGUgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25zb2xlLmVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNvbnNvbGVbbmFtZV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hcnJheUVhY2goYXJncywgZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlW25hbWVdKHgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KV0pKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGFzeW5jLmxvZyA9IF9jb25zb2xlX2ZuKCdsb2cnKTtcbiAgICBhc3luYy5kaXIgPSBfY29uc29sZV9mbignZGlyJyk7XG4gICAgLyphc3luYy5pbmZvID0gX2NvbnNvbGVfZm4oJ2luZm8nKTtcbiAgICBhc3luYy53YXJuID0gX2NvbnNvbGVfZm4oJ3dhcm4nKTtcbiAgICBhc3luYy5lcnJvciA9IF9jb25zb2xlX2ZuKCdlcnJvcicpOyovXG5cbiAgICBhc3luYy5tZW1vaXplID0gZnVuY3Rpb24gKGZuLCBoYXNoZXIpIHtcbiAgICAgICAgdmFyIG1lbW8gPSB7fTtcbiAgICAgICAgdmFyIHF1ZXVlcyA9IHt9O1xuICAgICAgICBoYXNoZXIgPSBoYXNoZXIgfHwgaWRlbnRpdHk7XG4gICAgICAgIHZhciBtZW1vaXplZCA9IF9yZXN0UGFyYW0oZnVuY3Rpb24gbWVtb2l6ZWQoYXJncykge1xuICAgICAgICAgICAgdmFyIGNhbGxiYWNrID0gYXJncy5wb3AoKTtcbiAgICAgICAgICAgIHZhciBrZXkgPSBoYXNoZXIuYXBwbHkobnVsbCwgYXJncyk7XG4gICAgICAgICAgICBpZiAoa2V5IGluIG1lbW8pIHtcbiAgICAgICAgICAgICAgICBhc3luYy5uZXh0VGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KG51bGwsIG1lbW9ba2V5XSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChrZXkgaW4gcXVldWVzKSB7XG4gICAgICAgICAgICAgICAgcXVldWVzW2tleV0ucHVzaChjYWxsYmFjayk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBxdWV1ZXNba2V5XSA9IFtjYWxsYmFja107XG4gICAgICAgICAgICAgICAgZm4uYXBwbHkobnVsbCwgYXJncy5jb25jYXQoW19yZXN0UGFyYW0oZnVuY3Rpb24gKGFyZ3MpIHtcbiAgICAgICAgICAgICAgICAgICAgbWVtb1trZXldID0gYXJncztcbiAgICAgICAgICAgICAgICAgICAgdmFyIHEgPSBxdWV1ZXNba2V5XTtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHF1ZXVlc1trZXldO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IHEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBxW2ldLmFwcGx5KG51bGwsIGFyZ3MpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSldKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBtZW1vaXplZC5tZW1vID0gbWVtbztcbiAgICAgICAgbWVtb2l6ZWQudW5tZW1vaXplZCA9IGZuO1xuICAgICAgICByZXR1cm4gbWVtb2l6ZWQ7XG4gICAgfTtcblxuICAgIGFzeW5jLnVubWVtb2l6ZSA9IGZ1bmN0aW9uIChmbikge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIChmbi51bm1lbW9pemVkIHx8IGZuKS5hcHBseShudWxsLCBhcmd1bWVudHMpO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBfdGltZXMobWFwcGVyKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoY291bnQsIGl0ZXJhdG9yLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgbWFwcGVyKF9yYW5nZShjb3VudCksIGl0ZXJhdG9yLCBjYWxsYmFjayk7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgYXN5bmMudGltZXMgPSBfdGltZXMoYXN5bmMubWFwKTtcbiAgICBhc3luYy50aW1lc1NlcmllcyA9IF90aW1lcyhhc3luYy5tYXBTZXJpZXMpO1xuICAgIGFzeW5jLnRpbWVzTGltaXQgPSBmdW5jdGlvbiAoY291bnQsIGxpbWl0LCBpdGVyYXRvciwgY2FsbGJhY2spIHtcbiAgICAgICAgcmV0dXJuIGFzeW5jLm1hcExpbWl0KF9yYW5nZShjb3VudCksIGxpbWl0LCBpdGVyYXRvciwgY2FsbGJhY2spO1xuICAgIH07XG5cbiAgICBhc3luYy5zZXEgPSBmdW5jdGlvbiAoLyogZnVuY3Rpb25zLi4uICovKSB7XG4gICAgICAgIHZhciBmbnMgPSBhcmd1bWVudHM7XG4gICAgICAgIHJldHVybiBfcmVzdFBhcmFtKGZ1bmN0aW9uIChhcmdzKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgICAgIHZhciBjYWxsYmFjayA9IGFyZ3NbYXJncy5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGFyZ3MucG9wKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gbm9vcDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYXN5bmMucmVkdWNlKGZucywgYXJncywgZnVuY3Rpb24gKG5ld2FyZ3MsIGZuLCBjYikge1xuICAgICAgICAgICAgICAgIGZuLmFwcGx5KHRoYXQsIG5ld2FyZ3MuY29uY2F0KFtfcmVzdFBhcmFtKGZ1bmN0aW9uIChlcnIsIG5leHRhcmdzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNiKGVyciwgbmV4dGFyZ3MpO1xuICAgICAgICAgICAgICAgIH0pXSkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChlcnIsIHJlc3VsdHMpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseSh0aGF0LCBbZXJyXS5jb25jYXQocmVzdWx0cykpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBhc3luYy5jb21wb3NlID0gZnVuY3Rpb24gKC8qIGZ1bmN0aW9ucy4uLiAqLykge1xuICAgICAgICByZXR1cm4gYXN5bmMuc2VxLmFwcGx5KG51bGwsIEFycmF5LnByb3RvdHlwZS5yZXZlcnNlLmNhbGwoYXJndW1lbnRzKSk7XG4gICAgfTtcblxuXG4gICAgZnVuY3Rpb24gX2FwcGx5RWFjaChlYWNoZm4pIHtcbiAgICAgICAgcmV0dXJuIF9yZXN0UGFyYW0oZnVuY3Rpb24oZm5zLCBhcmdzKSB7XG4gICAgICAgICAgICB2YXIgZ28gPSBfcmVzdFBhcmFtKGZ1bmN0aW9uKGFyZ3MpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICAgICAgdmFyIGNhbGxiYWNrID0gYXJncy5wb3AoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZWFjaGZuKGZucywgZnVuY3Rpb24gKGZuLCBfLCBjYikge1xuICAgICAgICAgICAgICAgICAgICBmbi5hcHBseSh0aGF0LCBhcmdzLmNvbmNhdChbY2JdKSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjYWxsYmFjayk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChhcmdzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBnby5hcHBseSh0aGlzLCBhcmdzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBnbztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgYXN5bmMuYXBwbHlFYWNoID0gX2FwcGx5RWFjaChhc3luYy5lYWNoT2YpO1xuICAgIGFzeW5jLmFwcGx5RWFjaFNlcmllcyA9IF9hcHBseUVhY2goYXN5bmMuZWFjaE9mU2VyaWVzKTtcblxuXG4gICAgYXN5bmMuZm9yZXZlciA9IGZ1bmN0aW9uIChmbiwgY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIGRvbmUgPSBvbmx5X29uY2UoY2FsbGJhY2sgfHwgbm9vcCk7XG4gICAgICAgIHZhciB0YXNrID0gZW5zdXJlQXN5bmMoZm4pO1xuICAgICAgICBmdW5jdGlvbiBuZXh0KGVycikge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIHJldHVybiBkb25lKGVycik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0YXNrKG5leHQpO1xuICAgICAgICB9XG4gICAgICAgIG5leHQoKTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gZW5zdXJlQXN5bmMoZm4pIHtcbiAgICAgICAgcmV0dXJuIF9yZXN0UGFyYW0oZnVuY3Rpb24gKGFyZ3MpIHtcbiAgICAgICAgICAgIHZhciBjYWxsYmFjayA9IGFyZ3MucG9wKCk7XG4gICAgICAgICAgICBhcmdzLnB1c2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBpbm5lckFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICAgICAgICAgICAgaWYgKHN5bmMpIHtcbiAgICAgICAgICAgICAgICAgICAgYXN5bmMuc2V0SW1tZWRpYXRlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KG51bGwsIGlubmVyQXJncyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KG51bGwsIGlubmVyQXJncyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2YXIgc3luYyA9IHRydWU7XG4gICAgICAgICAgICBmbi5hcHBseSh0aGlzLCBhcmdzKTtcbiAgICAgICAgICAgIHN5bmMgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgYXN5bmMuZW5zdXJlQXN5bmMgPSBlbnN1cmVBc3luYztcblxuICAgIGFzeW5jLmNvbnN0YW50ID0gX3Jlc3RQYXJhbShmdW5jdGlvbih2YWx1ZXMpIHtcbiAgICAgICAgdmFyIGFyZ3MgPSBbbnVsbF0uY29uY2F0KHZhbHVlcyk7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjay5hcHBseSh0aGlzLCBhcmdzKTtcbiAgICAgICAgfTtcbiAgICB9KTtcblxuICAgIGFzeW5jLndyYXBTeW5jID1cbiAgICBhc3luYy5hc3luY2lmeSA9IGZ1bmN0aW9uIGFzeW5jaWZ5KGZ1bmMpIHtcbiAgICAgICAgcmV0dXJuIF9yZXN0UGFyYW0oZnVuY3Rpb24gKGFyZ3MpIHtcbiAgICAgICAgICAgIHZhciBjYWxsYmFjayA9IGFyZ3MucG9wKCk7XG4gICAgICAgICAgICB2YXIgcmVzdWx0O1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGlmIHJlc3VsdCBpcyBQcm9taXNlIG9iamVjdFxuICAgICAgICAgICAgaWYgKF9pc09iamVjdChyZXN1bHQpICYmIHR5cGVvZiByZXN1bHQudGhlbiA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgdmFsdWUpO1xuICAgICAgICAgICAgICAgIH0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVyci5tZXNzYWdlID8gZXJyIDogbmV3IEVycm9yKGVycikpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgLy8gTm9kZS5qc1xuICAgIGlmICh0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0JyAmJiBtb2R1bGUuZXhwb3J0cykge1xuICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IGFzeW5jO1xuICAgIH1cbiAgICAvLyBBTUQgLyBSZXF1aXJlSlNcbiAgICBlbHNlIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcbiAgICAgICAgZGVmaW5lKFtdLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gYXN5bmM7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvLyBpbmNsdWRlZCBkaXJlY3RseSB2aWEgPHNjcmlwdD4gdGFnXG4gICAgZWxzZSB7XG4gICAgICAgIHJvb3QuYXN5bmMgPSBhc3luYztcbiAgICB9XG5cbn0oKSk7XG4iLCIvLyBzaGltIGZvciB1c2luZyBwcm9jZXNzIGluIGJyb3dzZXJcblxudmFyIHByb2Nlc3MgPSBtb2R1bGUuZXhwb3J0cyA9IHt9O1xudmFyIHF1ZXVlID0gW107XG52YXIgZHJhaW5pbmcgPSBmYWxzZTtcbnZhciBjdXJyZW50UXVldWU7XG52YXIgcXVldWVJbmRleCA9IC0xO1xuXG5mdW5jdGlvbiBjbGVhblVwTmV4dFRpY2soKSB7XG4gICAgZHJhaW5pbmcgPSBmYWxzZTtcbiAgICBpZiAoY3VycmVudFF1ZXVlLmxlbmd0aCkge1xuICAgICAgICBxdWV1ZSA9IGN1cnJlbnRRdWV1ZS5jb25jYXQocXVldWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHF1ZXVlSW5kZXggPSAtMTtcbiAgICB9XG4gICAgaWYgKHF1ZXVlLmxlbmd0aCkge1xuICAgICAgICBkcmFpblF1ZXVlKCk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBkcmFpblF1ZXVlKCkge1xuICAgIGlmIChkcmFpbmluZykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciB0aW1lb3V0ID0gc2V0VGltZW91dChjbGVhblVwTmV4dFRpY2spO1xuICAgIGRyYWluaW5nID0gdHJ1ZTtcblxuICAgIHZhciBsZW4gPSBxdWV1ZS5sZW5ndGg7XG4gICAgd2hpbGUobGVuKSB7XG4gICAgICAgIGN1cnJlbnRRdWV1ZSA9IHF1ZXVlO1xuICAgICAgICBxdWV1ZSA9IFtdO1xuICAgICAgICB3aGlsZSAoKytxdWV1ZUluZGV4IDwgbGVuKSB7XG4gICAgICAgICAgICBjdXJyZW50UXVldWVbcXVldWVJbmRleF0ucnVuKCk7XG4gICAgICAgIH1cbiAgICAgICAgcXVldWVJbmRleCA9IC0xO1xuICAgICAgICBsZW4gPSBxdWV1ZS5sZW5ndGg7XG4gICAgfVxuICAgIGN1cnJlbnRRdWV1ZSA9IG51bGw7XG4gICAgZHJhaW5pbmcgPSBmYWxzZTtcbiAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG59XG5cbnByb2Nlc3MubmV4dFRpY2sgPSBmdW5jdGlvbiAoZnVuKSB7XG4gICAgdmFyIGFyZ3MgPSBuZXcgQXJyYXkoYXJndW1lbnRzLmxlbmd0aCAtIDEpO1xuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMSkge1xuICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgYXJnc1tpIC0gMV0gPSBhcmd1bWVudHNbaV07XG4gICAgICAgIH1cbiAgICB9XG4gICAgcXVldWUucHVzaChuZXcgSXRlbShmdW4sIGFyZ3MpKTtcbiAgICBpZiAocXVldWUubGVuZ3RoID09PSAxICYmICFkcmFpbmluZykge1xuICAgICAgICBzZXRUaW1lb3V0KGRyYWluUXVldWUsIDApO1xuICAgIH1cbn07XG5cbi8vIHY4IGxpa2VzIHByZWRpY3RpYmxlIG9iamVjdHNcbmZ1bmN0aW9uIEl0ZW0oZnVuLCBhcnJheSkge1xuICAgIHRoaXMuZnVuID0gZnVuO1xuICAgIHRoaXMuYXJyYXkgPSBhcnJheTtcbn1cbkl0ZW0ucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmZ1bi5hcHBseShudWxsLCB0aGlzLmFycmF5KTtcbn07XG5wcm9jZXNzLnRpdGxlID0gJ2Jyb3dzZXInO1xucHJvY2Vzcy5icm93c2VyID0gdHJ1ZTtcbnByb2Nlc3MuZW52ID0ge307XG5wcm9jZXNzLmFyZ3YgPSBbXTtcbnByb2Nlc3MudmVyc2lvbiA9ICcnOyAvLyBlbXB0eSBzdHJpbmcgdG8gYXZvaWQgcmVnZXhwIGlzc3Vlc1xucHJvY2Vzcy52ZXJzaW9ucyA9IHt9O1xuXG5mdW5jdGlvbiBub29wKCkge31cblxucHJvY2Vzcy5vbiA9IG5vb3A7XG5wcm9jZXNzLmFkZExpc3RlbmVyID0gbm9vcDtcbnByb2Nlc3Mub25jZSA9IG5vb3A7XG5wcm9jZXNzLm9mZiA9IG5vb3A7XG5wcm9jZXNzLnJlbW92ZUxpc3RlbmVyID0gbm9vcDtcbnByb2Nlc3MucmVtb3ZlQWxsTGlzdGVuZXJzID0gbm9vcDtcbnByb2Nlc3MuZW1pdCA9IG5vb3A7XG5cbnByb2Nlc3MuYmluZGluZyA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdwcm9jZXNzLmJpbmRpbmcgaXMgbm90IHN1cHBvcnRlZCcpO1xufTtcblxuLy8gVE9ETyhzaHR5bG1hbilcbnByb2Nlc3MuY3dkID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gJy8nIH07XG5wcm9jZXNzLmNoZGlyID0gZnVuY3Rpb24gKGRpcikge1xuICAgIHRocm93IG5ldyBFcnJvcigncHJvY2Vzcy5jaGRpciBpcyBub3Qgc3VwcG9ydGVkJyk7XG59O1xucHJvY2Vzcy51bWFzayA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gMDsgfTtcbiJdfQ==\n"],"sourceRoot":"/source/"}